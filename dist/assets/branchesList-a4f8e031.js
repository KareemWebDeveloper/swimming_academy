import{d as ee,u as te,j as ae,r as n,o as oe,k as le,l as se,a as u,c as h,b as o,w as l,e as a,g as s,t as d,f as _,m as $,F as j,h as V,s as k,n as z,p as w,q as re,v as ne,x as ie,y as ce,z as g,A as C,B as ue}from"./index-54b3e273.js";import{s as H,a as K}from"./inlinemessage.esm-9b16a9f3.js";import{s as p}from"./column.esm-188ee393.js";import{i as S}from"./isEmployeeAuthorizedFor-df272e7f.js";import{s as de}from"./successMsg-2def3ef6.js";import"./index.esm-8fb1d516.js";/* empty css                                                   */const pe={key:1,class:"branchDetails"},me={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},ve={style:{color:"black"}},he={class:"p-input-icon-left"},be=s("i",{class:"pi pi-search"},null,-1),fe={class:"w-12 md:w-10 my-5 m-auto p-2 md:p-5 branchesList",style:{direction:"rtl"}},_e={class:"w-full m-auto flex justify-content-center p-4 MargAutoMob padding-1-breadcrumbs",style:{direction:"ltr"}},ge={key:0,class:"px-3 py-2 textColor text-center borderRound error my-3"},ye={key:2},xe={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},ke={class:"flex align-items-center"},we=s("h3",{class:"hidden md:my-2 lg:my-0 md:flex"},"الفروع",-1),Ce={class:"p-input-icon-left"},Se=s("i",{class:"pi pi-search"},null,-1),Ae={class:"flex align-items-center"},Te=["onClick"],De=["onClick"],$e=["onClick"],Ue=ee({__name:"branchesList",setup(Ne){const{push:x,currentRoute:I}=te(),Q=ae(),U=n(!1),N=n(!1),R=n(!1),L=n(!1),B=n(!1),r=n(),m=n([]),E=n(!1),O=n([]);O.value=[{label:"الفروع",route:"/branches",to:"/branches"},{label:"عرض الفروع",route:"/branches",to:"/branches"}];const W=n({icon:"pi pi-home",to:"/"}),G=i=>{Q.require({target:i.currentTarget,message:"هل متأكد أنك تريد حذف هذا الفرع ؟",icon:"pi pi-exclamation-triangle",acceptLabel:"نعم",rejectLabel:"لا",accept:()=>{X()},reject:()=>{}})},b=n(),A=n({global:{value:null,matchMode:g.CONTAINS},category_name:{operator:C.AND,constraints:[{value:null,matchMode:g.STARTS_WITH}]},duration:{operator:C.AND,constraints:[{value:null,matchMode:g.EQUALS}]},price_per_1:{operator:C.AND,constraints:[{value:null,matchMode:g.GREATER_THAN_OR_EQUAL_TO}]}}),T=n({global:{value:null,matchMode:g.CONTAINS},branch_name:{operator:C.AND,constraints:[{value:null,matchMode:g.STARTS_WITH}]},id:{operator:C.AND,constraints:[{value:null,matchMode:g.EQUALS}]}}),J={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0,timeZone:"Africa/Cairo",locale:"ar"},P=new Intl.DateTimeFormat("ar",J),F=()=>{V.get("http://127.0.0.1:8000/api/branches").then(i=>{console.log(i.data),b.value=i.data.branches,U.value=!0,b.value.forEach(t=>{t.created_at=new Date(t.created_at)})}).catch(i=>{console.log(i)})},Z=i=>{B.value=!1,N.value=!0,V.get(`http://127.0.0.1:8000/api/branch/${i}`).then(t=>{r.value=t.data.branch;let e=[];r.value.categories=r.value.categories.map(c=>{const{category_name:v}=c,{category_id:D,...Y}=c.pivot;return{category_name:v,categoryId:D,...Y}}),r.value.categories.forEach((c,v)=>{r.value.categories[v].session_prices=JSON.parse(c.session_prices),r.value.categories[v].prices_per_sessions=[],r.value.categories[v].session_prices.forEach(D=>{r.value.categories[v].prices_per_sessions+=`( ${D.sessions} sessions / ${D.price} ج.م ) , `})}),console.log(r.value.categories),r.value.working_days.forEach(c=>{e.push(c.day)}),r.value.working_days=e,B.value=!0,console.log(r.value,"activeBranchhh")}).catch(t=>{console.log(t)})},X=()=>{console.log(m.value);let i=[];m.value.forEach(e=>{i.push(e.id)});let t={branch_ids:i};V.post("http://127.0.0.1:8000/api/branchBulkDelete",t).then(e=>{console.log(e),E.value=!0,R.value=!1,m.value=[],F(),setTimeout(()=>{E.value=!1},4500)}).catch(e=>{m.value=[],console.log(e),R.value=!0,e.response.data.message.includes("Branch has active subscriptions")&&(L.value="الفروع التي تدريد حذفها لديها اشتراكات نشطة")})},f=n(),y=n("admin");oe(()=>{le().then(i=>{i==!1?se().then(t=>{t==!1&&(localStorage.removeItem("SwimmingToken"),location.reload(),x({path:"/login",query:I.value.query})),f.value=t.permissions,y.value="employee",S(f.value,"عرض الفروع",y.value)||(localStorage.removeItem("SwimmingToken"),location.reload(),x({path:"/login",query:I.value.query})),console.log(f.value),F()}):F()})});const M=n(),q=()=>{M.value.exportCSV()};return(i,t)=>(u(),h(j,null,[o(a(ne),{visible:N.value,"onUpdate:visible":t[4]||(t[4]=e=>N.value=e),maximizable:"",modal:"",header:"تفاصيل الفرع",style:{width:"60vw"},breakpoints:{"960px":"75vw","641px":"100vw"}},{footer:l(()=>[o(a(k),{type:"button",class:"mb-3 lg:mb-0 mx-2",onClick:t[3]||(t[3]=e=>a(x)(`/branch/update/${r.value.id}`)),label:"تعديل"})]),default:l(()=>[B.value?(u(),h("div",pe,[o(a(H),{filters:A.value,"onUpdate:filters":t[2]||(t[2]=e=>A.value=e),"export-filename":`تفاصيل فرع ${r.value.branch_name}`,ref_key:"dt",ref:M,stripedRows:"",value:r.value.categories,paginator:"",rows:10,rowsPerPageOptions:[10,20,50],filterDisplay:"menu",dataKey:"id",removableSort:"",globalFilterFields:["duration","category_name"],tableStyle:"min-width: 50rem"},{header:l(()=>[s("div",me,[s("h3",ve,d(r.value.branch_name),1),s("span",he,[be,o(a(z),{modelValue:A.value.global.value,"onUpdate:modelValue":t[0]||(t[0]=e=>A.value.global.value=e),placeholder:"بحث شامل"},null,8,["modelValue"])])])]),empty:l(()=>[o(a(K),{severity:"info"},{default:l(()=>[w("لا يوجد تمارين")]),_:1})]),paginatorend:l(()=>[o(a(k),{type:"button",icon:"pi pi-download",onClick:t[1]||(t[1]=e=>q(e)),text:""})]),footer:l(()=>[w(" في المجموع هناك "+d(b.value?b.value.length:0)+" أنواع ",1)]),default:l(()=>[o(a(p),{field:"category_name",sortable:"",header:"نوع التمرينة"}),o(a(p),{field:"duration",sortable:"",header:"مدة التمرينة"},{body:l(e=>[s("p",null,d(e.data.duration)+" ساعة",1)]),_:1}),o(a(p),{field:"price_per_session",sortable:"",header:"سعر 1 تمرينة"},{body:l(e=>[s("p",null,d(e.data.price_per_session)+" ج.م",1)]),_:1}),o(a(p),{field:"prices_per_sessions",sortable:"",header:"عدد الحصص / السعر"},{body:l(e=>[(u(!0),h(j,null,re(e.data.session_prices,(c,v)=>(u(),h("div",{key:v},[s("p",null,d(c.sessions)+" حصص / "+d(c.price)+" ج.م",1)]))),128))]),_:1})]),_:1},8,["filters","export-filename","value"])])):(u(),$(ue,{key:0}))]),_:1},8,["visible"]),s("div",fe,[s("div",_e,[o(a(ie),{home:W.value,model:O.value},null,8,["home","model"])]),o(a(ce)),R.value?(u(),h("h5",ge,d(L.value),1)):_("",!0),E.value?(u(),$(de,{key:1,class:"fadeinright animation-duration-500 animation-iteration-1 my-4"},{default:l(()=>[w("تم الحذف بنجاح")]),_:1})):_("",!0),U.value?(u(),h("div",ye,[o(a(H),{filters:T.value,"onUpdate:filters":t[8]||(t[8]=e=>T.value=e),ref_key:"dt",ref:M,"export-filename":"تفاصيل الفروع",stripedRows:"",value:b.value,selection:m.value,"onUpdate:selection":t[9]||(t[9]=e=>m.value=e),stateStorage:"session",stateKey:"branches-state-session",paginator:"",rows:10,rowsPerPageOptions:[10,20,50],filterDisplay:"menu",dataKey:"id",removableSort:"",globalFilterFields:["id","branch_name"],tableStyle:"min-width: 50rem"},{header:l(()=>[s("div",xe,[s("div",ke,[a(S)(f.value,"تسجيل و تعديل الفروع",y.value)?(u(),$(a(k),{key:0,type:"button",class:"mb-3 lg:mb-0 mx-2",onClick:t[5]||(t[5]=e=>a(x)("/branch/create")),label:"انشاء فرع"})):_("",!0),a(S)(f.value,"تسجيل و تعديل الفروع",y.value)?(u(),$(a(k),{key:1,type:"button",disabled:m.value.length==0,severity:"danger",class:"mb-3 lg:mb-0 mx-2",label:"حذف المحدد"},null,8,["disabled"])):_("",!0)]),we,s("span",Ce,[Se,o(a(z),{modelValue:T.value.global.value,"onUpdate:modelValue":t[6]||(t[6]=e=>T.value.global.value=e),placeholder:"بحث شامل"},null,8,["modelValue"])])])]),empty:l(()=>[o(a(K),{severity:"info"},{default:l(()=>[w("لا يوجد فروع")]),_:1})]),paginatorend:l(()=>[o(a(k),{type:"button",icon:"pi pi-download",onClick:t[7]||(t[7]=e=>q(e)),text:""})]),footer:l(()=>[w(" في المجموع هناك "+d(b.value?b.value.length:0)+" فروع ",1)]),default:l(()=>[o(a(p),{selectionMode:"multiple",headerStyle:"width: 3rem"}),o(a(p),{field:"id",sortable:"",header:"الكود"}),o(a(p),{field:"branch_name",sortable:"",header:"الفرع"}),o(a(p),{field:"created_at",sortable:"",header:"تاريخ الانشاء",style:{width:"36%"}},{body:l(e=>[s("p",null,d(a(P).format(e.data.created_at)),1)]),_:1}),o(a(p),{header:"تعديل",style:{width:"14%"}},{body:l(e=>[s("div",Ae,[a(S)(f.value,"تسجيل و تعديل الفروع",y.value)?(u(),h("span",{key:0,class:"material-symbols-outlined cursor-pointer hoverIcon textColor text-3xl p-2 borderRound",onClick:c=>{m.value=[{id:e.data.id}],G(c)}}," delete_forever ",8,Te)):_("",!0),a(S)(f.value,"تسجيل و تعديل الفروع",y.value)?(u(),h("span",{key:1,onClick:c=>a(x)(`/branch/update/${e.data.id}`),class:"material-symbols-outlined cursor-pointer hoverIcon mx-2 textColor text-3xl p-2 borderRound"}," edit ",8,De)):_("",!0),s("span",{class:"material-symbols-outlined cursor-pointer hoverIcon textColor text-3xl p-2 borderRound",onClick:c=>Z(e.data.id)}," visibility ",8,$e)])]),_:1})]),_:1},8,["filters","value","selection"])])):_("",!0)])],64))}});export{Ue as default};
