import{d as G,u as J,j as X,r as l,o as Y,k as ee,l as ae,C as te,a as c,c as u,g as r,b as s,e as n,w as d,m as oe,f as v,h as T,x as le,y as se,s as w,p as A,F as ne,q as ie,t as h,n as re,z as y,A as C}from"./index-5ed95cfa.js";import{a as de,s as ce}from"./inlinemessage.esm-b859ab3c.js";import{s as f}from"./column.esm-6404a039.js";import{s as ue}from"./successMsg-575c06f8.js";import{s as me}from"./calendar.esm-0476f178.js";import{i as pe}from"./isEmployeeAuthorizedFor-df272e7f.js";import"./index.esm-93947ef4.js";/* empty css                                                   */const he={class:"w-12 md:w-10 my-5 m-auto p-2 md:p-5 branchesList",style:{direction:"rtl"}},ve={class:"w-full m-auto flex justify-content-center p-4 MargAutoMob padding-1-breadcrumbs",style:{direction:"ltr"}},_e={key:0},fe=r("h2",{class:"text-center my-5 text-white"},"انشاء تقرير الايرادات",-1),be={class:"mt-3"},ge=r("div",{class:"flex align-items-center"},[r("label",{for:"branch",class:"px-3 py-1 text-white text-sm"},"الفرع")],-1),ye={key:1},we={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},xe=r("h3",{class:"hidden md:my-2 lg:my-0 md:flex"},"تقرير الايرادات",-1),De={class:"flex align-content-center justify-content-center"},ke={class:"flex"},Fe={key:0,class:"mx-2"},Se={key:1,class:"mx-2"},Te={key:2,class:"mx-2"},Ae={key:3,class:"mx-2"},Ce={key:4,class:"mx-2"},Me={class:"p-input-icon-left"},Re=r("i",{class:"pi pi-search"},null,-1),Ve={class:"py-2"},Ee={class:"textColor text-center mb-3"},Ie={class:"text-center textColor"},Ne={style:{background:"rgba(0, 128, 0, 0.932)"},class:"p-1 px-3 borderRound"},Ke=G({__name:"Revenues",setup(Be){const{push:M,currentRoute:_}=J();X();const R=l(!1),x=l(!1),V=l(!1),j=l(!1),b=l(!0);l(!1),l(!1),l(!1),l(!1),l(!1),l();const z=l(!1),E=l(),D=l(),m=l([]),k=l(0),I=l([]);I.value=[{label:"تقرير الايرادات",route:"/revenues",to:"/revenues"}];const O=l({icon:"pi pi-home",to:"/"}),p=l({global:{value:null,matchMode:y.CONTAINS},academy_name:{operator:C.AND,constraints:[{value:null,matchMode:y.STARTS_WITH}]},paid_date:{operator:C.AND,constraints:[{value:null,matchMode:y.DATE_AFTER},{value:null,matchMode:y.DATE_BEFORE}]},id:{operator:C.AND,constraints:[{value:null,matchMode:y.EQUALS}]}}),K={weekday:"long",year:"numeric",month:"long",day:"numeric",hour12:!0,timeZone:"Africa/Cairo",locale:"ar"},P=new Intl.DateTimeFormat("ar",K),Q=a=>{T.get(`https://akademia.website/api/revenues/${a}`).then(t=>{t.data.installments.forEach(o=>{m.value.push({amount:o.amount,paid_date:new Date(o.updated_at),subscription_date:new Date(o.subscription.subscription_date),expiration_date:new Date(o.subscription.subscription_date).toLocaleDateString()+" إلي "+new Date(o.subscription.expiration_date).toLocaleDateString(),type:"تقسيط",branch:o.subscription.branch.branch_name,academy_name:o.subscription.academy_name,category_name:o.subscription.category_name})}),t.data.subscriptions.forEach(o=>{m.value.push({amount:o.sale?o.price-o.sale:o.price,paid_date:new Date(o.subscription_date),subscription_date:new Date(o.subscription_date),expiration_date:new Date(o.subscription_date).toLocaleDateString()+" إلي "+new Date(o.expiration_date).toLocaleDateString(),type:"كاش",branch:o.branch.branch_name,academy_name:o.academy_name,category_name:o.category_name})}),S(),x.value=!1,b.value=!1,R.value=!0,console.log(m.value)}).catch(t=>{console.log(t)})},N=l([{label:"كل الفروع",value:0}]),W=l([]),B=[],L=()=>{T.get("https://akademia.website/api/branches").then(a=>{console.log(a.data),a.data.branches.forEach(t=>{N.value.push({label:t.branch_name,value:t.id}),B.push({label:t.branch_name,value:t.id})}),V.value=!0}).catch(a=>{console.log(a)})},$=()=>{T.get("https://akademia.website/api/academies").then(a=>{console.log(a.data),a.data.academies.forEach(t=>{W.value.push({label:t.academy_name,value:t.id})}),j.value=!0}).catch(a=>{console.log(a)})},F=a=>{if(x.value=!0,Q(a.branch_id),a.branch_id==0)D.value="تقرير ايرادات كل الفروع";else{let t=B.filter(o=>o.value==a.branch_id);t=t[0].label,D.value=`تقرير ايرادات فرع ${t}`}},q=l(),S=()=>{let a=m.value,t=!0,o=0;console.log(a),p.value.paid_date.constraints.forEach(e=>{e.value&&(t=!1,e.matchMode=="dateAfter"&&a.length>0&&(a=a.filter(i=>i.paid_date>new Date(e.value))),e.matchMode=="dateBefore"&&a.length>0&&(a=a.filter(i=>i.paid_date<new Date(e.value))),e.matchMode=="dateIs"&&a.length>0&&(e.value=new Date(e.value),e.value.setHours(0,0,0,0),a=a.filter(i=>{console.log(i),console.log(i.paid_date,"from inside filter");const g=new Date(i.paid_date);return g.setHours(0,0,0,0),g.getTime()==e.value.getTime()})),e.matchMode=="dateIsNot"&&a.length>0&&(e.value=new Date(e.value),e.value.setHours(0,0,0,0),a=a.filter(i=>{const g=new Date(i.paid_date);return g.setHours(0,0,0,0),g.getTime()!==e.value.getTime()})))}),t?(m.value.forEach(e=>{o+=parseFloat(e.amount)}),k.value=o):(a.forEach(e=>{o+=parseFloat(e.amount)}),k.value=o)},U=l(),H=l("admin");Y(()=>{ee().then(a=>{if(a==!1)ae().then(t=>{if(t==!1&&(localStorage.removeItem("SwimmingToken"),location.reload(),M({path:"/login",query:_.value.query})),U.value=t.permissions,H.value="employee",pe(U.value,"الحسابات المالية",H.value)||(localStorage.removeItem("SwimmingToken"),location.reload(),M({path:"/login",query:_.value.query})),_.value.query.branchId){let o={branch_id:_.value.query.branchId};b.value=!1,F(o)}L(),$()});else{if(_.value.query.branchId){let t={branch_id:_.value.query.branchId};b.value=!1,F(t)}L(),$()}})});const Z=()=>{q.value.exportCSV()};return(a,t)=>{const o=te("FormKit");return c(),u("div",he,[r("div",ve,[s(n(le),{home:O.value,model:I.value},null,8,["home","model"])]),s(n(se)),b.value&&V.value?(c(),u("div",_e,[fe,s(o,{modelValue:E.value,"onUpdate:modelValue":t[0]||(t[0]=e=>E.value=e),type:"form",actions:!1,onSubmit:F},{default:d(()=>[r("div",be,[ge,s(o,{type:"dropdown",id:"branch",validation:"required",name:"branch_id",label:"الفرع",placeholder:"اختر الفرع الذي تريد تقرير عنه",options:N.value},null,8,["options"])]),s(n(w),{type:"submit",class:"submitBtn",label:"التالي",loading:x.value},null,8,["loading"])]),_:1},8,["modelValue"])])):b.value?v("",!0):(c(),u("div",ye,[z.value?(c(),oe(ue,{key:0,class:"fadeinright animation-duration-500 animation-iteration-1 my-4"},{default:d(()=>[A("تم الحذف بنجاح")]),_:1})):v("",!0),s(n(ce),{filters:p.value,"onUpdate:filters":t[3]||(t[3]=e=>p.value=e),loading:!R.value,ref_key:"dt",ref:q,"export-filename":D.value,stripedRows:"",value:m.value,filterDisplay:"menu",paginator:"",rows:10,rowsPerPageOptions:[10,20,50,100],dataKey:"id",removableSort:"",globalFilterFields:["academy_name"],tableStyle:"min-width: 50rem"},{header:d(()=>[r("div",we,[xe,r("div",De,[(c(!0),u(ne,null,ie(p.value.paid_date.constraints,(e,i)=>(c(),u("div",ke,[e.value&&e.matchMode=="dateIsNot"?(c(),u("p",Fe,"الإيرادات ما عدا "+h(new Date(e.value).toLocaleDateString()),1)):v("",!0),e.value&&e.matchMode=="dateIs"?(c(),u("p",Se,"الإيرادات في "+h(new Date(e.value).toLocaleDateString()),1)):v("",!0),e.value&&e.matchMode=="dateAfter"?(c(),u("p",Te,"الإيرادات بعد "+h(new Date(e.value).toLocaleDateString()),1)):v("",!0),e.value&&e.matchMode=="dateBefore"?(c(),u("p",Ae,"الإيرادات قبل "+h(new Date(e.value).toLocaleDateString()),1)):v("",!0),p.value.paid_date.constraints[i+1]&&p.value.paid_date.constraints[i+1].value?(c(),u("p",Ce," مع ")):v("",!0)]))),256))]),r("span",Me,[Re,s(n(re),{modelValue:p.value.global.value,"onUpdate:modelValue":t[1]||(t[1]=e=>p.value.global.value=e),placeholder:"بحث شامل"},null,8,["modelValue"])])])]),empty:d(()=>[s(n(de),{severity:"info"},{default:d(()=>[A("غير موجود")]),_:1})]),paginatorend:d(()=>[s(n(w),{type:"button",icon:"pi pi-download",onClick:t[2]||(t[2]=e=>Z(e)),text:""})]),footer:d(()=>[r("div",Ve,[r("h4",Ee,"في المجموع هناك "+h(m.value?m.value.length:0)+" مصادر ايرادات ",1),r("h3",Ie,[A("اجمالي الايرادات : "),r("span",Ne,h(k.value.toFixed(2))+" ج.م",1)])])]),default:d(()=>[s(n(f),{field:"amount",sortable:"",header:"المبلغ",style:{width:"15%"}},{body:d(e=>[r("p",null,h(parseFloat(e.data.amount).toFixed(2))+" ج.م",1)]),_:1}),s(n(f),{field:"type",header:"طريقة الدفع",style:{width:"14%"}}),s(n(f),{field:"paid_date",filterField:"paid_date",dataType:"date",sortable:"",header:"تاريخ الدفع",style:{width:"22%"}},{body:d(e=>[r("p",null,h(n(P).format(e.data.paid_date)),1)]),filter:d(({filterModel:e})=>[s(n(me),{modelValue:e.value,"onUpdate:modelValue":i=>e.value=i,dateFormat:"mm/dd/yy",placeholder:"أختر التاريخ ",mask:"99/99/9999"},null,8,["modelValue","onUpdate:modelValue"])]),filterapply:d(({filterCallback:e})=>[s(n(w),{type:"button",onClick:i=>{e(),S()},class:"mb-3 lg:mb-0 mx-2",label:"تفعيل"},null,8,["onClick"])]),filterclear:d(({filterCallback:e})=>[s(n(w),{type:"button",onClick:i=>{e(),S()},class:"mb-3 lg:mb-0 mx-2",label:"الغاء",outlined:""},null,8,["onClick"])]),_:1}),s(n(f),{field:"expiration_date",sortable:"",header:"مدة الاشتراك",style:{width:"22%"}}),s(n(f),{field:"branch",header:"الفرع",style:{width:"13%"}}),s(n(f),{field:"academy_name",header:"الأكاديمية"})]),_:1},8,["filters","loading","export-filename","value"])]))])}}});export{Ke as default};
