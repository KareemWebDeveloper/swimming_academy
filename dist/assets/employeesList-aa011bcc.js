import{d as le,u as ae,j as oe,r as o,o as se,k as ne,l as ie,C as re,a as r,c as p,b as a,w as i,e as t,g as s,m as D,f as y,F as K,h as w,s as b,t as g,n as P,p as V,q as de,v as ce,x as ue,y as me,z as v,A as k,B as pe}from"./index-54b3e273.js";import{s as H,a as Q}from"./inlinemessage.esm-9b16a9f3.js";import{s as c}from"./column.esm-188ee393.js";import{s as ve}from"./successMsg-2def3ef6.js";import{i as C}from"./isEmployeeAuthorizedFor-df272e7f.js";import"./index.esm-8fb1d516.js";/* empty css                                                   */const he={key:1,class:"branchDetails"},fe={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},ye={class:"flex align-items-center"},be={style:{color:"black"}},ge={class:"p-input-icon-left"},_e=s("i",{class:"pi pi-search"},null,-1),xe=s("h2",{style:{color:"black"},class:"text-center"},"الصلاحيات",-1),we={class:"flex align-items-center flex-wrap justify-content-center"},ke={class:"p-3 borderRound mx-2",style:{color:"#256029","background-color":"#c8e6c9d3"}},Ce={class:"attachBranches"},Se={class:"flex justify-content-between"},Ae={class:"w-12 md:w-10 my-5 m-auto p-2 md:p-5 branchesList",style:{direction:"rtl"}},Fe={class:"w-full m-auto flex justify-content-center p-4 MargAutoMob padding-1-breadcrumbs",style:{direction:"ltr"}},Te={key:1},De={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},Ve={class:"flex align-items-center"},Be=s("h3",{class:"hidden md:my-2 lg:my-0 md:flex"},"الموظفين",-1),Ne={class:"p-input-icon-left"},$e=s("i",{class:"pi pi-search"},null,-1),Ie={class:"flex align-items-center"},Me=["onClick"],Ee=["onClick"],Re=["onClick"],He=le({__name:"employeesList",setup(Ue){const{push:_,currentRoute:U}=ae(),W=oe(),L=o(!1),Z=o(!1),B=o(!1);o(!1),o(!1),o(!1),o(!1);const S=o(!1),N=o(!1),u=o(),m=o([]),$=o(!1),j=o([]);j.value=[{label:"الموظفين",route:"/employees",to:"/employees"},{label:"عرض الموظفين",route:"/employees",to:"/employees"}];const G=o({icon:"pi pi-home",to:"/"}),J=n=>{W.require({target:n.currentTarget,message:"هل متأكد أنك تريد حذف هذا الموظف ؟",icon:"pi pi-exclamation-triangle",acceptLabel:"نعم",rejectLabel:"لا",accept:()=>{te()},reject:()=>{}})},x=o(),I=o([]),A=o(),F=o({global:{value:null,matchMode:v.CONTAINS},branch_name:{operator:k.AND,constraints:[{value:null,matchMode:v.STARTS_WITH}]},id:{operator:k.AND,constraints:[{value:null,matchMode:v.EQUALS}]}}),T=o({global:{value:null,matchMode:v.CONTAINS},name:{operator:k.AND,constraints:[{value:null,matchMode:v.CONTAINS}]},phone:{operator:k.AND,constraints:[{value:null,matchMode:v.STARTS_WITH}]},id:{operator:k.AND,constraints:[{value:null,matchMode:v.EQUALS}]}}),X={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0,timeZone:"Africa/Cairo",locale:"ar"},Y=new Intl.DateTimeFormat("ar",X),M=()=>{w.get("http://127.0.0.1:8000/api/employees").then(n=>{console.log(n.data),x.value=n.data.employees,L.value=!0,x.value.forEach(e=>{e.created_at=new Date(e.created_at)})}).catch(n=>{console.log(n)})},q=()=>{w.get("http://127.0.0.1:8000/api/branches").then(n=>{console.log(n.data),n.data.branches.forEach(e=>{I.value.push({label:e.branch_name,value:e.id})}),Z.value=!0}).catch(n=>{console.log(n)})},z=n=>{S.value=!1,B.value=!0,w.get(`http://127.0.0.1:8000/api/employee/${n}`).then(e=>{u.value=e.data.employee,A.value={branchIds:[]},e.data.employee.branches.forEach(d=>{A.value.branchIds.push(d.id)}),S.value=!0,console.log(u.value),console.log(I.value)}).catch(e=>{console.log(e)})},ee=n=>{N.value=!0,w.put(`http://127.0.0.1:8000/api/employee/attachBranches/${u.value.id}`,n).then(e=>{console.log(e),N.value=!1,S.value=!1,z(u.value.id)}).catch(e=>{console.log(e)})},te=()=>{console.log(m.value);let n=[];m.value.forEach(d=>{n.push(d.id)});let e={employees_ids:n};w.post("http://127.0.0.1:8000/api/employeeBulkDelete",e).then(d=>{console.log(d),$.value=!0,m.value=[],M(),setTimeout(()=>{$.value=!1},4500)}).catch(d=>{console.log(d.response.data)})},h=o(),f=o("admin");se(()=>{ne().then(n=>{n==!1?ie().then(e=>{e==!1&&(localStorage.removeItem("SwimmingToken"),location.reload(),console.log("not employee"),_({path:"/login",query:U.value.query})),h.value=e.permissions,f.value="employee",C(h.value,"عرض الموظفين",f.value)||(localStorage.removeItem("SwimmingToken"),console.log("not authorized"),location.reload(),_({path:"/login",query:U.value.query})),M(),q()}):(M(),q())})});const E=o(),O=()=>{E.value.exportCSV()};return(n,e)=>{const d=re("FormKit");return r(),p(K,null,[a(t(ce),{visible:B.value,"onUpdate:visible":e[5]||(e[5]=l=>B.value=l),maximizable:"",modal:"",header:"الفروع التي يعمل بها",style:{width:"60vw"},breakpoints:{"960px":"75vw","641px":"100vw"}},{footer:i(()=>[s("div",Se,[a(t(b),{type:"button",class:"mb-3 lg:mb-0 mx-2",onClick:e[4]||(e[4]=l=>t(_)(`/employee/update/${u.value.id}`)),label:"تعديل"})])]),default:i(()=>[S.value?(r(),p("div",he,[a(t(H),{filters:F.value,"onUpdate:filters":e[3]||(e[3]=l=>F.value=l),paginator:"",rows:10,rowsPerPageOptions:[10,15,20,50],ref_key:"dt",ref:E,stripedRows:"",value:u.value.branches,filterDisplay:"menu",dataKey:"id",removableSort:"",globalFilterFields:["id","branch_name"],tableStyle:"min-width: 50rem"},{header:i(()=>[s("div",fe,[s("div",ye,[s("h3",be,g(u.value.name),1)]),s("span",ge,[_e,a(t(P),{modelValue:F.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=l=>F.value.global.value=l),placeholder:"بحث شامل"},null,8,["modelValue"])])])]),empty:i(()=>[a(t(Q),{severity:"info"},{default:i(()=>[V("لا يوجد فروع")]),_:1})]),paginatorend:i(()=>[a(t(b),{type:"button",icon:"pi pi-download",onClick:e[1]||(e[1]=l=>O(l)),text:""})]),footer:i(()=>[xe,s("div",we,[(r(!0),p(K,null,de(u.value.roles,l=>(r(),p("div",ke,[s("p",null,g(l.role_name),1)]))),256))]),a(d,{type:"form",actions:!1,modelValue:A.value,"onUpdate:modelValue":e[2]||(e[2]=l=>A.value=l),onSubmit:ee},{default:i(()=>[s("div",Ce,[a(d,{type:"dropdown",name:"branchIds",label:"الفروع",placeholder:"اختر الفروع التي يعمل بها الموظف",options:I.value,multiple:""},null,8,["options"])]),a(t(b),{type:"submit",label:"تحديث الفروع",class:"p-2 px-4 m-auto text-center font-sm",style:{background:"var(--background)"},loading:N.value},null,8,["loading"])]),_:1},8,["modelValue"])]),default:i(()=>[a(t(c),{field:"id",sortable:"",header:"كود الفرع"}),a(t(c),{field:"branch_name",sortable:"",header:"اسم الفرع"})]),_:1},8,["filters","value"])])):(r(),D(pe,{key:0}))]),_:1},8,["visible"]),s("div",Ae,[s("div",Fe,[a(t(ue),{home:G.value,model:j.value},null,8,["home","model"])]),a(t(me)),$.value?(r(),D(ve,{key:0,class:"fadeinright animation-duration-500 animation-iteration-1 my-4"},{default:i(()=>[V("تم الحذف بنجاح")]),_:1})):y("",!0),L.value?(r(),p("div",Te,[a(t(H),{filters:T.value,"onUpdate:filters":e[9]||(e[9]=l=>T.value=l),ref_key:"dt",ref:E,"export-filename":"الموظفين",stripedRows:"",value:x.value,selection:m.value,"onUpdate:selection":e[10]||(e[10]=l=>m.value=l),stateStorage:"session",stateKey:"employees-state-session",paginator:"",rows:10,rowsPerPageOptions:[10,15,20,50],filterDisplay:"menu",dataKey:"id",removableSort:"",globalFilterFields:["id","name"],tableStyle:"min-width: 50rem"},{header:i(()=>[s("div",De,[s("div",Ve,[t(C)(h.value,"تسجيل و تعديل الموظفين",f.value)?(r(),D(t(b),{key:0,type:"button",class:"mb-3 lg:mb-0 mx-2",onClick:e[6]||(e[6]=l=>t(_)("/employee/create")),label:"تسجيل موظف"})):y("",!0),t(C)(h.value,"تسجيل و تعديل الموظفين",f.value)?(r(),D(t(b),{key:1,type:"button",disabled:m.value.length==0,severity:"danger",class:"mb-3 lg:mb-0 mx-2",label:"حذف المحدد"},null,8,["disabled"])):y("",!0)]),Be,s("span",Ne,[$e,a(t(P),{modelValue:T.value.global.value,"onUpdate:modelValue":e[7]||(e[7]=l=>T.value.global.value=l),placeholder:"بحث شامل"},null,8,["modelValue"])])])]),empty:i(()=>[a(t(Q),{severity:"info"},{default:i(()=>[V("لا يوجد موظفين")]),_:1})]),paginatorend:i(()=>[a(t(b),{type:"button",icon:"pi pi-download",onClick:e[8]||(e[8]=l=>O(l)),text:""})]),footer:i(()=>[V(" في المجموع هناك "+g(x.value?x.value.length:0)+" موظفين ",1)]),default:i(()=>[a(t(c),{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(t(c),{field:"id",sortable:"",header:"الكود"}),a(t(c),{field:"name",sortable:"",header:"الاسم",style:{width:"28%"}},{body:i(l=>[s("p",null,g(l.data.name),1)]),_:1}),a(t(c),{field:"phone",header:"الهاتف",style:{width:"20%"}}),a(t(c),{field:"salary_per_hour",sortable:"",header:"الراتب",style:{width:"23%"}},{body:i(l=>[s("p",null,g(l.data.salary)+"ج.م / شهر",1)]),_:1}),a(t(c),{field:"created_at",sortable:"",header:"تاريخ التسجيل",style:{width:"40%"}},{body:i(l=>[s("p",null,g(t(Y).format(l.data.created_at)),1)]),_:1}),a(t(c),{header:"تعديل",style:{width:"14%"}},{body:i(l=>[s("div",Ie,[t(C)(h.value,"تسجيل و تعديل الموظفين",f.value)?(r(),p("span",{key:0,class:"material-symbols-outlined cursor-pointer hoverIcon textColor text-3xl p-2 borderRound",onClick:R=>{m.value=[{id:l.data.id}],J(R)}}," delete_forever ",8,Me)):y("",!0),t(C)(h.value,"تسجيل و تعديل الموظفين",f.value)?(r(),p("span",{key:1,onClick:R=>t(_)(`/employee/update/${l.data.id}`),class:"material-symbols-outlined cursor-pointer hoverIcon mx-2 textColor text-3xl p-2 borderRound"}," edit ",8,Ee)):y("",!0),s("span",{class:"material-symbols-outlined cursor-pointer hoverIcon textColor text-3xl p-2 borderRound",onClick:R=>z(l.data.id)}," visibility ",8,Re)])]),_:1})]),_:1},8,["filters","value","selection"])])):y("",!0)])],64)}}});export{He as default};
