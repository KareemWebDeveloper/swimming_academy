import{d as pe,u as he,j as ve,r as i,o as be,k as fe,l as _e,C as ge,a as c,c as p,b as o,w as l,e as t,g as s,m as E,f as C,F as ae,h as S,s as b,q as ye,t as m,n as P,p as A,v as oe,x as we,y as xe,z as v,A as y,B as ke}from"./index-54b3e273.js";import{s as Q,a as W,b as Ce}from"./inlinemessage.esm-9b16a9f3.js";import{s as d}from"./column.esm-188ee393.js";import{s as Se}from"./successMsg-2def3ef6.js";import{i as F}from"./isEmployeeAuthorizedFor-df272e7f.js";import"./index.esm-8fb1d516.js";/* empty css                                                   */const Ae={class:"text-center"},De=s("span",{style:{color:"rgba(220, 18, 18, 0.759)"},class:"material-symbols-outlined text-6xl"}," warning ",-1),Ve=s("h3",{style:{color:"rgba(220, 18, 18, 0.759)"}},"لا يمكن حذف المدربين التاليين بسبب وجود اشتراكات نشطة",-1),Fe={key:0,class:"failedDeletions"},Te={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},Ne={class:"hidden md:my-2 lg:my-0 md:flex",style:{color:"black"}},Ue={class:"p-input-icon-left"},$e=s("i",{class:"pi pi-search"},null,-1),Ie={class:"flex align-items-center w-full"},Me={key:0,class:"line-through"},Be={key:1},Re={class:"p-2",style:{color:"black"}},Ee={class:"flex justify-content-between p-2"},Le={key:1,class:"branchDetails"},Oe={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},je={class:"flex align-items-center"},qe={style:{color:"black"}},ze={key:0,style:{background:"rgba(0, 128, 0, 0.932)"},class:"w-4 text-center p-2 borderRound m-auto"},Ke={key:1,style:{"background-color":"rgba(255, 0, 0, 0.684)"},class:"w-4 text-center p-2 borderRound m-auto"},He={class:"p-input-icon-left"},Pe=s("i",{class:"pi pi-search"},null,-1),Qe={class:"attachBranches"},We={class:"flex justify-content-between"},Ze={class:"w-12 md:w-10 my-5 m-auto p-2 md:p-5 branchesList",style:{direction:"rtl"}},Ge={class:"w-full m-auto flex justify-content-center p-4 MargAutoMob padding-1-breadcrumbs",style:{direction:"ltr"}},Je={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},Xe={class:"flex align-items-center"},Ye=s("h3",{class:"hidden md:my-2 lg:my-0 md:flex"},"المدربين",-1),et={class:"p-input-icon-left"},tt=s("i",{class:"pi pi-search"},null,-1),at={class:"flex align-items-center"},ot=["onClick"],lt=["onClick"],st=["onClick"],ht=pe({__name:"coachesList",setup(nt){const{push:D,currentRoute:Z}=he(),le=ve(),G=i(!1),se=i(!1),L=i(!1),T=i(!1),N=i(!1),O=i(!1),j=i(!1),h=i(),f=i([]),q=i(!1),J=i([]);J.value=[{label:"المدربين",route:"/coaches",to:"/coaches"},{label:"عرض المدربين",route:"/coaches",to:"/coaches"}];const ne=i({icon:"pi pi-home",to:"/"}),ie=n=>{le.require({target:n.currentTarget,message:"هل متأكد أنك تريد حذف هذا المدرب ؟",icon:"pi pi-exclamation-triangle",acceptLabel:"نعم",rejectLabel:"لا",accept:()=>{te()},reject:()=>{}})},X=i([]),z=i([]),w=i(),_=i(),K=i([]),U=i(),$=i({global:{value:null,matchMode:v.CONTAINS},branch_name:{operator:y.AND,constraints:[{value:null,matchMode:v.STARTS_WITH}]},id:{operator:y.AND,constraints:[{value:null,matchMode:v.EQUALS}]}}),I=i({global:{value:null,matchMode:v.CONTAINS},"branch.branch_name":{operator:y.AND,constraints:[{value:null,matchMode:v.STARTS_WITH}]},"customer.customer_name":{operator:y.AND,constraints:[{value:null,matchMode:v.EQUALS}]}}),M=i({global:{value:null,matchMode:v.CONTAINS},name:{operator:y.AND,constraints:[{value:null,matchMode:v.CONTAINS}]},phone:{operator:y.AND,constraints:[{value:null,matchMode:v.STARTS_WITH}]},id:{operator:y.AND,constraints:[{value:null,matchMode:v.EQUALS}]}}),re={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0,timeZone:"Africa/Cairo",locale:"ar"},ce=new Intl.DateTimeFormat("ar",re),B=()=>{S.get("http://127.0.0.1:8000/api/coaches").then(n=>{console.log(n.data),w.value=n.data.coaches,G.value=!0,w.value.forEach(e=>{e.created_at=new Date(e.created_at)}),me()}).catch(n=>{console.log(n)})},Y=()=>{S.get("http://127.0.0.1:8000/api/branches").then(n=>{console.log(n.data),n.data.branches.forEach(e=>{K.value.push({label:e.branch_name,value:e.id})}),se.value=!0}).catch(n=>{console.log(n)})},ee=n=>{N.value=!1,L.value=!0,S.get(`http://127.0.0.1:8000/api/coach/${n}`).then(e=>{h.value=e.data.coach,h.value.numberOfSubscriptions=e.data.activeSubscriptions.length,U.value={branchIds:[]},e.data.coach.branches.forEach(r=>{U.value.branchIds.push(r.id)}),N.value=!0,console.log(h.value),console.log(K.value)}).catch(e=>{console.log(e)})},de=n=>{O.value=!0,S.put(`http://127.0.0.1:8000/api/coach/attachBranches/${h.value.id}`,n).then(e=>{console.log(e),O.value=!1,N.value=!1,ee(h.value.id)}).catch(e=>{console.log(e)})},ue=()=>{j.value=!0,console.log(_.value);let n={subscriptions:[]};_.value.forEach(e=>{e.subscriptions.forEach(r=>{n.subscriptions.push({id:r.id,coach_id:r.coach_id})})}),console.log(n),S.post("http://127.0.0.1:8000/api/subscriptionCoaches/update",n).then(e=>{j.value=!1,te()}).catch(e=>{console.log(e)})},me=()=>{w.value.forEach(n=>{let e={name:`كابتن / ${n.name}`,code:n.id};X.value.push(e)})},te=()=>{console.log(f.value);let n=[];f.value.forEach(r=>{n.push(r.id)});let e={coaches_ids:n};S.post("http://127.0.0.1:8000/api/coachBulkDelete",e).then(r=>{console.log(r),q.value=!0,T.value=!1,f.value=[],B(),setTimeout(()=>{q.value=!1},4500)}).catch(r=>{r.response.data.failed_deletions&&(console.log("coaches have subsciptions !"),console.log(r.response.data.failed_deletions),_.value=r.response.data.failed_deletions,T.value=!0,r.response.data.failed_deletions.forEach(a=>{z.value.push(a.coach_id)})),console.log(r.response.data)})},g=i(),x=i("admin");be(()=>{fe().then(n=>{n==!1?_e().then(e=>{e==!1&&(localStorage.removeItem("SwimmingToken"),location.reload(),console.log("not employee"),D({path:"/login",query:Z.value.query})),g.value=e.permissions,x.value="employee",F(g.value,"عرض المدربين",x.value)||(localStorage.removeItem("SwimmingToken"),console.log("not authorized"),location.reload(),D({path:"/login",query:Z.value.query})),console.log(g.value),B(),Y()}):(B(),Y())})});const R=i(),H=()=>{R.value.exportCSV()};return(n,e)=>{const r=ge("FormKit");return c(),p(ae,null,[o(t(oe),{visible:T.value,"onUpdate:visible":e[3]||(e[3]=a=>T.value=a),maximizable:"",onAfterHide:e[4]||(e[4]=a=>{_.value=[],z.value=[],B()}),modal:"",header:"تنبيه",style:{width:"60vw"},breakpoints:{"960px":"75vw","641px":"100vw"}},{footer:l(()=>[s("div",Ee,[o(t(b),{type:"button",severity:"danger",class:"mb-3 lg:mb-0 mx-2",loading:j.value,onClick:ue,label:"حاول مجدداً"},null,8,["loading"])])]),default:l(()=>[s("div",Ae,[De,Ve,_.value.length>0?(c(),p("div",Fe,[(c(!0),p(ae,null,ye(_.value,(a,k)=>(c(),p("div",{key:k,class:"surface-100 my-3 p-3 borderRound"},[o(t(Q),{filters:I.value,"onUpdate:filters":e[2]||(e[2]=u=>I.value=u),ref_for:!0,ref_key:"dt",ref:R,stripedRows:"",value:a.subscriptions,paginator:"",rows:10,rowsPerPageOptions:[10,20,50],filterDisplay:"menu",dataKey:"id",removableSort:"",globalFilterFields:["branch.branch_name","customer.customer_name"],tableStyle:"min-width: 50rem"},{header:l(()=>[s("div",Te,[s("h3",Ne,"اشتراكات كابتن / "+m(_.value[k].coach_name),1),s("span",Ue,[$e,o(t(P),{modelValue:I.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=u=>I.value.global.value=u),placeholder:"بحث شامل"},null,8,["modelValue"])])])]),empty:l(()=>[o(t(W),{severity:"info"},{default:l(()=>[A("لا يوجد اشتراكات")]),_:1})]),paginatorend:l(()=>[o(t(b),{type:"button",icon:"pi pi-download",onClick:e[1]||(e[1]=u=>H(u)),text:""})]),footer:l(()=>[s("h4",Re," في المجموع هناك "+m(a?a.subscriptions.length:0)+" مشتركين ",1)]),default:l(()=>[o(t(d),{field:"customer.customer_name",sortable:"",header:"اسم اللاعب",style:{"min-width":"10rem"}}),o(t(d),{field:"branch.branch_name",sortable:"",header:"الفرع"}),o(t(d),{field:"number_of_sessions",header:"الحصص المتبقية",style:{"min-width":"11rem"}},{body:l(u=>[s("p",null,m(u.data.number_of_sessions)+" حصص",1)]),_:1}),o(t(d),{field:"category_name",sortable:"",header:"نوع التمرين",style:{"min-width":"10rem"}},{body:l(u=>[s("p",null,m(u.data.category_name),1)]),_:1}),o(t(d),{field:"expiration_date",sortable:"",header:"موعد الانتهاء",style:{"min-width":"11rem"}},{body:l(u=>[s("p",null,m(u.data.expiration_date),1)]),_:1}),o(t(d),{header:"تغيير المدرب",style:{"min-width":"17rem"}},{body:l(u=>[s("div",Ie,[o(t(Ce),{modelValue:u.data.coach_id,"onUpdate:modelValue":V=>u.data.coach_id=V,options:X.value,optionLabel:"name",optionValue:"code",placeholder:"اختر مدرب جديد",class:"p-column-filter",style:{"min-width":"15rem"},showClear:!0},{option:l(V=>[z.value.includes(V.option.code)?(c(),p("p",Me,m(V.option.name),1)):(c(),p("p",Be,m(V.option.name),1))]),_:2},1032,["modelValue","onUpdate:modelValue","options"])])]),_:1})]),_:2},1032,["filters","value","globalFilterFields"])]))),128))])):C("",!0)])]),_:1},8,["visible"]),o(t(oe),{visible:L.value,"onUpdate:visible":e[10]||(e[10]=a=>L.value=a),maximizable:"",modal:"",header:"الفروع التي يعمل بها",style:{width:"60vw"},breakpoints:{"960px":"75vw","641px":"100vw"}},{footer:l(()=>[s("div",We,[o(t(b),{type:"button",class:"mb-3 lg:mb-0 mx-2",onClick:e[9]||(e[9]=a=>t(D)(`/coach/update/${h.value.id}`)),label:"تعديل"})])]),default:l(()=>[N.value?(c(),p("div",Le,[o(t(Q),{filters:$.value,"onUpdate:filters":e[8]||(e[8]=a=>$.value=a),paginator:"",rows:10,rowsPerPageOptions:[10,15,20,50],ref_key:"dt",ref:R,stripedRows:"",value:h.value.branches,filterDisplay:"menu",dataKey:"id",removableSort:"",globalFilterFields:["id","branch_name"],tableStyle:"min-width: 50rem"},{header:l(()=>[s("div",Oe,[s("div",je,[s("h3",qe,"كابتن / "+m(h.value.name),1)]),h.value.numberOfSubscriptions>0?(c(),p("h3",ze,"يشترك معه "+m(h.value.numberOfSubscriptions)+" أعضاء",1)):(c(),p("h3",Ke," ليس لديه مشتركين")),s("span",He,[Pe,o(t(P),{modelValue:$.value.global.value,"onUpdate:modelValue":e[5]||(e[5]=a=>$.value.global.value=a),placeholder:"بحث شامل"},null,8,["modelValue"])])])]),empty:l(()=>[o(t(W),{severity:"info"},{default:l(()=>[A("لا يوجد فروع")]),_:1})]),paginatorend:l(()=>[o(t(b),{type:"button",icon:"pi pi-download",onClick:e[6]||(e[6]=a=>H(a)),text:""})]),footer:l(()=>[o(r,{type:"form",actions:!1,modelValue:U.value,"onUpdate:modelValue":e[7]||(e[7]=a=>U.value=a),onSubmit:de},{default:l(()=>[s("div",Qe,[o(r,{type:"dropdown",name:"branchIds",label:"الفروع",placeholder:"اختر الفروع التي يعمل بها المدرب",options:K.value,multiple:""},null,8,["options"])]),o(t(b),{type:"submit",label:"تحديث الفروع",class:"p-2 px-4 m-auto text-center font-sm",style:{background:"var(--background)"},loading:O.value},null,8,["loading"])]),_:1},8,["modelValue"])]),default:l(()=>[o(t(d),{field:"id",sortable:"",header:"كود الفرع"}),o(t(d),{field:"branch_name",sortable:"",header:"اسم الفرع"})]),_:1},8,["filters","value"])])):(c(),E(ke,{key:0}))]),_:1},8,["visible"]),s("div",Ze,[s("div",Ge,[o(t(we),{home:ne.value,model:J.value},null,8,["home","model"])]),o(t(xe)),q.value?(c(),E(Se,{key:0,class:"fadeinright animation-duration-500 animation-iteration-1 my-4"},{default:l(()=>[A("تم الحذف بنجاح")]),_:1})):C("",!0),s("div",null,[o(t(Q),{filters:M.value,"onUpdate:filters":e[14]||(e[14]=a=>M.value=a),ref_key:"dt",ref:R,"export-filename":"المدربين",stripedRows:"",value:w.value,selection:f.value,"onUpdate:selection":e[15]||(e[15]=a=>f.value=a),stateStorage:"session",stateKey:"coaches-state-session",paginator:"",rows:10,rowsPerPageOptions:[10,15,20,50],filterDisplay:"menu",loading:!G.value,dataKey:"id",removableSort:"",globalFilterFields:["id","name"],tableStyle:"min-width: 50rem"},{header:l(()=>[s("div",Je,[s("div",Xe,[t(F)(g.value,"تسجيل و تعديل المدربين",x.value)?(c(),E(t(b),{key:0,type:"button",class:"mb-3 lg:mb-0 mx-2",onClick:e[11]||(e[11]=a=>t(D)("/coach/create")),label:"تسجيل مدرب"})):C("",!0),t(F)(g.value,"تسجيل و تعديل المدربين",x.value)?(c(),E(t(b),{key:1,type:"button",disabled:f.value.length==0,severity:"danger",class:"mb-3 lg:mb-0 mx-2",label:"حذف المحدد"},null,8,["disabled"])):C("",!0)]),Ye,s("span",et,[tt,o(t(P),{modelValue:M.value.global.value,"onUpdate:modelValue":e[12]||(e[12]=a=>M.value.global.value=a),placeholder:"بحث شامل"},null,8,["modelValue"])])])]),loading:l(()=>[A(" برجاء الانتظار .. جاري تحميل بيانات المدربين ... ")]),empty:l(()=>[o(t(W),{severity:"info"},{default:l(()=>[A("لا يوجد مدربين")]),_:1})]),paginatorend:l(()=>[o(t(b),{type:"button",icon:"pi pi-download",onClick:e[13]||(e[13]=a=>H(a)),text:""})]),footer:l(()=>[A(" في المجموع هناك "+m(w.value?w.value.length:0)+" مدربين ",1)]),default:l(()=>[o(t(d),{selectionMode:"multiple",headerStyle:"width: 3rem"}),o(t(d),{field:"id",sortable:"",header:"الكود"}),o(t(d),{field:"name",sortable:"",header:"الاسم",style:{width:"28%"}},{body:l(a=>[s("p",null,"كابتن / "+m(a.data.name),1)]),_:1}),o(t(d),{field:"phone",header:"الهاتف",style:{width:"20%"}}),o(t(d),{field:"salary_per_hour",sortable:"",header:"الراتب",style:{width:"23%"}},{body:l(a=>[s("p",null,m(a.data.salary_per_hour)+"ج.م / ساعة",1)]),_:1}),o(t(d),{field:"created_at",sortable:"",header:"تاريخ التسجيل",style:{width:"40%"}},{body:l(a=>[s("p",null,m(t(ce).format(a.data.created_at)),1)]),_:1}),o(t(d),{header:"تعديل",style:{width:"14%"}},{body:l(a=>[s("div",at,[t(F)(g.value,"تسجيل و تعديل المدربين",x.value)?(c(),p("span",{key:0,class:"material-symbols-outlined cursor-pointer hoverIcon textColor text-3xl p-2 borderRound",onClick:k=>{f.value=[{id:a.data.id}],ie(k)}}," delete_forever ",8,ot)):C("",!0),t(F)(g.value,"تسجيل و تعديل المدربين",x.value)?(c(),p("span",{key:1,onClick:k=>t(D)(`/coach/update/${a.data.id}`),class:"material-symbols-outlined cursor-pointer hoverIcon mx-2 textColor text-3xl p-2 borderRound"}," edit ",8,lt)):C("",!0),s("span",{class:"material-symbols-outlined cursor-pointer hoverIcon textColor text-3xl p-2 borderRound",onClick:k=>ee(a.data.id)}," visibility ",8,st)])]),_:1})]),_:1},8,["filters","value","selection","loading"])])])],64)}}});export{ht as default};
