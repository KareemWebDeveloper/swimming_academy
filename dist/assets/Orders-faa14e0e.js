import{d as z,u as H,j as K,r,o as P,k as Q,l as Z,C as G,a as d,c as p,g as c,b as o,e as s,m as J,w as n,f as g,h as $,x as W,y as X,p as w,F as Y,q as ee,t as m,n as te,s as f,z as h,A as y}from"./index-54b3e273.js";import{a as ae,b as le,s as oe}from"./inlinemessage.esm-9b16a9f3.js";import{s as x}from"./column.esm-188ee393.js";import{s as se}from"./successMsg-2def3ef6.js";import{s as ne}from"./calendar.esm-ee3de14d.js";import{i as re}from"./isEmployeeAuthorizedFor-df272e7f.js";import"./index.esm-8fb1d516.js";/* empty css                                                   */const ce={class:"w-12 md:w-10 my-5 m-auto p-2 md:p-5 branchesList",style:{direction:"rtl"}},ue={class:"w-full m-auto flex justify-content-center p-4 MargAutoMob padding-1-breadcrumbs",style:{direction:"ltr"}},ie={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},de=c("h3",{class:"hidden md:my-2 lg:my-0 md:flex"},"تقرير المبيعات و المشتريات",-1),me={class:"flex align-content-center justify-content-center"},pe={class:"flex"},he={key:0,class:"mx-2"},ve={key:1,class:"mx-2"},_e={key:2,class:"mx-2"},fe={key:3,class:"mx-2"},be={key:4,class:"mx-2"},ge={class:"p-input-icon-left"},ye=c("i",{class:"pi pi-search"},null,-1),xe={class:""},we={class:"py-2"},Ce={class:"textColor text-center mb-3"},ke={class:"text-center textColor"},De={style:{background:"rgba(0, 128, 0, 0.932)"},class:"p-1 px-3 borderRound"},Oe=z({__name:"Orders",setup(Ae){const{push:k,currentRoute:D}=H();K();const A=r(!1);r(!1);const O=r(!1);r(!1);const B=r(!0),I=r(!1);r(),r();const v=r([]),C=r(0),F=r([]);F.value=[{label:"تقرير الايرادات",route:"/revenues",to:"/revenues"}];const U=r({icon:"pi pi-home",to:"/"}),i=r({global:{value:null,matchMode:h.CONTAINS},branch:{operator:y.AND,constraints:[{value:null,matchMode:h.CONTAINS}]},product:{operator:y.AND,constraints:[{value:null,matchMode:h.CONTAINS}]},type:{operator:y.AND,constraints:[{value:null,matchMode:h.CONTAINS}]},total_price:{operator:y.AND,constraints:[{value:null,matchMode:h.EQUALS}]},created_at:{operator:y.AND,constraints:[{value:null,matchMode:h.DATE_AFTER},{value:null,matchMode:h.DATE_BEFORE}]},id:{operator:y.AND,constraints:[{value:null,matchMode:h.EQUALS}]}}),L={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0,timeZone:"Africa/Cairo",locale:"ar"},R=new Intl.DateTimeFormat("ar",L),N=()=>{$.get("http://127.0.0.1:8000/api/orders").then(t=>{t.data.orders.forEach(a=>{v.value.push({branch:a.branch_id?a.branch.branch_name:"مجموع الفروع",product:a.product.product_name,created_at:new Date(a.created_at),type:a.order_type=="buy"?"مشتريات":"مبيعات",count:a.count,total_price:a.total_price})}),_(),B.value=!1,A.value=!0,console.log(v.value)}).catch(t=>{console.log(t)})},T=r(["مجموع الفروع"]),q=[],V=()=>{$.get("http://127.0.0.1:8000/api/branches").then(t=>{console.log(t.data),t.data.branches.forEach(a=>{T.value.push(a.branch_name),q.push({label:a.branch_name,value:a.id})}),O.value=!0}).catch(t=>{console.log(t)})},S=r(),_=()=>{let t=v.value,a=!0,b=0;console.log(t),i.value.created_at.constraints.forEach(e=>{e.value&&(a=!1,e.matchMode=="dateAfter"&&t.length>0&&(t=t.filter(l=>l.created_at>new Date(e.value))),e.matchMode=="dateBefore"&&t.length>0&&(t=t.filter(l=>l.created_at<new Date(e.value))),e.matchMode=="dateIs"&&t.length>0&&(e.value=new Date(e.value),e.value.setHours(0,0,0,0),t=t.filter(l=>{console.log(l),console.log(l.created_at,"from inside filter");const u=new Date(l.created_at);return u.setHours(0,0,0,0),u.getTime()==e.value.getTime()})),e.matchMode=="dateIsNot"&&t.length>0&&(e.value=new Date(e.value),e.value.setHours(0,0,0,0),t=t.filter(l=>{const u=new Date(l.created_at);return u.setHours(0,0,0,0),u.getTime()!==e.value.getTime()})))}),i.value.type.constraints.forEach(e=>{e.value&&(a=!1,t.length>0&&(t=t.filter(l=>l.type.includes(e.value))))}),a?(v.value.forEach(e=>{b+=parseFloat(e.total_price)}),C.value=b):(t.forEach(e=>{b+=parseFloat(e.total_price)}),C.value=b)},M=r(),E=r("admin");P(()=>{Q().then(t=>{t==!1?Z().then(a=>{a==!1&&(localStorage.removeItem("SwimmingToken"),location.reload(),k({path:"/login",query:D.value.query})),M.value=a.permissions,E.value="employee",re(M.value,"الحسابات المالية",E.value)||(localStorage.removeItem("SwimmingToken"),location.reload(),k({path:"/login",query:D.value.query})),V(),N()}):(V(),N())})});const j=()=>{S.value.exportCSV()};return(t,a)=>{const b=G("FormKit");return d(),p("div",ce,[c("div",ue,[o(s(W),{home:U.value,model:F.value},null,8,["home","model"])]),o(s(X)),c("div",null,[I.value?(d(),J(se,{key:0,class:"fadeinright animation-duration-500 animation-iteration-1 my-4"},{default:n(()=>[w("تم الحذف بنجاح")]),_:1})):g("",!0),o(s(oe),{filters:i.value,"onUpdate:filters":a[2]||(a[2]=e=>i.value=e),loading:!A.value,ref_key:"dt",ref:S,"export-filename":"تقرير المبيعات و المشتريات",stripedRows:"",value:v.value,filterDisplay:"menu",paginator:"",rows:10,rowsPerPageOptions:[10,20,50,100],dataKey:"id",removableSort:"",globalFilterFields:["branch","product","type"],tableStyle:"min-width: 50rem"},{header:n(()=>[c("div",ie,[de,c("div",me,[(d(!0),p(Y,null,ee(i.value.created_at.constraints,(e,l)=>(d(),p("div",pe,[e.value&&e.matchMode=="dateIsNot"?(d(),p("p",he,"المبيعات و المشتريات ما عدا "+m(new Date(e.value).toLocaleDateString()),1)):g("",!0),e.value&&e.matchMode=="dateIs"?(d(),p("p",ve,"المبيعات و المشتريات في "+m(new Date(e.value).toLocaleDateString()),1)):g("",!0),e.value&&e.matchMode=="dateAfter"?(d(),p("p",_e,"المبيعات و المشتريات بعد "+m(new Date(e.value).toLocaleDateString()),1)):g("",!0),e.value&&e.matchMode=="dateBefore"?(d(),p("p",fe,"المبيعات و المشتريات قبل "+m(new Date(e.value).toLocaleDateString()),1)):g("",!0),i.value.created_at.constraints[l+1]&&i.value.created_at.constraints[l+1].value?(d(),p("p",be," مع ")):g("",!0)]))),256))]),c("span",ge,[ye,o(s(te),{modelValue:i.value.global.value,"onUpdate:modelValue":a[0]||(a[0]=e=>i.value.global.value=e),placeholder:"بحث شامل"},null,8,["modelValue"])])])]),empty:n(()=>[o(s(ae),{severity:"info"},{default:n(()=>[w("غير موجود")]),_:1})]),paginatorend:n(()=>[o(s(f),{type:"button",icon:"pi pi-download",onClick:a[1]||(a[1]=e=>j(e)),text:""})]),footer:n(()=>[c("div",we,[c("h4",Ce,"في المجموع هناك "+m(v.value?v.value.length:0),1),c("h3",ke,[w("اجمالي : "),c("span",De,m(C.value.toFixed(2))+" ج.م",1)])])]),default:n(()=>[o(s(x),{field:"product",sortable:"",header:"المنتج",style:{width:"15%"}}),o(s(x),{field:"type",header:"النوع"},{filter:n(({filterModel:e,filterCallback:l})=>[o(s(le),{modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,onChange:u=>l(),options:["مشتريات","مبيعات"],placeholder:"اختر النوع",class:"p-column-filter noDropDownFilterOptions",style:{"min-width":"12rem"},showClear:!0},null,8,["modelValue","onUpdate:modelValue","onChange"])]),filterapply:n(({filterCallback:e})=>[o(s(f),{type:"button",onClick:l=>{e(),_()},class:"mb-3 lg:mb-0 mx-2",label:"تفعيل"},null,8,["onClick"])]),filterclear:n(({filterCallback:e})=>[o(s(f),{type:"button",onClick:l=>{e(),_()},class:"mb-3 lg:mb-0 mx-2",label:"الغاء",outlined:""},null,8,["onClick"])]),default:n(()=>[w("'' ")]),_:1}),o(s(x),{field:"created_at",filterField:"created_at",dataType:"date",sortable:"",header:"تاريخ الدفع",style:{width:"22%"}},{body:n(e=>[c("p",null,m(s(R).format(e.data.created_at)),1)]),filter:n(({filterModel:e})=>[o(s(ne),{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,dateFormat:"mm/dd/yy",placeholder:"أختر التاريخ ",mask:"99/99/9999"},null,8,["modelValue","onUpdate:modelValue"])]),filterapply:n(({filterCallback:e})=>[o(s(f),{type:"button",onClick:l=>{e(),_()},class:"mb-3 lg:mb-0 mx-2",label:"تفعيل"},null,8,["onClick"])]),filterclear:n(({filterCallback:e})=>[o(s(f),{type:"button",onClick:l=>{e(),_()},class:"mb-3 lg:mb-0 mx-2",label:"الغاء",outlined:""},null,8,["onClick"])]),_:1}),o(s(x),{field:"branch",header:"الفرع"},{filter:n(({filterModel:e,filterCallback:l})=>[c("div",xe,[o(b,{type:"dropdown",modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,id:"branch",validation:"required",name:"branch",label:"الفرع",placeholder:"اختر الفرع",options:T.value},null,8,["modelValue","onUpdate:modelValue","options"])])]),filterapply:n(({filterCallback:e})=>[o(s(f),{type:"button",onClick:l=>{e(),_()},class:"mb-3 lg:mb-0 mx-2",label:"تفعيل"},null,8,["onClick"])]),filterclear:n(({filterCallback:e})=>[o(s(f),{type:"button",onClick:l=>{e(),_()},class:"mb-3 lg:mb-0 mx-2",label:"الغاء",outlined:""},null,8,["onClick"])]),_:1}),o(s(x),{field:"count",sortable:"",header:"الكمية"},{body:n(e=>[c("p",null,m(e.data.count)+" قطعة",1)]),_:1}),o(s(x),{field:"total_price",sortable:"",header:"السعر"},{body:n(e=>[c("p",null,m(e.data.total_price.toFixed(2))+" ج.م",1)]),_:1})]),_:1},8,["filters","loading","value"])])])}}});export{Oe as default};
