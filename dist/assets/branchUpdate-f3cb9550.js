import{d as N,u as T,r,o as I,k as V,l as F,C as R,a as c,c as h,g as t,m as z,f as v,t as U,b as s,w as g,h as f,e as A,s as D}from"./index-5ed95cfa.js";import{s as $}from"./successMsg-575c06f8.js";import{i as j}from"./isEmployeeAuthorizedFor-df272e7f.js";/* empty css                                                   */const J={class:"w-12 md:w-10 m-auto p-2 md:p-5 branches"},K=t("h1",{class:"p-4 text-center textColor"},"تعديل فرع",-1),M={class:"w-8 m-auto"},O={key:1,class:"px-3 py-2 textColor text-center borderRound error"},L={key:0},P={class:"mt-3"},G=t("div",{class:"flex align-items-center"},[t("label",{for:"branchName",class:"px-3 py-1 text-white text-sm"},"اسم الفرع")],-1),H={class:"mt-3"},Q=t("div",{class:"flex align-items-center"},[t("label",{for:"branchName",class:"px-3 py-1 text-white text-sm"},"أيام العمل")],-1),W={class:"w-full m-auto repeater"},X={class:"flex grid w-full"},Y={class:"col-12 flex grid w-full mt-3"},Z={class:"flex grid w-full"},le=N({__name:"branchUpdate",setup(ee){const{push:d,currentRoute:u}=T(),_=r([]),l=r(),b=r(!1),p=r(!1),y=r(!1),x=r(!1),m=r(),i=r(!1),w=parseInt(u.value.params.id),k=()=>{f.get(`https://akademia.website/api/branch/${w}`).then(o=>{l.value=o.data.branch;let e=[];l.value.categories=l.value.categories.map(a=>{const{category_id:n,...q}=a.pivot;return{categoryId:n,...q}}),l.value.categories.forEach((a,n)=>{l.value.categories[n].session_prices=JSON.parse(a.session_prices)}),l.value.working_days.forEach(a=>{e.push(a.day)}),l.value.working_days=e,y.value=!0,console.log(l.value)}).catch(o=>{console.log(o)})},E=o=>{i.value=!0,console.log(o),o.categories.forEach((e,a)=>{let n=JSON.stringify(e.session_prices);o.categories[a].session_prices=n,console.log(o,"req after stringfy"),console.log(n,"jsonString")}),f.put(`https://akademia.website/api/updateBranch/${w}`,o).then(e=>{console.log(e.data),i.value=!1,p.value=!1,b.value=!0,window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{d("/branches")},1600)}).catch(e=>{window.scrollTo({top:0,behavior:"smooth"}),i.value=!1,p.value=!0,e.response.data.message.includes("The branch name has already been taken")?m.value="هذا الفرع موجود بالفعل":m.value=e.response.data.message,console.log(e)})},S=()=>{f.get("https://akademia.website/api/categories").then(o=>{console.log(o.data),o.data.categories.forEach(e=>{_.value.push({label:e.category_name,value:e.id})}),x.value=!0}).catch(o=>{console.log(o)})},B=r(),C=r("admin");return I(()=>{V().then(o=>{o==!1?F().then(e=>{e==!1&&(localStorage.removeItem("SwimmingToken"),location.reload(),console.log("not employee"),d({path:"/login",query:u.value.query})),B.value=e.permissions,C.value="employee",j(B.value,"تسجيل و تعديل الفروع",C.value)||(localStorage.removeItem("SwimmingToken"),console.log("not authorized"),location.reload(),d({path:"/login",query:u.value.query})),k(),S()}):(k(),S())})}),(o,e)=>{const a=R("FormKit");return c(),h("div",J,[K,t("div",M,[b.value?(c(),z($,{key:0,class:"fadeinright animation-duration-1000 animation-iteration-1"})):v("",!0),p.value?(c(),h("h5",O,U(m.value),1)):v("",!0)]),y.value&&x.value?(c(),h("div",L,[s(a,{type:"form",modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=n=>l.value=n),actions:!1,onSubmit:E},{default:g(()=>[t("div",P,[G,s(a,{"prefix-icon":"text",id:"branchName",type:"text",label:"اسم الفرع",placeholder:"أدخل اسم الفرع",name:"branch_name",validation:"required|length:3"})]),t("div",H,[Q,s(a,{type:"dropdown","outer-class":"col-12",name:"working_days",label:"أيام العمل",placeholder:"اختر أيام العمل المتاحة لهذا الفرع",options:["السبت","الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة"],multiple:"true",validation:"required"})]),t("div",W,[s(a,{id:"repeater",name:"categories",type:"repeater",label:"نوع التمرينة"},{default:g(({index:n})=>[s(a,{type:"dropdown",name:"categoryId",label:`${n+1}. نوع التمرين`,placeholder:"اختر نوع تمرينة",options:_.value,validation:"required"},null,8,["label","options"]),t("div",X,[s(a,{type:"text",name:"duration",number:"float","outer-class":"col-12 md:col-6",label:"مدة التمرينة",placeholder:"أدخل مدة التمرينة بالساعة","prefix-icon":"number",validation:"required|min:0"}),s(a,{type:"text",name:"price_per_session",number:"float","outer-class":"col-12 md:col-6",label:"سعر التمرينة",placeholder:"أدخل سعر التمرينة","prefix-icon":"number",validation:"required|min:0"}),t("div",Y,[s(a,{id:"repeater",name:"session_prices",type:"repeater",label:"عروض علي أسعار التمارين"},{default:g(({index:q})=>[t("div",Z,[s(a,{type:"text",name:"sessions",number:"integer","outer-class":"col-12 md:col-6",label:"عدد الحصص",placeholder:"أدخل عدد الحصص","prefix-icon":"number",validation:"required|min:0"}),s(a,{type:"text",name:"price",number:"float","outer-class":"col-12 md:col-6",label:"السعر",placeholder:"أدخل سعر التمارين","prefix-icon":"dollar",validation:"required|min:0"})])]),_:2},1024)])])]),_:1})]),s(A(D),{type:"submit",class:"submitBtn",label:"حفظ",loading:i.value},null,8,["loading"])]),_:1},8,["modelValue"])])):v("",!0)])}}});export{le as default};
