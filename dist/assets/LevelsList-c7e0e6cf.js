import{d as H,u as P,j as W,r as l,o as Z,k as G,l as J,a as r,c as u,b as n,w as i,e as a,g as o,m as g,f as R,F as D,h as N,s as b,t as d,q as j,v as X,x as Y,y as ee,p as x,n as te,z as m,A as k,B as le}from"./index-54b3e273.js";import{a as ae,s as oe}from"./inlinemessage.esm-9b16a9f3.js";import{s as y}from"./column.esm-188ee393.js";import{s as se}from"./successMsg-2def3ef6.js";import{i as ne}from"./isEmployeeAuthorizedFor-df272e7f.js";import"./index.esm-8fb1d516.js";/* empty css                                                   */const ie={key:1,class:"branchDetails"},re={class:"text-center my-2"},ce={class:"flex align-items-center flex-wrap justify-content-center"},ue={class:"p-3 borderRound mx-2 my-2",style:{color:"#256029","background-color":"#c8e6c9d3"}},de={class:"flex justify-content-between"},me={class:"w-12 md:w-10 my-5 m-auto p-2 md:p-5 branchesList",style:{direction:"rtl"}},ve={class:"w-full m-auto flex justify-content-center p-4 MargAutoMob padding-1-breadcrumbs",style:{direction:"ltr"}},pe={key:1},fe={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},he={class:"flex align-items-center"},be=o("h3",{class:"hidden md:my-2 lg:my-0 md:flex"},"المستويات",-1),ye={class:"p-input-icon-left"},_e=o("i",{class:"pi pi-search"},null,-1),ge={class:"flex align-items-center"},xe=["onClick"],ke=["onClick"],we=["onClick"],Me=H({__name:"LevelsList",setup(Ce){const{push:v,currentRoute:T}=P(),q=W(),w=l(!1);l(!1);const C=l(!1);l(!1),l(!1),l(!1),l(!1);const S=l(!1);l(!1);const p=l(),c=l([]),A=l(!1),$=l([]);$.value=[{label:"المستويات",route:"/levels",to:"/levels"},{label:"عرض المستويات",route:"/levels",to:"/levels"}];const B=l({icon:"pi pi-home",to:"/"}),U=s=>{q.require({target:s.currentTarget,message:"هل متأكد أنك تريد حذف هذا المستوي ؟",icon:"pi pi-exclamation-triangle",acceptLabel:"نعم",rejectLabel:"لا",accept:()=>{M()},reject:()=>{}})},f=l();l([]),l(),l({global:{value:null,matchMode:m.CONTAINS},branch_name:{operator:k.AND,constraints:[{value:null,matchMode:m.STARTS_WITH}]},id:{operator:k.AND,constraints:[{value:null,matchMode:m.EQUALS}]}});const _=l({global:{value:null,matchMode:m.CONTAINS},level_name:{operator:k.AND,constraints:[{value:null,matchMode:m.CONTAINS}]},sublevels_count:{operator:k.AND,constraints:[{value:null,matchMode:m.EQUALS}]}}),E={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0,timeZone:"Africa/Cairo",locale:"ar"},z=new Intl.DateTimeFormat("ar",E),L=()=>{N.get("http://127.0.0.1:8000/api/levels").then(s=>{console.log(s.data),f.value=s.data.levels,w.value=!0,f.value.forEach(t=>{t.created_at=new Date(t.created_at)})}).catch(s=>{console.log(s)})},O=s=>{S.value=!1,C.value=!0,N.get(`http://127.0.0.1:8000/api/level/${s}`).then(t=>{p.value=t.data.level,S.value=!0,console.log(p.value)}).catch(t=>{console.log(t)})},M=()=>{console.log(c.value);let s=[];c.value.forEach(e=>{s.push(e.id)});let t={levels_ids:s};N.post("http://127.0.0.1:8000/api/levelsBulkDelete",t).then(e=>{console.log(e),A.value=!0,c.value=[],L(),setTimeout(()=>{A.value=!1},4500)}).catch(e=>{console.log(e.response.data)})},F=l(),I=l("admin");Z(()=>{G().then(s=>{s==!1?J().then(t=>{t==!1&&(localStorage.removeItem("SwimmingToken"),location.reload(),v({path:"/login",query:T.value.query})),F.value=t.permissions,I.value="employee",ne(F.value,"المستويات",I.value)||(localStorage.removeItem("SwimmingToken"),location.reload(),v({path:"/login",query:T.value.query})),L()}):L()})});const V=l(),K=()=>{V.value.exportCSV()};return(s,t)=>(r(),u(D,null,[n(a(X),{visible:C.value,"onUpdate:visible":t[1]||(t[1]=e=>C.value=e),maximizable:"",modal:"",header:"تفاصيل المستوي",style:{width:"65vw"},breakpoints:{"960px":"75vw","641px":"100vw"}},{footer:i(()=>[o("div",de,[n(a(b),{type:"button",class:"mb-3 lg:mb-0 mx-2",onClick:t[0]||(t[0]=e=>a(v)(`/level/update/${p.value.id}`)),label:"تعديل"})])]),default:i(()=>[S.value?(r(),u("div",ie,[o("h3",null,d(p.value.level_name),1),(r(!0),u(D,null,j(p.value.sublevels,(e,h)=>(r(),u("div",{key:h,class:"m-auto my-4"},[o("h2",re,d(e.sublevel_name),1),o("div",ce,[(r(!0),u(D,null,j(e.checkpoints,Q=>(r(),u("div",ue,[o("p",null,d(Q.checkpoint_name),1)]))),256))])]))),128))])):(r(),g(le,{key:0}))]),_:1},8,["visible"]),o("div",me,[o("div",ve,[n(a(Y),{home:B.value,model:$.value},null,8,["home","model"])]),n(a(ee)),A.value?(r(),g(se,{key:0,class:"fadeinright animation-duration-500 animation-iteration-1 my-4"},{default:i(()=>[x("تم الحذف بنجاح")]),_:1})):R("",!0),w.value?(r(),u("div",pe,[n(a(oe),{filters:_.value,"onUpdate:filters":t[5]||(t[5]=e=>_.value=e),ref_key:"dt",ref:V,"export-filename":"المستويات",stripedRows:"",value:f.value,selection:c.value,"onUpdate:selection":t[6]||(t[6]=e=>c.value=e),stateStorage:"session",stateKey:"levels-state-session",paginator:"",rows:10,rowsPerPageOptions:[10,15,20,50],filterDisplay:"menu",dataKey:"id",removableSort:"",globalFilterFields:["level_name","sublevels_count"],tableStyle:"min-width: 50rem",loading:!w.value},{header:i(()=>[o("div",fe,[o("div",he,[n(a(b),{type:"button",class:"mb-3 lg:mb-0 mx-2",onClick:t[2]||(t[2]=e=>a(v)("/levels/create")),label:"تسجيل مستوي"}),c.value.length==0?(r(),g(a(b),{key:0,type:"button",severity:"danger",class:"mb-3 lg:mb-0 mx-2",disabled:"",label:"حذف المحدد"})):(r(),g(a(b),{key:1,type:"button",class:"mb-3 lg:mb-0 mx-2",severity:"danger",onClick:M,label:"حذف المحدد"}))]),be,o("span",ye,[_e,n(a(te),{modelValue:_.value.global.value,"onUpdate:modelValue":t[3]||(t[3]=e=>_.value.global.value=e),placeholder:"بحث شامل"},null,8,["modelValue"])])])]),loading:i(()=>[x(" برجاء الانتظار .. جاري تحميل بيانات المستويات ... ")]),empty:i(()=>[n(a(ae),{severity:"info"},{default:i(()=>[x("لا يوجد مستويات")]),_:1})]),paginatorend:i(()=>[n(a(b),{type:"button",icon:"pi pi-download",onClick:t[4]||(t[4]=e=>K(e)),text:""})]),footer:i(()=>[x(" في المجموع هناك "+d(f.value?f.value.length:0)+" مستوي ",1)]),default:i(()=>[n(a(y),{selectionMode:"multiple",headerStyle:"width: 3rem"}),n(a(y),{field:"level_name",sortable:"",header:"المستوي",style:{width:"18%"}}),n(a(y),{field:"sublevels_count",header:"عدد المستويات الفرعية",style:{width:"25%"}},{body:i(e=>[o("p",null,d(e.data.sublevels_count)+" مستويات",1)]),_:1}),n(a(y),{field:"created_at",sortable:"",header:"تاريخ التسجيل",style:{width:"40%"}},{body:i(e=>[o("p",null,d(a(z).format(e.data.created_at)),1)]),_:1}),n(a(y),{header:"تعديل",style:{width:"14%"}},{body:i(e=>[o("div",ge,[o("span",{class:"material-symbols-outlined cursor-pointer hoverIcon textColor text-3xl p-2 borderRound",onClick:h=>{c.value=[{id:e.data.id}],U(h)}}," delete_forever ",8,xe),o("span",{onClick:h=>a(v)(`/level/update/${e.data.id}`),class:"material-symbols-outlined cursor-pointer hoverIcon mx-2 textColor text-3xl p-2 borderRound"}," edit ",8,ke),o("span",{class:"material-symbols-outlined cursor-pointer hoverIcon textColor text-3xl p-2 borderRound",onClick:h=>O(e.data.id)}," visibility ",8,we)])]),_:1})]),_:1},8,["filters","value","selection","loading"])])):R("",!0)])],64))}});export{Me as default};
