import{d as ye,u as xe,j as we,r as n,o as Se,k as Ce,l as ke,a as c,c as p,b as l,w as i,e as s,g as o,f,m as $,F as Ae,h as b,s as D,t as d,p as y,v as De,x as Te,i as x,y as Ve,n as le,z as w,A as L,B as Me}from"./index-54b3e273.js";import{s as B,a as ne}from"./inlinemessage.esm-9b16a9f3.js";import{s as u}from"./column.esm-188ee393.js";import{s as Fe}from"./successMsg-2def3ef6.js";import"./tag.esm-7eaa0099.js";import"./selectbutton.esm-6c460a53.js";import{i as $e}from"./isEmployeeAuthorizedFor-df272e7f.js";import"./index.esm-8fb1d516.js";/* empty css                                                   */const Le={key:1,class:"dialogTable"},je={class:"flex flex-column my-3"},qe=o("span",{style:{color:"rgba(220, 18, 18, 0.759)"},class:"material-symbols-outlined text-center text-6xl"}," warning ",-1),Ue={class:"text-center",style:{color:"rgba(220, 18, 18, 0.759)"}},Ee=o("h5",{class:"text-center"},"مع العلم أنه قد قام بحضور هذا التمارين اليوم!",-1),Ne={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},Oe={style:{color:"black"}},Re=o("h3",{style:{color:"black"}},"جدول حضور اليوم",-1),Be={class:"w-12 md:w-10 my-5 m-auto p-2 md:p-5 productsList",style:{direction:"rtl"}},Ie={class:"w-full m-auto flex justify-content-center p-4 MargAutoMob padding-1-breadcrumbs",style:{direction:"ltr"}},ze={key:0},He={class:"mt-3"},Ke=o("div",{class:"flex align-items-center"},[o("label",{for:"branch",class:"px-3 py-1 text-white text-sm"},"الفرع")],-1),Qe={class:"mt-3"},We=o("div",{class:"flex align-items-center"},[o("label",{for:"start_time",class:"px-3 py-1 text-white text-sm"},"موعد بدء التمرين")],-1),Ye={class:"mt-3"},Ge=o("div",{class:"flex align-items-center"},[o("label",{for:"duration",class:"px-3 py-1 text-white text-sm"},"مدة التمرين ( بالساعة )")],-1),Ze={key:1},Je={class:"flex justify-content-center my-5 pt-5 m-auto"},Xe={key:1},Pe={key:0,class:"px-3 my-2 fadeinup animation-duration-500 animation-iteration-1 py-2 textColor text-center borderRound error"},et={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},tt=o("h3",null,"تسجيل حضور اللاعبين",-1),at={class:"p-input-icon-left"},ot=o("i",{class:"pi pi-search"},null,-1),st={key:0},lt=["onClick"],nt=o("h3",{class:"text-center"},"تسجيل",-1),it=o("span",{class:"material-symbols-outlined mx-2 cursor-pointer text-3xl"}," assignment_turned_in ",-1),rt=[nt,it],ct={key:1},ut={class:""},dt={key:2},mt={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},pt=o("h3",null,"تسجيل حضور المدربين",-1),vt={class:"p-input-icon-left"},ht=o("i",{class:"pi pi-search"},null,-1),_t=["onClick"],gt=o("h3",{class:"text-center"},"تسجيل",-1),ft=o("span",{class:"material-symbols-outlined mx-2 cursor-pointer text-3xl"}," assignment_turned_in ",-1),bt=[gt,ft],Mt=ye({__name:"AttendanceList",setup(yt){const{push:I,currentRoute:z}=xe(),T=we(),j=n(!1),q=n(!1),m=n([]),S=n([]),C=n(!1),v=n(!1),U=n(!1),H=n(),V=n(),h=n(),K=n(!1),Q=n([]),W=n(),k=n(),E=n(),N=n(),Y=n([]),ie=n(!1),A=n("customers"),M=n(!1),F=n(!1),_=n(),G=n([]);G.value=[{label:"تسجيل الحضور",route:"/attendance",to:"/attendance"}];const re=n({icon:"pi pi-home",to:"/"});function Z(){const a=new Date,t=a.getHours().toString().padStart(2,"0"),e=a.getMinutes().toString().padStart(2,"0");W.value=`${t}:${e}`}const ce=(a,t,e)=>{if(!e){T.require({target:a.currentTarget,message:"من فضلك اختر الاشتراك أولاً",icon:"pi pi-exclamation-triangle",acceptLabel:"موافق",rejectLabel:" ",accept:()=>{},reject:()=>{}});return}T.require({target:a.currentTarget,message:`هل متأكد أنك تريد تحضير ${t} ؟`,icon:"pi pi-exclamation-triangle",acceptLabel:"نعم",rejectLabel:"لا",accept:()=>{X()},reject:()=>{}})},ue=(a,t,e,r,R)=>{if(!e){T.require({target:a.currentTarget,message:"من فضلك اختر نوع التمرين أولاً",icon:"pi pi-exclamation-triangle",acceptLabel:"موافق",rejectLabel:" ",accept:()=>{},reject:()=>{}});return}T.require({target:a.currentTarget,message:`هل متأكد أنك تريد تحضير كابتن / ${t} ؟`,icon:"pi pi-exclamation-triangle",acceptLabel:"نعم",rejectLabel:"لا",accept:()=>{r.length>0?(F.value=!0,M.value=!0,_.value=R,setTimeout(()=>{F.value=!1,console.log(F.value)},700)):P()},reject:()=>{}})},g=n({global:{value:null,matchMode:w.CONTAINS},customer_name:{operator:L.AND,constraints:[{value:null,matchMode:w.STARTS_WITH}]},id:{operator:L.AND,constraints:[{value:null,matchMode:w.EQUALS}]}}),J=n({global:{value:null,matchMode:w.CONTAINS},name:{operator:L.AND,constraints:[{value:null,matchMode:w.STARTS_WITH}]},id:{operator:L.AND,constraints:[{value:null,matchMode:w.EQUALS}]}}),de={weekday:"long",month:"long",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0,timeZone:"Africa/Cairo",locale:"ar"},me=new Intl.DateTimeFormat("ar",de),X=()=>{v.value=!0;let a=!1,t=[];if(m.value.forEach(e=>{e.chosenSubscription?t.push({customer_id:e.id,subscription_id:e.chosenSubscription}):(a=!0,U.value=!0)}),!a){U.value=!1;let e={branch_id:k.value,training_start_time:E.value,session_duration:N.value,customers:t};b.post("http://127.0.0.1:8000/api/bulkAttendance",e).then(r=>{console.log(r),C.value=!0,m.value=[],O(),v.value=!1,setTimeout(()=>{C.value=!1},4500)}).catch(r=>{m.value=[],console.log(r),v.value=!1})}},P=()=>{v.value=!0;let a=[];S.value.forEach(e=>{a.push(e.id)});let t={branch_id:k.value,category_id:S.value[0].sessionCategory,training_start_time:E.value,session_duration:N.value,coach_ids:a};b.post("http://127.0.0.1:8000/api/bulkAttendance",t).then(e=>{console.log(e),C.value=!0,m.value=[],O(),v.value=!1,M.value=!1,setTimeout(()=>{C.value=!1},4500)}).catch(e=>{m.value=[],console.log(e),v.value=!1})};function pe(a){const t=new Date,e=new Date(a),r=e.getFullYear(),R=e.getMonth(),_e=e.getDate(),ge=t.getFullYear(),fe=t.getMonth(),be=t.getDate();return r===ge&&R===fe&&_e===be}const ve=a=>{j.value=!0,E.value=a.training_start_time,k.value=a.branch_id,N.value=a.session_duration,O()},O=()=>{b.get(`http://127.0.0.1:8000/api/coaches/active/${k.value}`).then(a=>{console.log(a.data.coaches),V.value=a.data.coaches,b.get(`http://127.0.0.1:8000/api/customers/active/${k.value}`).then(t=>{console.log(t.data.customers),h.value=t.data.customers,he(),j.value=!1,q.value=!0}).catch(t=>{console.log(t)})}).catch(a=>{console.log(a)})},ee=()=>{b.get("http://127.0.0.1:8000/api/branches").then(a=>{console.log(a.data),a.data.branches.forEach(t=>{Q.value.push({label:t.branch_name,value:t.id})}),K.value=!0}).catch(a=>{console.log(a)})},te=()=>{b.get("http://127.0.0.1:8000/api/categories").then(a=>{console.log(a.data),a.data.categories.forEach(t=>{Y.value.push({label:t.category_name,value:t.id})}),ie.value=!0}).catch(a=>{console.log(a)})},he=()=>{h.value.forEach(a=>{a.subscriptionsOptions=[],a.subscriptions.forEach(t=>{t.is_private?a.subscriptionsOptions.push({label:`${t.category_name} - برايفت`,value:t.id}):a.subscriptionsOptions.push({label:`${t.category_name} - ${t.academy_name}`,value:t.id})})}),console.log(h.value)},ae=n(),oe=n(),se=n("admin");return Se(()=>{Ce().then(a=>{a==!1?ke().then(t=>{t==!1&&(localStorage.removeItem("SwimmingToken"),location.reload(),I({path:"/login",query:z.value.query})),oe.value=t.permissions,se.value="employee",$e(oe.value,"تسجيل الحضور",se.value)||(localStorage.removeItem("SwimmingToken"),location.reload(),I({path:"/login",query:z.value.query})),ee(),Z(),te()}):(ee(),Z(),te())})}),(a,t)=>(c(),p(Ae,null,[l(s(De),{visible:M.value,"onUpdate:visible":t[0]||(t[0]=e=>M.value=e),maximizable:"",modal:"",header:"تحذير",style:{width:"60vw"},breakpoints:{"960px":"75vw","641px":"100vw"}},{footer:i(()=>[l(s(D),{type:"button",loading:v.value,class:"mb-3 lg:mb-0 mx-2",onClick:P,label:"تسجيل حضور"},null,8,["loading"])]),default:i(()=>[F.value?(c(),$(Me,{key:0})):(c(),p("div",Le,[o("div",je,[qe,o("h3",Ue,"هل أنت متأكد أنك تريد تحضير كابتن / "+d(_.value.name)+" ؟",1),Ee]),l(s(B),{stripedRows:"",value:_.value.attendances,showGridlines:"",paginator:"",rows:10,rowsPerPageOptions:[10,20,50],filterDisplay:"menu",dataKey:"id",removableSort:"",globalFilterFields:["duration","category_name"],tableStyle:"min-width: 50rem"},{header:i(()=>[o("div",Ne,[o("h3",Oe,"كابتن / "+d(_.value.name),1),Re])]),footer:i(()=>[y(" في المجموع هناك "+d(_.value.attendances?_.value.attendances.length:0)+" مرات حضور اليوم ",1)]),default:i(()=>[l(s(u),{field:"branch.branch_name",sortable:"",header:"الفرع"}),l(s(u),{field:"category.category_name",sortable:"",header:"نوع التمرين"}),l(s(u),{field:"created_at",sortable:"",header:"موعد الحضور"},{body:i(e=>[o("p",null,d(new Date(e.data.created_at).getMinutes().toString().padStart(2,"0"))+" : "+d(new Date(e.data.created_at).getHours().toString().padStart(2,"0")),1)]),_:1})]),_:1},8,["value"])]))]),_:1},8,["visible"]),o("div",Be,[o("div",Ie,[l(s(Te),{home:re.value,model:G.value},null,8,["home","model"])]),K.value&&!q.value?(c(),p("div",ze,[l(s(x),{modelValue:H.value,"onUpdate:modelValue":t[1]||(t[1]=e=>H.value=e),type:"form",actions:!1,onSubmit:ve},{default:i(()=>[o("div",He,[Ke,l(s(x),{type:"dropdown",id:"branch",validation:"required",name:"branch_id",label:"الفرع",placeholder:"اختر الفرع الذي تريد تسجيل الحضور فيه",options:Q.value},null,8,["options"])]),o("div",Qe,[We,l(s(x),{type:"time",id:"start_time",label:"موعد بدء التمرين","outer-class":"col-12",name:"training_start_time",value:W.value,validation:"required"},null,8,["value"])]),o("div",Ye,[Ge,l(s(x),{type:"text",number:"float",id:"duration",label:"مدة التمرين","outer-class":"col-12",placeholder:"يرجي ادخال عدد ساعات التمرين",name:"session_duration",validation:"required"})]),l(s(D),{type:"submit",class:"submitBtn",label:"التالي",loading:j.value},null,8,["loading"])]),_:1},8,["modelValue"])])):f("",!0),l(s(Ve)),q.value?(c(),p("div",Ze,[o("div",Je,[A.value=="customers"?(c(),$(s(D),{key:0,type:"button",label:"تسجيل حضور المدربين",onClick:t[2]||(t[2]=e=>A.value="coaches")})):f("",!0),A.value=="coaches"?(c(),$(s(D),{key:1,type:"button",label:"تسجيل حضور المشتركين",onClick:t[3]||(t[3]=e=>A.value="customers")})):f("",!0)]),C.value?(c(),$(Fe,{key:0,class:"fadeinright animation-duration-500 animation-iteration-1 my-4"},{default:i(()=>[y("تم التسجيل بنجاح")]),_:1})):f("",!0),A.value=="customers"?(c(),p("div",Xe,[U.value?(c(),p("h5",Pe,"يرجي تحديد الاشتراكات أولاً")):f("",!0),l(s(B),{filters:g.value,"onUpdate:filters":t[5]||(t[5]=e=>g.value=e),ref_key:"dt",ref:ae,stripedRows:"",value:h.value,selection:m.value,"onUpdate:selection":t[6]||(t[6]=e=>m.value=e),paginator:"",rows:10,rowsPerPageOptions:[10,20,50],filterDisplay:"menu",dataKey:"id",removableSort:"",globalFilterFields:["id","customer_name"],tableStyle:"min-width: 50rem"},{header:i(()=>[o("div",et,[l(s(D),{type:"button",class:"mb-3 lg:mb-0 mx-2",onClick:X,loading:v.value,disabled:m.value.length==0,label:"تسجيل المحدد"},null,8,["loading","disabled"]),tt,o("span",at,[ot,l(s(le),{modelValue:g.value.global.value,"onUpdate:modelValue":t[4]||(t[4]=e=>g.value.global.value=e),placeholder:"بحث شامل"},null,8,["modelValue"])])])]),empty:i(()=>[l(s(ne),{severity:"info"},{default:i(()=>[y("لا يوجد مشتركين")]),_:1})]),footer:i(()=>[y(" في المجموع هناك "+d(h.value?h.value.length:0)+" أعضاء ",1)]),default:i(()=>[l(s(u),{selectionMode:"multiple",headerStyle:"width: 3rem"}),l(s(u),{field:"id",sortable:"",header:"الكود"}),l(s(u),{field:"customer_name",sortable:"",header:"اسم المشترك"}),l(s(u),{field:"subscriptions[0].expiration_date",sortable:"",header:"تاريخ انتهاء الاشتراك"},{body:i(e=>[o("p",null,d(e.data.subscriptions[0].expiration_date),1)]),_:1}),l(s(u),{field:"subscriptions[0].number_of_sessions",sortable:"",header:"الحصص المتبقية"},{body:i(e=>[o("p",null,d(e.data.subscriptions[0].number_of_sessions)+" حصص",1)]),_:1}),l(s(u),{header:"تسجيل الحضور",style:{"max-width":"20rem"}},{body:i(e=>[pe(e.data.last_attendance_date)?(c(),p("div",ct,[o("p",ut," تم تسجيل الحضور اليوم في "+d(s(me).format(new Date(e.data.last_attendance_date))),1)])):(c(),p("div",st,[l(s(x),{type:"dropdown",id:"branch",modelValue:e.data.chosenSubscription,"onUpdate:modelValue":r=>e.data.chosenSubscription=r,validation:"required",name:"subscription_id",label:"الاشتراك",placeholder:"اختر اشتراك اللاعب",options:e.data.subscriptionsOptions},null,8,["modelValue","onUpdate:modelValue","options"]),o("div",{class:"flex text-center justify-content-center align-items-center cursor-pointer hoverIcon textColor p-2 borderRound",onClick:r=>{m.value.push(e.data),ce(r,e.data.customer_name,e.data.chosenSubscription)}},rt,8,lt)]))]),_:1})]),_:1},8,["filters","value","selection"])])):(c(),p("div",dt,[l(s(B),{filters:J.value,"onUpdate:filters":t[8]||(t[8]=e=>J.value=e),ref_key:"dt",ref:ae,stripedRows:"",value:V.value,selection:S.value,"onUpdate:selection":t[9]||(t[9]=e=>S.value=e),paginator:"",rows:10,rowsPerPageOptions:[10,20,50],filterDisplay:"menu",dataKey:"id",removableSort:"",globalFilterFields:["id","name"],tableStyle:"min-width: 50rem"},{header:i(()=>[o("div",mt,[pt,o("span",vt,[ht,l(s(le),{modelValue:g.value.global.value,"onUpdate:modelValue":t[7]||(t[7]=e=>g.value.global.value=e),placeholder:"بحث شامل"},null,8,["modelValue"])])])]),empty:i(()=>[l(s(ne),{severity:"info"},{default:i(()=>[y("لا يوجد مدربين")]),_:1})]),footer:i(()=>[y(" في المجموع هناك "+d(V.value?V.value.length:0)+" مدربين ",1)]),default:i(()=>[l(s(u),{selectionMode:"multiple",headerStyle:"width: 3rem"}),l(s(u),{field:"id",sortable:"",header:"الكود"}),l(s(u),{field:"customer_name",sortable:"",header:"اسم المدرب"},{body:i(e=>[o("p",null,"كابتن / "+d(e.data.name),1)]),_:1}),l(s(u),{header:"تسجيل الحضور",style:{"max-width":"20rem"}},{body:i(e=>[l(s(x),{type:"autocomplete",id:"sessionCategory",modelValue:e.data.sessionCategory,"onUpdate:modelValue":r=>e.data.sessionCategory=r,validation:"required",name:"sessionCategory",label:"نوع التمرين",placeholder:"اختر نوع التمرين",options:Y.value},null,8,["modelValue","onUpdate:modelValue","options"]),o("div",{class:"flex text-center justify-content-center align-items-center cursor-pointer hoverIcon textColor p-2 borderRound",onClick:r=>{S.value.push(e.data),ue(r,e.data.name,e.data.sessionCategory,e.data.attendances,e.data)}},bt,8,_t)]),_:1})]),_:1},8,["filters","value","selection"])]))])):f("",!0)])],64))}});export{Mt as default};
