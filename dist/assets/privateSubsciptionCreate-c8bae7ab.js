import{d as se,u as oe,r as o,D as ie,o as ne,k as ce,l as re,C as de,a as n,c as r,b as s,w as _,e as d,g as e,m as R,f as c,t as x,F as ue,h as g,s as b,v as K,E as D}from"./index-5ed95cfa.js";import{s as me}from"./successMsg-575c06f8.js";import{s as H}from"./inputswitch.esm-9e5e7f7f.js";import{i as pe}from"./isEmployeeAuthorizedFor-df272e7f.js";/* empty css                                                   */const ve={class:"flex align-items-center justify-content-center"},_e={class:"flex align-items-center mx-5 justify-content-center flex-column"},he=e("div",{class:"flex align-items-center my-2"},[e("span",{class:"material-symbols-outlined mx-1 text-2xl"}," tag "),e("h4",null,"الكود")],-1),fe={class:"flex align-items-center mx-5 justify-content-center flex-column"},be=e("div",{class:"flex align-items-center my-2"},[e("h4",null,"الاسم"),e("span",{class:"material-symbols-outlined text-2xl"}," scuba_diving ")],-1),xe={key:0},ge={class:"flex align-items-center mx-5 justify-content-center flex-column"},ye=e("div",{class:"flex align-items-center my-2"},[e("span",{class:"material-symbols-outlined mx-1 text-2xl"}," calendar_month "),e("h4",null,"تاريخ انتهاء الاشتراك")],-1),we={class:"w-12 md:w-10 m-auto p-2 md:p-5 customers"},ke=e("h1",{class:"p-4 text-center textColor"},"تسجيل تمرين فردي",-1),Se={class:"w-8 m-auto"},Ce={key:1,class:"px-3 py-2 textColor text-center borderRound error"},Fe={class:"flex justify-content-center align-items-center my-3"},Te=e("h4",{class:"text-sm mx-2 textColor"},"العضو مسجل بالفعل",-1),Ve={key:0},Ie={class:"flex grid w-full"},De={class:"mt-3 col-12"},Be=e("div",{class:"flex align-items-center"},[e("label",{for:"name",class:"px-3 py-1 text-white text-sm"},"اسم المشترك")],-1),je={class:"mt-3 col-12 md:col-6"},Ee=e("div",{class:"flex align-items-center"},[e("label",{for:"mail",class:"px-3 py-1 text-white text-sm"},"البريد الالكتروني")],-1),$e={class:"mt-3 col-12 md:col-6"},Oe=e("div",{class:"flex align-items-center"},[e("label",{for:"phone",class:"px-3 py-1 text-white text-sm"},"رقم الهاتف")],-1),Re={class:"col-12 md:col-6"},ze=e("div",{class:"flex align-items-center"},[e("label",{for:"birthdate",class:"px-3 py-1 text-white text-sm"},"تاريخ الميلاد")],-1),Ue={class:"col-12 md:col-6"},qe=e("div",{class:"flex align-items-center"},[e("label",{for:"job",class:"px-3 py-1 text-white text-sm"},"الوظيفة")],-1),Pe={class:"col-12"},Ae=e("div",{class:"flex align-items-center"},[e("label",{for:"address",class:"px-3 py-1 text-white text-sm"},"عنوان المشترك")],-1),Ne={class:"col-12"},Le=e("div",{class:"flex align-items-center"},[e("label",{for:"gender",class:"px-3 py-1 text-white text-sm"},"الجنس")],-1),Me={key:1,class:"subscription w-full m-auto p-2 md:p-4 customers"},Je={class:"flex grid w-full"},Ke={key:0,class:"mt-3 col-12"},He=e("div",{class:"flex align-items-center"},[e("label",{for:"name",class:"px-3 py-1 text-white text-sm"},"المشترك")],-1),Ge={class:"col-12"},Qe=e("div",{class:"flex align-items-center"},[e("label",{for:"name",class:"px-3 py-1 text-white text-sm"},"الفرع")],-1),We={key:1,class:"flex grid w-full fadein animation-duration-300 animation-iteration-1"},Xe={class:"mt-3 col-12 md:col-6"},Ye=e("div",{class:"flex align-items-center"},[e("label",{for:"name",class:"px-3 py-1 text-white text-sm"},"المدرب")],-1),Ze={class:"mt-3 col-12 md:col-6"},et=e("div",{class:"flex align-items-center"},[e("label",{for:"name",class:"px-3 py-1 text-white text-sm"},"نوع التمرين")],-1),tt={class:"col-12 md:col-6"},at=e("div",{class:"flex align-items-center"},[e("label",{for:"subscription_date",class:"px-3 py-1 text-white text-sm"},"تاريخ بداية الاشتراك")],-1),lt={class:"col-12 md:col-6"},st=e("div",{class:"flex align-items-center"},[e("label",{for:"expiration_date",class:"px-3 py-1 text-white text-sm"},"تاريخ انتهاء الاشتراك")],-1),ot={class:"mt-3 col-12 md:col-6"},it=e("div",{class:"flex align-items-center"},[e("label",{for:"academy",class:"px-3 py-1 text-white text-sm"},"اسم الأكاديمية")],-1),nt={class:"mt-3 col-12 md:col-6"},ct=e("div",{class:"flex align-items-center"},[e("label",{for:"avail_freeze_days",class:"px-3 py-1 text-white text-sm"},"الأيام المتاحة للتجميد")],-1),rt={class:"mt-3 col-12 md:col-6"},dt=e("div",{class:"flex align-items-center"},[e("label",{for:"number_of_sessions",class:"px-3 py-1 text-white text-sm"},"عدد الحصص في الاشتراك")],-1),ut={class:"mt-3 col-12 md:col-6"},mt=e("div",{class:"flex align-items-center"},[e("label",{for:"sessions_per_week",class:"px-3 py-1 text-white text-sm"},"عدد الحصص في الاسبوع")],-1),pt={class:"w-full m-auto repeater"},vt={class:"flex grid w-full align-items-center"},_t=e("div",{class:"flex align-items-center"},[e("label",{for:"price",class:"px-3 py-1 text-white text-sm"},"السعر")],-1),ht={key:0,class:"fadein animation-duration-500 animation-iteration-1 text-center p-3 borderRound",style:{color:"#256029","background-color":"#c8e6c9d3"}},ft={key:0,class:"col-12 md:col-6 fadein animation-duration-500 animation-iteration-1"},bt=e("div",{class:"flex align-items-center"},[e("label",{for:"sessions_per_week",class:"px-3 py-1 text-white text-sm"},"الخصم ( اختياري )")],-1),xt={class:"col-12 m-auto flex justify-content-center"},gt=e("h4",{class:"text-white col-12 mb-2"},"طريقة الدفع",-1),yt={class:"flex grid w-full border-200 border-1 borderRound p-3"},wt={class:"col-12 md:col-6 m-auto flex justify-content-center"},kt={class:"col-12 md:col-6 m-auto flex justify-content-center"},St={class:"flex justify-content-center align-items-center my-3"},Ct=e("h4",{class:"text-sm mx-2 textColor"},"ابق في نفس الصفحة",-1),Ft={class:"flex align-items-center justify-content-center dialogForm"},Tt={class:"w-full m-auto repeater surface-400 p-2 borderRound",style:{background:"var(--background)"}},Vt={class:"flex grid w-full align-items-center"},It={key:0,class:"text-center p-2 text-white"},Dt={key:0,class:"px-3 py-2 my-3 textColor text-center borderRound error"},zt=se({__name:"privateSubsciptionCreate",setup(Bt){const{push:B,currentRoute:z}=oe(),U=o([]),h=o(),G=o(),u=o(),j=o([]),q=o([]),E=o([]),y=o(!1),m=o(),Q=o(!1),W=o(),C=o(!1),w=o(!1),F=o(!1),$=o(!1),T=o(!1),V=o(!1),O=o(!1),p=o(),P=o(!1),k=o(),S=o(!1),X=o(),I=o(!1),f=o(!1),A=o(!1),v=o(),Y=l=>{S.value=!0,console.log(l),l.birthdate=new Date(l.birthdate),l.birthdate=l.birthdate.toISOString().substr(0,19).replace("T"," "),g.post("https://akademia.website/api/createCustomer",l).then(t=>{X.value=t.data.customer,localStorage.setItem("waitingForSubscription",JSON.stringify(t.data.customer)),console.log(localStorage.getItem("waitingForSubscription")),S.value=!1,w.value=!1,y.value=!0,window.scrollTo({top:0,behavior:"smooth"}),C.value=!0,f.value=!0,setTimeout(()=>{y.value=!1},1600)}).catch(t=>{window.scrollTo({top:0,behavior:"smooth"}),S.value=!1,w.value=!0,t.response.data.message.includes("The phone has already been taken")?k.value="هذا الهاتف موجود بالفعل":t.response.data.message.includes("The email has already been taken")?k.value="هذا البريد الالكتروني موجود بالفعل":k.value=t.response.data.message,console.log(t)})},N=()=>{g.get("https://akademia.website/api/branches").then(l=>{console.log(l.data),G.value=l.data.branches,l.data.branches.forEach(t=>{U.value.push({label:t.branch_name,value:t.id})}),P.value=!0}).catch(l=>{console.log(l)})},Z=()=>new Promise(l=>{g.get(`https://akademia.website/api/coachesOfBranch/${u.value.branch_id}`).then(t=>{console.log(t.data),j.value=[],t.data.coaches.forEach(a=>{j.value.push({label:`كابتن / ${a.name}`,value:a.id})}),l(j.value)})}),ee=()=>new Promise(l=>{g.get(`https://akademia.website/api/categoriesOfBranch/${u.value.branch_id}`).then(t=>{console.log(t.data),E.value=[],t.data.categories.forEach(a=>{E.value.push({label:a.category_name,value:a.id})}),l(E.value)})}),te=l=>{F.value=!0;let t={};localStorage.getItem("waitingForSubscription")&&(t=JSON.parse(localStorage.getItem("waitingForSubscription"))),l.subscription_date=new Date(l.subscription_date),l.subscription_date=l.subscription_date.toISOString().substr(0,19).replace("T"," "),l.expiration_date=new Date(l.expiration_date),l.expiration_date=l.expiration_date.toISOString().substr(0,19).replace("T"," "),f.value&&C.value&&(l.customer_id=t.id),l.is_private=!0,h.value&&(l.subscription_type=h.value),h.value=="installments"&&(p.value.installments.forEach(a=>{a.due_date=new Date(a.due_date),a.due_date=a.due_date.toISOString().substr(0,19).replace("T"," ")}),l.installments=p.value.installments),console.log(l),g.post("https://akademia.website/api/createSubscription",l).then(a=>{m.value=a.data.subscription,t&&t.customer_name?m.value.customer_name=t.customer_name:m.value.customer_name=u.value.customer_name,F.value=!1,w.value=!1,y.value=!0,window.scrollTo({top:0,behavior:"smooth"}),I.value=!0,console.log(m.value),setTimeout(()=>{y.value=!1},1600)}).catch(a=>{window.scrollTo({top:0,behavior:"smooth"}),F.value=!1,w.value=!0,k.value=a.response.data.message,console.log(a)})},ae=()=>{v.value<=0?(V.value=!1,O.value=!1):O.value=!0};ie(p,()=>{v.value=u.value.price,p.value&&u.value.price&&(console.log(p.value),p.value.installments.forEach(l=>{l.amount&&(v.value=parseFloat(v.value)-parseFloat(l.amount),console.log(v.value))}))});const L=()=>{g.get("https://akademia.website/api/customers").then(l=>{console.log(l.data),l.data.customers.forEach(t=>{q.value.push({label:t.customer_name,value:t.id})}),A.value=!0}).catch(l=>{console.log(l)})},le=()=>{$.value?(localStorage.removeItem("waitingForSubscription"),C.value=!1,setTimeout(()=>{location.reload()},1e3)):(localStorage.removeItem("waitingForSubscription"),B("/privateSubscriptions"))},M=o(),J=o("admin");return ne(()=>{ce().then(l=>{l==!1?re().then(t=>{t==!1&&(localStorage.removeItem("SwimmingToken"),location.reload(),B({path:"/login",query:z.value.query})),M.value=t.permissions,J.value="employee",pe(M.value,"تسجيل و تعديل التمرينات الفردية",J.value)||(localStorage.removeItem("SwimmingToken"),location.reload(),B({path:"/login",query:z.value.query})),N(),L()}):(N(),L())})}),(l,t)=>{const a=de("FormKit");return n(),r(ue,null,[s(d(K),{visible:I.value,"onUpdate:visible":t[1]||(t[1]=i=>I.value=i),onAfterHide:le,modal:"",header:"بيانات الاشتراك",style:{width:"50vw"},breakpoints:{"960px":"75vw","641px":"100vw"}},{footer:_(()=>[s(d(b),{label:"تم",class:"px-4 py-1",onClick:t[0]||(t[0]=i=>I.value=!1),autofocus:""})]),default:_(()=>[e("div",ve,[e("div",_e,[he,e("p",null,x(m.value.customer_id),1)]),e("div",fe,[be,m.value.customer_name?(n(),r("p",xe,x(m.value.customer_name),1)):c("",!0)]),e("div",ge,[ye,e("p",null,x(new Date(m.value.expiration_date).toLocaleDateString()),1)])])]),_:1},8,["visible"]),e("div",we,[ke,e("div",Se,[y.value?(n(),R(me,{key:0,class:"fadeinright animation-duration-1000 animation-iteration-1"})):c("",!0),w.value?(n(),r("h5",Ce,x(k.value),1)):c("",!0)]),e("div",Fe,[s(d(H),{modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=i=>f.value=i)},null,8,["modelValue"]),Te]),f.value?f.value&&P.value&&A.value?(n(),r("div",Me,[s(a,{type:"form",modelValue:u.value,"onUpdate:modelValue":t[7]||(t[7]=i=>u.value=i),actions:!1,onSubmit:te},{default:_(()=>[e("div",Je,[f.value&&!C.value?(n(),r("div",Ke,[He,s(a,{type:"autocomplete",name:"customer_id",placeholder:"اختر المشترك الذي تريد تسجيله",label:"المشترك",options:q.value,validation:"required"},null,8,["options"])])):c("",!0),e("div",Ge,[Qe,s(a,{type:"autocomplete",validation:"required",name:"branch_id",placeholder:"اختر الفرع الذي سيحضر فيه المشترك",label:"الفرع",options:U.value},null,8,["options"])]),u.value.branch_id?(n(),r("div",We,[e("div",Xe,[Ye,s(a,{type:"dropdown",name:"coach_id","always-load-on-open":"true","empty-message":"لا يوجد مدربين لهذا الفرع",label:"المدرب",placeholder:"اختر المدرب الذي سيحضر معه المشترك",options:Z})]),e("div",Ze,[et,s(a,{type:"dropdown",name:"category_id",label:"نوع التمرين","empty-message":"لا يوجد تمارين في هذا الفرع",placeholder:"اختر نوع التمرين",options:ee})]),e("div",tt,[at,s(a,{type:"datepicker",name:"subscription_date",label:"تاريخ الاشتراك",id:"subscription_date",format:{date:"short"},validation:"required",value:new Date},null,8,["value"])]),e("div",lt,[st,s(a,{type:"datepicker",name:"expiration_date",label:"تاريخ الانتهاء",id:"expiration_date","min-date":new Date,validation:"required",format:{date:"short"}},null,8,["min-date"])]),e("div",ot,[it,s(a,{"prefix-icon":"text",id:"academy",type:"text",label:"اسم الأكاديمية",placeholder:"أدخل اسم الأكاديمية",name:"academy_name",validation:"required|length:2"})]),e("div",nt,[ct,s(a,{"prefix-icon":"number",number:"integer",id:"avail_freeze_days",type:"number",label:"أيام التجميد",placeholder:"أدخل الأيام المتاحة لتجميد الاشتراك",name:"avail_freeze_days",validation:"required|min:0"})]),e("div",rt,[dt,s(a,{"prefix-icon":"number",number:"integer",id:"number_of_sessions",type:"number",label:"عدد الحصص",placeholder:"أدخل عدد حصص الاشتراك ",name:"number_of_sessions",validation:"required|min:1"})]),e("div",ut,[mt,s(a,{"prefix-icon":"number",number:"integer",id:"sessions_per_week",type:"number",label:"عدد الحصص الاسبوعية",placeholder:"أدخل عدد الحصص في الاسبوع ",name:"sessions_per_week",validation:"required|min:1"})]),e("div",pt,[s(a,{id:"repeater",name:"training_schedules",type:"repeater","add-label":"اضافة موعد",label:"جدول المواعيد"},{default:_(({index:i})=>[e("div",vt,[s(a,{type:"dropdown","outer-class":"col-12 md:col-6",name:"day",label:`${i+1}. اليوم`,placeholder:"اختر اليوم",options:["السبت","الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة"],validation:"required"},null,8,["label"]),s(a,{type:"time",label:"موعد بدء التمرين","outer-class":"col-12 md:col-6",name:"time",value:"21:00",validation:"required"})])]),_:1})]),e("div",{class:D(["col-12",{"md:col-6":T.value}])},[_t,s(a,{"prefix-icon":"dollar",id:"price",type:"number",label:"سعر الاشتراك",placeholder:"أدخل سعر الاشتراك",name:"price",number:"float",validation:"required|min:1"}),Q.value?(n(),r("h5",ht,"السعر المسجل لهذا العدد من الحصص هو "+x(W.value)+" ج.م",1)):c("",!0)],2),T.value?(n(),r("div",ft,[bt,s(a,{"prefix-icon":"dollar",id:"sessions_per_week",type:"number",label:"الخصم",placeholder:"أدخل مبلغ الخصم بالجنية ",number:"float",name:"sale",validation:"min:0"})])):c("",!0),e("div",xt,[T.value?c("",!0):(n(),R(d(b),{key:0,type:"button",class:"",style:{background:"var(--background)"},label:"أدخل مبلغ خصم",onClick:t[3]||(t[3]=i=>T.value=!0)}))]),gt,e("div",yt,[e("div",wt,[s(d(b),{type:"button",class:D(["w-9",{activeButton:h.value=="cash"}]),label:"كاش",onClick:t[4]||(t[4]=i=>h.value="cash")},null,8,["class"])]),e("div",kt,[s(d(b),{type:"button",class:D(["w-9",{activeButton:h.value=="installments"}]),label:"تقسيط",onClick:t[5]||(t[5]=i=>{h.value="installments",V.value=!0})},null,8,["class"])])])])):c("",!0)]),e("div",St,[s(d(H),{modelValue:$.value,"onUpdate:modelValue":t[6]||(t[6]=i=>$.value=i)},null,8,["modelValue"]),Ct]),s(d(b),{type:"submit",class:"submitBtn my-5",label:"تسجيل الاشتراك",loading:F.value},null,8,["loading"])]),_:1},8,["modelValue"]),s(d(K),{visible:V.value,"onUpdate:visible":t[9]||(t[9]=i=>V.value=i),maximizable:"",class:"surface-100",modal:"",header:"تفاصيل الأقساط",breakpoints:{"900px":"70vw","641px":"100vw"}},{default:_(()=>[e("div",Ft,[s(a,{type:"form",modelValue:p.value,"onUpdate:modelValue":t[8]||(t[8]=i=>p.value=i),actions:!1,onSubmit:ae},{default:_(()=>[e("div",Tt,[s(a,{id:"repeater",name:"installments",type:"repeater","add-label":"اضافة قسط",label:"جدول التقسيط"},{default:_(({index:i})=>[e("div",Vt,[s(a,{"prefix-icon":"number",type:"number","outer-class":"col-12 md:col-6",name:"installment_number",label:`${i+1}. رقم القسط`,placeholder:"أدخل رقم القسط",validation:"required|min:0",value:i+1,number:"integer"},null,8,["label","value"]),e("div",{class:D(["col-12 md:col-6 flex flex-column",{"mt-1 md:mt-5":v.value}])},[s(a,{"prefix-icon":"dollar",name:"amount",type:"number",label:"مبلغ القسط",number:"float",placeholder:"أدخل مبلغ القسط المستحق",validation:"required|min:0"}),v.value?(n(),r("h5",It,"المتبقي من المبلغ : "+x(v.value.toFixed(2))+" ج.م",1)):c("",!0)],2),s(a,{type:"datepicker",name:"due_date","outer-class":"col-12 md:col-8",label:`${i+1}. تاريخ الاستحقاق`,id:i+1,value:new Date,"max-date":u.value.expiration_date,placeholder:"أدخل تاريخ استحقاق القسط","validation-label":"تاريخ الاستحقاق",validation:"required",format:{date:"short"}},null,8,["label","id","value","max-date"]),i==0?(n(),R(a,{key:0,type:"checkbox",label:"تم الدفع كمقدم",name:"paid",value:!1,validation:"","outer-class":"col-12 md:col-4 mt-5"})):c("",!0)])]),_:1})]),s(d(b),{type:"submit",class:"mt-3",label:"تسجيل الأقساط",loading:S.value,style:{background:"var(--fk-bg-button)"}},null,8,["loading"]),O.value?(n(),r("h5",Dt,"الأقساط ليست كافية لتغطية سعر الاشتراك !")):c("",!0)]),_:1},8,["modelValue"])])]),_:1},8,["visible"])])):c("",!0):(n(),r("div",Ve,[s(a,{type:"form",actions:!1,onSubmit:Y},{default:_(()=>[e("div",Ie,[e("div",De,[Be,s(a,{"prefix-icon":"avatarMan",id:"name",type:"text",label:"اسم المشترك",placeholder:"أدخل اسم المشترك",name:"customer_name",validation:"required|length:2"})]),e("div",je,[Ee,s(a,{"prefix-icon":"email",id:"mail",type:"email",label:"البريد الالكتروني",placeholder:"أدخل البريد الالكتروني",name:"customer_email",validation:"required|email"})]),e("div",$e,[Oe,s(a,{"prefix-icon":"telephone",id:"phone",type:"text",label:"رقم الهاتف",placeholder:"أدخل رقم هاتف المشترك",name:"customer_phone",validation:"required|length:10"})]),e("div",Re,[ze,s(a,{type:"datepicker",name:"birthdate",label:"تاريخ الميلاد",id:"birthdate",format:{date:"short"}})]),e("div",Ue,[qe,s(a,{"prefix-icon":"text",id:"job",type:"text",label:"الوظيفة",placeholder:"أدخل وظيفة المشترك ",name:"job",validation:"required"})]),e("div",Pe,[Ae,s(a,{"prefix-icon":"text",id:"address",type:"textarea",label:"العنوان",placeholder:"أدخل عنوان للمشترك ",name:"customer_address",validation:"required|length:3"})]),e("div",Ne,[Le,s(a,{id:"gender",type:"dropdown",options:[{label:"ذكر",value:"male"},{label:"أنثي",value:"female"}],label:"الجنس",placeholder:"أختر جنس المشترك ",name:"gender",validation:"required"})])]),s(d(b),{type:"submit",class:"submitBtn",label:"التالي",loading:S.value},null,8,["loading"])]),_:1})]))])],64)}}});export{zt as default};
