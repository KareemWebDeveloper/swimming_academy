import{d as ue,u as pe,j as me,r as s,o as ve,k as he,l as _e,C as be,a as d,c as u,b as o,w as c,e as i,g as l,f as p,m as fe,F as W,h as x,t as h,s as b,v as xe,x as ye,y as ge,p as R,q as we,n as De,z as y,A as T}from"./index-54b3e273.js";import{a as ke,b as Ce,s as Ee}from"./inlinemessage.esm-9b16a9f3.js";import{s as g}from"./column.esm-188ee393.js";import{s as Te}from"./successMsg-2def3ef6.js";import{s as Fe}from"./calendar.esm-ee3de14d.js";import{i as Ve}from"./isEmployeeAuthorizedFor-df272e7f.js";import"./index.esm-8fb1d516.js";/* empty css                                                   */const $e={key:0,class:"px-3 py-2 textColor text-center borderRound error"},Ae={class:"mt-3"},Ne=l("div",{class:"flex align-items-center"},[l("label",{for:"expense_name",class:"px-3 py-1 text-white text-sm"},"وصف المصروف")],-1),Se={class:"mt-3"},Ie=l("div",{class:"flex align-items-center"},[l("label",{for:"expense_cost",class:"px-3 py-1 text-white text-sm"},"تكلفة المصروف")],-1),Me={class:"mt-3"},Be=l("div",{class:"flex align-items-center"},[l("label",{for:"expense_type",class:"px-3 py-1 text-white text-sm"},"نوع المصروف")],-1),Re={key:1,class:"mt-3 fadein animation-duration-1000 animation-iteration-1"},Ue=l("div",{class:"flex align-items-center"},[l("label",{for:"automatic_payment_date",class:"px-3 py-1 text-white text-sm"},"موعد الدفع التلقائي")],-1),qe={class:"automaticPaymentDate"},Le=l("p",{class:"text-white text-center mb-3",style:{"font-size":"12px"}},"اختر اليوم الذي تريد أن يتم فيه دفع المصروف تلقائياً في كل شهر",-1),Oe={class:"mt-3"},je=l("div",{class:"flex align-items-center"},[l("label",{for:"branch",class:"px-3 py-1 text-white text-sm"},"الفرع")],-1),ze={class:"w-12 md:w-10 my-5 m-auto p-2 md:p-5 branchesList",style:{direction:"rtl"}},He={class:"w-full m-auto flex justify-content-center p-4 MargAutoMob padding-1-breadcrumbs",style:{direction:"ltr"}},Ke={key:0,class:"flex justify-content-center my-5 mx-auto"},Pe=l("i",{class:"pi pi-spin pi-spinner text-white",style:{"font-size":"2rem"}},null,-1),Qe=[Pe],Ze={key:1},Ge=l("h2",{class:"text-center my-5 text-white"},"انشاء تقرير المصروفات",-1),Je={class:"mt-3"},We=l("div",{class:"flex align-items-center"},[l("label",{for:"branch",class:"px-3 py-1 text-white text-sm"},"الفرع")],-1),Xe={key:2},Ye=l("h2",{class:"text-center my-3 text-white"},"تقرير المصروفات",-1),et={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},tt={class:"flex align-content-center justify-content-center"},at={class:"flex"},lt={key:0,class:"mx-2"},ot={key:1,class:"mx-2"},st={key:2,class:"mx-2"},nt={key:3,class:"mx-2"},it={key:4,class:"mx-2"},ct={class:"p-input-icon-left"},rt=l("i",{class:"pi pi-search"},null,-1),dt={class:"noDropDownFilterOptions"},ut={key:0,class:"flex align-items-center"},pt=["onClick"],mt=["onClick"],vt={class:"py-2"},ht={class:"textColor text-center mb-3"},_t={class:"text-center textColor"},bt={style:{background:"rgba(0, 128, 0, 0.932)"},class:"p-1 px-3 borderRound"},Tt=ue({__name:"Expenses",setup(ft){const{push:U,currentRoute:f}=pe(),X=me(),q=s(!1),$=s(!1),A=s(!1),Y=s(!1),k=s(!0),w=s(!1),N=s(!1),ee=s(!1),te=s(!1),L=s(!1);s(!1);const F=s();s([]);const S=s(!1),C=s(!1),O=s(),I=s(),m=s([]),M=s(0),D=s(),j=s([]);j.value=[{label:"تقرير المصروفات",route:"/expenses",to:"/expenses"}];const ae=s({icon:"pi pi-home",to:"/"}),le=(a,t)=>{X.require({target:a.currentTarget,message:"هل متأكد أنك تريد حذف هذا المصروف بشكل نهائي ؟",icon:"pi pi-exclamation-triangle",acceptLabel:"نعم",rejectLabel:"لا",accept:()=>{ie(t)},reject:()=>{}})};s();const v=s({global:{value:null,matchMode:y.CONTAINS},description:{operator:T.AND,constraints:[{value:null,matchMode:y.CONTAINS}]},type:{operator:T.AND,constraints:[{value:null,matchMode:y.CONTAINS}]},cost:{operator:T.AND,constraints:[{value:null,matchMode:y.EQUALS}]},created_at:{operator:T.AND,constraints:[{value:null,matchMode:y.DATE_AFTER},{value:null,matchMode:y.DATE_BEFORE}]},branch:{operator:T.AND,constraints:[{value:null,matchMode:y.CONTAINS}]}}),oe={weekday:"long",year:"numeric",month:"long",day:"numeric",hour12:!0,timeZone:"Africa/Cairo",locale:"ar"},se=new Intl.DateTimeFormat("ar",oe),V=a=>{x.get(`http://127.0.0.1:8000/api/expenses/${a}`).then(t=>{m.value=[];let r=new Date;t.data.expenses.forEach(e=>{m.value.push({id:e.id,description:e.expense_name,cost:e.expense_cost,type:e.expense_type=="constant"?"مصروفات ثابتة":"مصروفات متغيرة",automatic_payment_date:e.automatic_payment_date?`يوم ${e.automatic_payment_date} من كل شهر`:"لا يوجد",created_at:e.automatic_payment_date?new Date(r.setDate(e.automatic_payment_date)):new Date(e.created_at),branch:e.branch.branch_name})}),t.data.salaries&&t.data.salaries.forEach(e=>{m.value.push({id:e.id,description:e.coach_id?`دفع مرتب كابتن / ${e.coach.name}`:`دفع مرتب موظف / ${e.employee.name}`,cost:e.amount,type:"دفع مرتبات",automatic_payment_date:"لا يوجد",created_at:new Date(e.paid_date),branch:e.branch?e.branch.branch_name:"مجموع الفروع"})}),E(),$.value=!1,k.value=!1,q.value=!0,console.log(m.value)}).catch(t=>{console.log(t)})},z=[],H=s([{label:"كل الفروع",value:0}]),K=s([]),ne=s([]),P=()=>{x.get("http://127.0.0.1:8000/api/branches").then(a=>{console.log(a.data),a.data.branches.forEach(t=>{H.value.push({label:t.branch_name,value:t.id}),K.value.push({label:t.branch_name,value:t.id}),z.push({label:t.branch_name,value:t.id})}),A.value=!0}).catch(a=>{console.log(a)})},ie=a=>{x.delete(`http://127.0.0.1:8000/api/deleteExpense/${a}`).then(t=>{console.log(t.data),window.scrollTo({top:0,behavior:"smooth"}),S.value=!0,setTimeout(()=>{S.value=!1},5e3),V(D.value)}).catch(t=>{console.log(t)})},ce=a=>{C.value=!0,N.value?x.put(`http://127.0.0.1:8000/api/updateExpense/${a.id}`,a).then(t=>{console.log(t.data),V(D.value),L.value=!0,setTimeout(()=>{w.value=!1},1e3),N.value=!1,C.value=!1}).catch(t=>{console.log(t),C.value=!1}):x.post("http://127.0.0.1:8000/api/createExpense",a).then(t=>{console.log(t.data),V(D.value),L.value=!0,setTimeout(()=>{w.value=!1},1e3),C.value=!1}).catch(t=>{console.log(t)})},re=a=>{x.get(`http://127.0.0.1:8000/api/expense/${a.id}`).then(t=>{F.value=t.data.expense,w.value=!0,N.value=!0}).catch(t=>{console.log(t)})},Q=()=>{x.get("http://127.0.0.1:8000/api/academies").then(a=>{console.log(a.data),a.data.academies.forEach(t=>{ne.value.push({label:t.academy_name,value:t.id})}),Y.value=!0}).catch(a=>{console.log(a)})},B=a=>{if($.value=!0,D.value=a.branch_id,V(a.branch_id),a.branch_id==0)I.value="تقرير مصروفات كل الفروع";else{let t=z.filter(r=>r.value==a.branch_id);t=t[0].label,I.value=`تقرير مصروفات فرع ${t}`}},Z=s(),E=()=>{let a=m.value,t=!0,r=0;console.log(a),v.value.created_at.constraints.forEach(e=>{e.value&&(t=!1,e.matchMode=="dateAfter"&&a.length>0&&(a=a.filter(n=>n.created_at>new Date(e.value))),e.matchMode=="dateBefore"&&a.length>0&&(a=a.filter(n=>n.created_at<new Date(e.value))),e.matchMode=="dateIs"&&a.length>0&&(e.value=new Date(e.value),e.value.setHours(0,0,0,0),a=a.filter(n=>{console.log(n),console.log(n.created_at,"from inside filter");const _=new Date(n.created_at);return _.setHours(0,0,0,0),_.getTime()==e.value.getTime()})),e.matchMode=="dateIsNot"&&a.length>0&&(e.value=new Date(e.value),e.value.setHours(0,0,0,0),a=a.filter(n=>{const _=new Date(n.created_at);return _.setHours(0,0,0,0),_.getTime()!==e.value.getTime()})))}),v.value.type.constraints.forEach(e=>{e.value&&(t=!1,a.length>0&&(a=a.filter(n=>n.type.includes(e.value))))}),t?(m.value.forEach(e=>{r+=parseFloat(e.cost)}),M.value=r):(a.forEach(e=>{r+=parseFloat(e.cost)}),M.value=r)},G=s(),J=s("admin");ve(()=>{he().then(a=>{if(a==!1)_e().then(t=>{if(t==!1&&(localStorage.removeItem("SwimmingToken"),location.reload(),U({path:"/login",query:f.value.query})),G.value=t.permissions,J.value="employee",Ve(G.value,"الحسابات المالية",J.value)||(localStorage.removeItem("SwimmingToken"),location.reload(),U({path:"/login",query:f.value.query})),f.value.query.branchId){let r={branch_id:f.value.query.branchId};k.value=!1,B(r)}P(),Q()});else{if(f.value.query.branchId){let t={branch_id:f.value.query.branchId};k.value=!1,B(t)}P(),Q()}})});const de=()=>{Z.value.exportCSV()};return(a,t)=>{const r=be("FormKit");return d(),u(W,null,[o(i(xe),{visible:w.value,"onUpdate:visible":t[1]||(t[1]=e=>w.value=e),ref:"expenseDialog",class:"expensesDialog",maximizable:"",modal:"",header:"تسجيل مصروفات",style:{width:"65vw"},breakpoints:{"960px":"75vw","641px":"100vw"}},{footer:c(()=>[]),default:c(()=>[o(r,{modelValue:F.value,"onUpdate:modelValue":t[0]||(t[0]=e=>F.value=e),type:"form",actions:!1,onSubmit:ce},{default:c(()=>[ee.value?(d(),u("h5",$e,h(te.value),1)):p("",!0),l("div",Ae,[Ne,o(r,{"prefix-icon":"text",id:"expense_name",type:"text",label:"المصروف",placeholder:"يرجي ادخال وصف للمصروف الذي تريد انشاؤه",name:"expense_name",validation:"required|length:3"})]),l("div",Se,[Ie,o(r,{"prefix-icon":"dollar",id:"expense_cost",type:"number",number:"float",label:"تكلفة المصروف",placeholder:"يرجي ادخال تكلفة المصروف",name:"expense_cost",validation:"required|min:0"})]),l("div",Me,[Be,o(r,{id:"expense_type",type:"dropdown",label:"نوع المصروف",options:[{label:"ثابتة",value:"constant"},{label:"متغيرة",value:"variable"}],placeholder:"أختر نوع المصروف",name:"expense_type",validation:"required"})]),F.value.expense_type=="constant"?(d(),u("div",Re,[Ue,l("div",qe,[o(r,{"prefix-icon":"number",type:"number",number:"integer",name:"automatic_payment_date","outer-class":"col-12",label:"موعد الدفع التلقائي",id:"automatic_payment_date",value:new Date().getDate(),placeholder:"أدخل موعد الدفع التلقائي","validation-label":"موعد الدفع التلقائي",validation:"required|max:28"},null,8,["value"])]),Le])):p("",!0),l("div",Oe,[je,o(r,{type:"dropdown",id:"branch",validation:"required",value:D.value==0?null:D.value,name:"branch_id",label:"الفرع",placeholder:"اختر الفرع الذي سيتم تسجيل المصروف فيه",options:K.value},null,8,["value","options"])]),o(i(b),{type:"submit",class:"submitBtn",label:"تسجيل",loading:C.value},null,8,["loading"])]),_:1},8,["modelValue"])]),_:1},8,["visible"]),l("div",ze,[l("div",He,[o(i(ye),{home:ae.value,model:j.value},null,8,["home","model"])]),o(i(ge)),!A.value&&!i(f).query.branchId?(d(),u("div",Ke,Qe)):p("",!0),k.value&&A.value?(d(),u("div",Ze,[Ge,o(r,{modelValue:O.value,"onUpdate:modelValue":t[2]||(t[2]=e=>O.value=e),type:"form",actions:!1,onSubmit:B},{default:c(()=>[l("div",Je,[We,o(r,{type:"dropdown",id:"branch",validation:"required",name:"branch_id",label:"الفرع",placeholder:"اختر الفرع الذي تريد تقرير عنه",options:H.value},null,8,["options"])]),o(i(b),{type:"submit",class:"submitBtn",label:"التالي",loading:$.value},null,8,["loading"])]),_:1},8,["modelValue"])])):k.value?p("",!0):(d(),u("div",Xe,[S.value?(d(),fe(Te,{key:0,class:"fadeinright animation-duration-500 animation-iteration-1 my-4"},{default:c(()=>[R("تم الحذف بنجاح")]),_:1})):p("",!0),Ye,o(i(Ee),{filters:v.value,"onUpdate:filters":t[6]||(t[6]=e=>v.value=e),ref_key:"dt",ref:Z,"export-filename":I.value,stripedRows:"",value:m.value,filterDisplay:"menu",paginator:"",rows:10,loading:!q.value,rowsPerPageOptions:[10,20,50,100],dataKey:"id",removableSort:"",globalFilterFields:["branch","type","description","cost"],tableStyle:"min-width: 50rem"},{header:c(()=>[l("div",et,[o(i(b),{type:"button",class:"mb-2 lg:mb-0 mx-2",onClick:t[3]||(t[3]=e=>{w.value=!0}),label:"تسجيل مصروفات"}),l("div",tt,[(d(!0),u(W,null,we(v.value.created_at.constraints,(e,n)=>(d(),u("div",at,[e.value&&e.matchMode=="dateIsNot"?(d(),u("p",lt,"المصروفات ما عدا "+h(new Date(e.value).toLocaleDateString()),1)):p("",!0),e.value&&e.matchMode=="dateIs"?(d(),u("p",ot,"المصروفات في "+h(new Date(e.value).toLocaleDateString()),1)):p("",!0),e.value&&e.matchMode=="dateAfter"?(d(),u("p",st,"المصروفات بعد "+h(new Date(e.value).toLocaleDateString()),1)):p("",!0),e.value&&e.matchMode=="dateBefore"?(d(),u("p",nt,"المصروفات قبل "+h(new Date(e.value).toLocaleDateString()),1)):p("",!0),v.value.created_at.constraints[n+1]&&v.value.created_at.constraints[n+1].value?(d(),u("p",it," مع ")):p("",!0)]))),256))]),l("span",ct,[rt,o(i(De),{modelValue:v.value.global.value,"onUpdate:modelValue":t[4]||(t[4]=e=>v.value.global.value=e),placeholder:"بحث شامل"},null,8,["modelValue"])])])]),empty:c(()=>[o(i(ke),{severity:"info"},{default:c(()=>[R("غير موجود")]),_:1})]),paginatorend:c(()=>[o(i(b),{type:"button",icon:"pi pi-download",onClick:t[5]||(t[5]=e=>de(e)),text:""})]),footer:c(()=>[l("div",vt,[l("h4",ht,"في المجموع هناك "+h(m.value?m.value.length:0)+" مصادر مصروفات ",1),l("h3",_t,[R("اجمالي المصروفات : "),l("span",bt,h(M.value.toFixed(2))+" ج.م",1)])])]),default:c(()=>[o(i(g),{field:"description",header:"الوصف",style:{width:"18%"}}),l("div",dt,[o(i(g),{field:"type",header:"النوع",style:{width:"17%"}},{filter:c(({filterModel:e,filterCallback:n})=>[o(i(Ce),{modelValue:e.value,"onUpdate:modelValue":_=>e.value=_,onChange:_=>n(),options:["مصروفات ثابتة","مصروفات متغيرة","دفع مرتبات"],placeholder:"اختر طريقة دفع",class:"p-column-filter noDropDownFilterOptions",style:{"min-width":"12rem"},showClear:!0},null,8,["modelValue","onUpdate:modelValue","onChange"])]),filterapply:c(({filterCallback:e})=>[o(i(b),{type:"button",onClick:n=>{e(),E()},class:"mb-3 lg:mb-0 mx-2",label:"تفعيل"},null,8,["onClick"])]),filterclear:c(({filterCallback:e})=>[o(i(b),{type:"button",onClick:n=>{e(),E()},class:"mb-3 lg:mb-0 mx-2",label:"الغاء",outlined:""},null,8,["onClick"])]),_:1})]),o(i(g),{field:"created_at",filterField:"created_at",dataType:"date",sortable:"",header:"تاريخ التسجيل",style:{width:"22%"}},{body:c(e=>[l("p",null,h(i(se).format(new Date(e.data.created_at))),1)]),filter:c(({filterModel:e})=>[o(i(Fe),{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,dateFormat:"mm/dd/yy",placeholder:"أختر التاريخ ",mask:"99/99/9999"},null,8,["modelValue","onUpdate:modelValue"])]),filterapply:c(({filterCallback:e})=>[o(i(b),{type:"button",onClick:n=>{e(),E()},class:"mb-3 lg:mb-0 mx-2",label:"تفعيل"},null,8,["onClick"])]),filterclear:c(({filterCallback:e})=>[o(i(b),{type:"button",onClick:n=>{e(),E()},class:"mb-3 lg:mb-0 mx-2",label:"الغاء",outlined:""},null,8,["onClick"])]),_:1}),o(i(g),{field:"cost",sortable:"",header:"التكلفة"},{body:c(e=>[l("p",null,h(e.data.cost)+" ج.م",1)]),_:1}),o(i(g),{field:"automatic_payment_date",sortable:"",header:"تاريخ الدفع التلقائي",style:{width:"23%"}}),o(i(g),{field:"branch",header:"الفرع",style:{width:"13%"}}),o(i(g),{header:"تعديل"},{body:c(e=>[e.data.type!=="دفع مرتبات"?(d(),u("div",ut,[l("span",{class:"material-symbols-outlined cursor-pointer hoverIcon textColor text-3xl p-2 borderRound",onClick:n=>le(n,e.data.id)}," delete_forever ",8,pt),l("span",{onClick:n=>re(e.data),class:"material-symbols-outlined cursor-pointer hoverIcon mx-2 textColor text-3xl p-2 borderRound"}," edit ",8,mt)])):p("",!0)]),_:1})]),_:1},8,["filters","export-filename","value","loading"])]))])],64)}}});export{Tt as default};
