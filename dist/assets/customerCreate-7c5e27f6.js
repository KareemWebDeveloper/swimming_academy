import{d as pe,u as ve,r as o,D as Q,o as _e,k as he,l as fe,C as be,a as c,c as u,b as l,w as _,e as r,g as e,m as z,f as d,t as y,F as xe,h,s as b,v as X,E}from"./index-5ed95cfa.js";import{s as ge}from"./successMsg-575c06f8.js";import{s as Y}from"./inputswitch.esm-9e5e7f7f.js";/* empty css                                                   */const ye={class:"flex align-items-center justify-content-center"},we={class:"flex align-items-center mx-5 justify-content-center flex-column"},ke=e("div",{class:"flex align-items-center my-2"},[e("span",{class:"material-symbols-outlined mx-1 text-2xl"}," tag "),e("h4",null,"الكود")],-1),Se={class:"flex align-items-center mx-5 justify-content-center flex-column"},Ce=e("div",{class:"flex align-items-center my-2"},[e("h4",null,"الاسم"),e("span",{class:"material-symbols-outlined text-2xl"}," scuba_diving ")],-1),De={class:"flex align-items-center mx-5 justify-content-center flex-column"},Fe=e("div",{class:"flex align-items-center my-2"},[e("span",{class:"material-symbols-outlined mx-1 text-2xl"}," calendar_month "),e("h4",null,"تاريخ انتهاء الاشتراك")],-1),Ve={class:"w-12 md:w-10 m-auto p-2 md:p-5 customers"},Te=e("h1",{class:"p-4 text-center textColor"},"تسجيل اشتراك لعضو جديد",-1),Be={class:"w-8 m-auto"},Ie={key:1,class:"px-3 py-2 textColor text-center borderRound error"},Ee={class:"flex justify-content-center align-items-center my-3"},je=e("h4",{class:"text-sm mx-2 textColor"},"العضو مسجل بالفعل",-1),Oe={key:0},$e={class:"flex grid w-full"},Pe={class:"mt-3 col-12"},Re=e("div",{class:"flex align-items-center"},[e("label",{for:"name",class:"px-3 py-1 text-white text-sm"},"اسم المشترك")],-1),ze={class:"mt-3 col-12 md:col-6"},Ne=e("div",{class:"flex align-items-center"},[e("label",{for:"mail",class:"px-3 py-1 text-white text-sm"},"البريد الالكتروني")],-1),Ue={class:"mt-3 col-12 md:col-6"},Ae=e("div",{class:"flex align-items-center"},[e("label",{for:"phone",class:"px-3 py-1 text-white text-sm"},"رقم الهاتف")],-1),qe={class:"col-12 md:col-6"},Je=e("div",{class:"flex align-items-center"},[e("label",{for:"birthdate",class:"px-3 py-1 text-white text-sm"},"تاريخ الميلاد")],-1),Le={class:"col-12 md:col-6"},Me=e("div",{class:"flex align-items-center"},[e("label",{for:"job",class:"px-3 py-1 text-white text-sm"},"الوظيفة")],-1),Ke={class:"col-12"},He=e("div",{class:"flex align-items-center"},[e("label",{for:"address",class:"px-3 py-1 text-white text-sm"},"عنوان المشترك")],-1),We={class:"col-12"},Ge=e("div",{class:"flex align-items-center"},[e("label",{for:"gender",class:"px-3 py-1 text-white text-sm"},"الجنس")],-1),Qe={key:1,class:"subscription w-full m-auto p-2 md:p-4 customers"},Xe={class:"flex grid w-full"},Ye={key:0,class:"mt-3 col-12"},Ze=e("div",{class:"flex align-items-center"},[e("label",{for:"name",class:"px-3 py-1 text-white text-sm"},"المشترك")],-1),et={class:"mt-3 col-12"},tt=e("div",{class:"flex align-items-center"},[e("label",{for:"name",class:"px-3 py-1 text-white text-sm"},"الفرع")],-1),at={key:1,class:"flex grid w-full fadein animation-duration-300 animation-iteration-1"},st={class:"mt-3 col-12 md:col-6"},lt=e("div",{class:"flex align-items-center"},[e("label",{for:"name",class:"px-3 py-1 text-white text-sm"},"المدرب")],-1),ot={class:"mt-3 col-12 md:col-6"},it=e("div",{class:"flex align-items-center"},[e("label",{for:"name",class:"px-3 py-1 text-white text-sm"},"نوع التمرين")],-1),nt={class:"col-12 md:col-6"},ct=e("div",{class:"flex align-items-center"},[e("label",{for:"subscription_date",class:"px-3 py-1 text-white text-sm"},"تاريخ بداية الاشتراك")],-1),rt={class:"col-12 md:col-6"},dt=e("div",{class:"flex align-items-center"},[e("label",{for:"expiration_date",class:"px-3 py-1 text-white text-sm"},"تاريخ انتهاء الاشتراك")],-1),ut={class:"mt-3 col-12 md:col-6"},mt=e("div",{class:"flex align-items-center"},[e("label",{for:"academy",class:"px-3 py-1 text-white text-sm"},"الأكاديمية")],-1),pt={class:"mt-3 col-12 md:col-6"},vt=e("div",{class:"flex align-items-center"},[e("label",{for:"avail_freeze_days",class:"px-3 py-1 text-white text-sm"},"الأيام المتاحة للتجميد")],-1),_t={class:"mt-3 col-12 md:col-6"},ht=e("div",{class:"flex align-items-center"},[e("label",{for:"number_of_sessions",class:"px-3 py-1 text-white text-sm"},"عدد الحصص في الاشتراك")],-1),ft={class:"mt-3 col-12 md:col-6"},bt=e("div",{class:"flex align-items-center"},[e("label",{for:"sessions_per_week",class:"px-3 py-1 text-white text-sm"},"عدد الحصص في الاسبوع")],-1),xt={class:"w-full m-auto repeater"},gt={class:"flex grid w-full align-items-center"},yt=e("div",{class:"flex align-items-center"},[e("label",{for:"price",class:"px-3 py-1 text-white text-sm"},"السعر")],-1),wt={key:0,class:"fadein animation-duration-500 animation-iteration-1 text-center p-3 borderRound",style:{color:"#256029","background-color":"#c8e6c9d3"}},kt={key:0,class:"col-12 md:col-6 fadein animation-duration-500 animation-iteration-1"},St=e("div",{class:"flex align-items-center"},[e("label",{for:"sessions_per_week",class:"px-3 py-1 text-white text-sm"},"الخصم ( اختياري )")],-1),Ct={class:"col-12 m-auto flex justify-content-center"},Dt=e("h4",{class:"text-white col-12 mb-2"},"طريقة الدفع",-1),Ft={class:"flex grid w-full border-200 border-1 borderRound p-3"},Vt={class:"col-12 md:col-6 m-auto flex justify-content-center"},Tt={class:"col-12 md:col-6 m-auto flex justify-content-center"},Bt={class:"flex justify-content-center align-items-center my-3"},It=e("h4",{class:"text-sm mx-2 textColor"},"ابق في نفس الصفحة",-1),Et={class:"flex align-items-center justify-content-center dialogForm"},jt={class:"w-full m-auto repeater surface-400 p-2 borderRound",style:{background:"var(--background)"}},Ot={class:"flex grid w-full align-items-center"},$t={key:0,class:"text-center p-2 text-white"},Pt={key:0,class:"px-3 py-2 my-3 textColor text-center borderRound error"},qt=pe({__name:"customerCreate",setup(Rt){const{push:N,currentRoute:Z}=ve(),U=o([]),A=o([]),q=o([]),f=o(),J=o(),n=o(),j=o([]),O=o([]),w=o(!1),x=o(),F=o(!1),L=o(),g=o(!1),k=o(!1),V=o(!1),$=o(!1),T=o(!1),B=o(!1),P=o(!1),m=o(),M=o(!1),ee=o(!1),S=o(),C=o(!1),te=o(),R=o([]),I=o(!1),D=o(!1),p=o(),ae=a=>{C.value=!0,console.log(a),a.birthdate=new Date(a.birthdate),a.birthdate=a.birthdate.toISOString().substr(0,19).replace("T"," "),h.post("https://akademia.website/api/createCustomer",a).then(t=>{te.value=t.data.customer,localStorage.setItem("waitingForSubscription",JSON.stringify(t.data.customer)),console.log(localStorage.getItem("waitingForSubscription")),C.value=!1,k.value=!1,w.value=!0,window.scrollTo({top:0,behavior:"smooth"}),g.value=!0,setTimeout(()=>{w.value=!1},1600)}).catch(t=>{window.scrollTo({top:0,behavior:"smooth"}),C.value=!1,k.value=!0,t.response.data.message.includes("The phone has already been taken")?S.value="هذا الهاتف موجود بالفعل":t.response.data.message.includes("The email has already been taken")?S.value="هذا البريد الالكتروني موجود بالفعل":S.value=t.response.data.message,console.log(t)})},K=()=>{h.get("https://akademia.website/api/branches").then(a=>{console.log(a.data),J.value=a.data.branches,a.data.branches.forEach(t=>{U.value.push({label:t.branch_name,value:t.id})}),M.value=!0}).catch(a=>{console.log(a)})},H=()=>{h.get("https://akademia.website/api/academies").then(a=>{console.log(a.data),a.data.academies.forEach(t=>{A.value.push({label:t.academy_name,value:t.id})})}).catch(a=>{console.log(a)})},se=()=>new Promise(a=>{h.get(`https://akademia.website/api/coachesOfBranch/${n.value.branch_id}`).then(t=>{console.log(t.data),j.value=[],t.data.coaches.forEach(s=>{j.value.push({label:`كابتن / ${s.name}`,value:s.id})}),a(j.value)})}),le=()=>new Promise(a=>{h.get(`https://akademia.website/api/categoriesOfBranch/${n.value.branch_id}`).then(t=>{console.log(t.data),O.value=[],t.data.categories.forEach(s=>{O.value.push({label:s.category_name,value:s.id})}),a(O.value)})}),oe=()=>new Promise(a=>{h.get(`https://akademia.website/api/branch/workingDays/${n.value.branch_id}`).then(t=>{console.log(t.data),R.value=[],t.data.workingDays.forEach(s=>{R.value.push(s.day)}),a(R.value)})}),ie=a=>{V.value=!0;let t={};localStorage.getItem("waitingForSubscription")&&(t=JSON.parse(localStorage.getItem("waitingForSubscription"))),a.subscription_date=new Date(a.subscription_date),a.subscription_date=a.subscription_date.toISOString().substr(0,19).replace("T"," "),a.expiration_date=new Date(a.expiration_date),a.expiration_date=a.expiration_date.toISOString().substr(0,19).replace("T"," "),g.value&&t&&(a.customer_id=t.id),f.value&&(a.subscription_type=f.value),f.value=="installments"&&(m.value.installments.forEach(s=>{s.due_date=new Date(s.due_date),s.due_date=s.due_date.toISOString().substr(0,19).replace("T"," ")}),a.installments=m.value.installments),console.log(a),h.post("https://akademia.website/api/createSubscription",a).then(s=>{x.value=s.data.subscription,x.value.customer_name=t.customer_name,V.value=!1,k.value=!1,w.value=!0,window.scrollTo({top:0,behavior:"smooth"}),I.value=!0,console.log(x.value),setTimeout(()=>{w.value=!1},1600)}).catch(s=>{window.scrollTo({top:0,behavior:"smooth"}),V.value=!1,k.value=!0,S.value=s.response.data.message,console.log(s)})},ne=()=>{p.value<=0?(B.value=!1,P.value=!1):P.value=!0};Q(m,()=>{p.value=n.value.price,m.value&&n.value.price&&(console.log(m.value),m.value.installments.forEach(a=>{a.amount&&(p.value=parseFloat(p.value)-parseFloat(a.amount),console.log(p.value))}))}),Q(n,(a,t)=>{if(console.log(a,"NEW Value"),console.log(t,"Old Value"),n.value.branch_id&&n.value.number_of_sessions&&n.value.category_id){const s=n.value.number_of_sessions,G=J.value.filter(v=>v.id==n.value.branch_id)[0].categories.filter(v=>v.id===n.value.category_id);G[0].pivot;const ue=JSON.parse(G[0].pivot.session_prices);if(a.number_of_sessions!=t.number_of_sessions){console.log("new != old");const v=ue.filter(me=>me.sessions==s);v.length>0?(n.value.price=v[0].price,F.value=!0,L.value=v[0].price,console.log(v[0].price,"saved sessions price")):(F.value=!1,n.value.price=null)}}else F.value=!1});const W=()=>{h.get("https://akademia.website/api/customers").then(a=>{console.log(a.data),a.data.customers.forEach(t=>{q.value.push({label:t.customer_name,value:t.id})}),ee.value=!0}).catch(a=>{console.log(a)})},ce=()=>{$.value?(localStorage.removeItem("waitingForSubscription"),g.value=!1,setTimeout(()=>{location.reload()},1e3)):(localStorage.removeItem("waitingForSubscription"),N("/customers"))},re=o(),de=o("admin");return _e(()=>{he().then(a=>{a==!1?fe().then(t=>{t==!1&&(localStorage.removeItem("SwimmingToken"),location.reload(),N({path:"/login",query:Z.value.query})),re.value=t.permissions,de.value="employee",W(),K(),H()}):(W(),K(),H())})}),(a,t)=>{const s=be("FormKit");return c(),u(xe,null,[l(r(X),{visible:I.value,"onUpdate:visible":t[1]||(t[1]=i=>I.value=i),onAfterHide:ce,modal:"",header:"بيانات الاشتراك",style:{width:"50vw"},breakpoints:{"960px":"75vw","641px":"100vw"}},{footer:_(()=>[l(r(b),{label:"تم",class:"px-4 py-1",onClick:t[0]||(t[0]=i=>I.value=!1),autofocus:""})]),default:_(()=>[e("div",ye,[e("div",we,[ke,e("p",null,y(x.value.customer_id),1)]),e("div",Se,[Ce,e("p",null,y(x.value.customer_name),1)]),e("div",De,[Fe,e("p",null,y(new Date(x.value.expiration_date).toLocaleDateString()),1)])])]),_:1},8,["visible"]),e("div",Ve,[Te,e("div",Be,[w.value?(c(),z(ge,{key:0,class:"fadeinright animation-duration-1000 animation-iteration-1"})):d("",!0),k.value?(c(),u("h5",Ie,y(S.value),1)):d("",!0)]),e("div",Ee,[l(r(Y),{modelValue:D.value,"onUpdate:modelValue":t[2]||(t[2]=i=>D.value=i)},null,8,["modelValue"]),je]),!g.value&&!D.value?(c(),u("div",Oe,[l(s,{type:"form",actions:!1,onSubmit:ae},{default:_(()=>[e("div",$e,[e("div",Pe,[Re,l(s,{"prefix-icon":"avatarMan",id:"name",type:"text",label:"اسم المشترك",placeholder:"أدخل اسم المشترك",name:"customer_name",validation:"required|length:2"})]),e("div",ze,[Ne,l(s,{"prefix-icon":"email",id:"mail",type:"email",label:"البريد الالكتروني",placeholder:"أدخل البريد الالكتروني",name:"customer_email",validation:"email"})]),e("div",Ue,[Ae,l(s,{"prefix-icon":"telephone",id:"phone",type:"text",label:"رقم الهاتف",placeholder:"أدخل رقم هاتف المشترك",name:"customer_phone",validation:"required|length:10"})]),e("div",qe,[Je,l(s,{type:"datepicker",name:"birthdate",label:"تاريخ الميلاد",id:"birthdate",format:{date:"short"}})]),e("div",Le,[Me,l(s,{"prefix-icon":"text",id:"job",type:"text",label:"الوظيفة",placeholder:"أدخل وظيفة المشترك ",name:"job",validation:"required"})]),e("div",Ke,[He,l(s,{"prefix-icon":"text",id:"address",type:"textarea",label:"العنوان",placeholder:"أدخل عنوان للمشترك ",name:"customer_address",validation:"required|length:3"})]),e("div",We,[Ge,l(s,{id:"gender",type:"dropdown",options:[{label:"ذكر",value:"male"},{label:"أنثي",value:"female"}],label:"الجنس",placeholder:"أختر جنس المشترك ",name:"gender",validation:"required"})])]),l(r(b),{type:"submit",class:"submitBtn",label:"التالي",loading:C.value},null,8,["loading"])]),_:1})])):(D.value||g.value)&&M.value?(c(),u("div",Qe,[l(s,{type:"form",modelValue:n.value,"onUpdate:modelValue":t[7]||(t[7]=i=>n.value=i),actions:!1,onSubmit:ie},{default:_(()=>[e("div",Xe,[D.value&&!g.value?(c(),u("div",Ye,[Ze,l(s,{type:"autocomplete",name:"customer_id",placeholder:"اختر المشترك الذي تريد تسجيله",label:"المشترك",options:q.value,validation:"required"},null,8,["options"])])):d("",!0),e("div",et,[tt,l(s,{type:"dropdown",validation:"required",name:"branch_id",label:"الفرع",placeholder:"اختر الفرع الذي سيحضر فيه المشترك",options:U.value},null,8,["options"])]),n.value.branch_id?(c(),u("div",at,[e("div",st,[lt,l(s,{type:"dropdown",name:"coach_id","always-load-on-open":"true","empty-message":"لا يوجد مدربين لهذا الفرع",label:"المدرب",placeholder:"اختر المدرب الذي سيحضر معه المشترك",options:se})]),e("div",ot,[it,l(s,{type:"dropdown",name:"category_id",label:"نوع التمرين","empty-message":"لا يوجد تمارين في هذا الفرع",placeholder:"اختر نوع التمرين",options:le})]),e("div",nt,[ct,l(s,{type:"datepicker",name:"subscription_date",label:"تاريخ الاشتراك",id:"subscription_date",format:{date:"short"},validation:"required",value:new Date},null,8,["value"])]),e("div",rt,[dt,l(s,{type:"datepicker",name:"expiration_date",label:"تاريخ الانتهاء",id:"expiration_date","min-date":new Date,validation:"required",format:{date:"short"}},null,8,["min-date"])]),e("div",ut,[mt,l(s,{type:"dropdown",id:"academy",name:"academy_id",label:"الأكاديمية",placeholder:"اختر الأكاديمية",options:A.value,validation:"required"},null,8,["options"])]),e("div",pt,[vt,l(s,{"prefix-icon":"number",number:"integer",id:"avail_freeze_days",type:"number",label:"أيام التجميد",placeholder:"أدخل الأيام المتاحة لتجميد الاشتراك",name:"avail_freeze_days",validation:"required|min:0"})]),e("div",_t,[ht,l(s,{"prefix-icon":"number",number:"integer",id:"number_of_sessions",type:"number",label:"عدد الحصص",placeholder:"أدخل عدد حصص الاشتراك ",name:"number_of_sessions",validation:"required|min:1"})]),e("div",ft,[bt,l(s,{"prefix-icon":"number",number:"integer",id:"sessions_per_week",type:"number",label:"عدد الحصص الاسبوعية",placeholder:"أدخل عدد الحصص في الاسبوع ",name:"sessions_per_week",validation:"required|min:1"})]),e("div",xt,[l(s,{id:"repeater",name:"training_schedules",type:"repeater","add-label":"اضافة موعد",label:"جدول المواعيد"},{default:_(({index:i})=>[e("div",gt,[l(s,{type:"dropdown","outer-class":"col-12 md:col-6",name:"day",label:`${i+1}. اليوم`,placeholder:"اختر اليوم",options:oe,"always-load-on-open":"true",validation:"required"},null,8,["label"]),l(s,{type:"time",label:"موعد بدء التمرين","outer-class":"col-12 md:col-6",name:"time",value:"21:00",validation:"required"})])]),_:1})]),e("div",{class:E(["col-12",{"md:col-6":T.value}])},[yt,l(s,{"prefix-icon":"dollar",id:"price",type:"number",label:"سعر الاشتراك",placeholder:"أدخل سعر الاشتراك",name:"price",number:"float",validation:"required|min:1"}),F.value?(c(),u("h5",wt,"السعر المسجل لهذا العدد من الحصص هو "+y(L.value)+" ج.م",1)):d("",!0)],2),T.value?(c(),u("div",kt,[St,l(s,{"prefix-icon":"dollar",id:"sessions_per_week",type:"number",label:"الخصم",placeholder:"أدخل مبلغ الخصم بالجنية ",number:"float",name:"sale",validation:"min:0"})])):d("",!0),e("div",Ct,[T.value?d("",!0):(c(),z(r(b),{key:0,type:"button",class:"",style:{background:"var(--background)"},label:"أدخل مبلغ خصم",onClick:t[3]||(t[3]=i=>T.value=!0)}))]),Dt,e("div",Ft,[e("div",Vt,[l(r(b),{type:"button",class:E(["w-9",{activeButton:f.value=="cash"}]),label:"كاش",onClick:t[4]||(t[4]=i=>f.value="cash")},null,8,["class"])]),e("div",Tt,[l(r(b),{type:"button",class:E(["w-9",{activeButton:f.value=="installments"}]),label:"تقسيط",onClick:t[5]||(t[5]=i=>{f.value="installments",B.value=!0})},null,8,["class"])])])])):d("",!0)]),e("div",Bt,[l(r(Y),{modelValue:$.value,"onUpdate:modelValue":t[6]||(t[6]=i=>$.value=i)},null,8,["modelValue"]),It]),l(r(b),{type:"submit",class:"submitBtn my-5",label:"تسجيل الاشتراك",loading:V.value},null,8,["loading"])]),_:1},8,["modelValue"]),l(r(X),{visible:B.value,"onUpdate:visible":t[9]||(t[9]=i=>B.value=i),maximizable:"",class:"surface-100",modal:"",header:"تفاصيل الأقساط",breakpoints:{"900px":"70vw","641px":"100vw"}},{default:_(()=>[e("div",Et,[l(s,{type:"form",modelValue:m.value,"onUpdate:modelValue":t[8]||(t[8]=i=>m.value=i),actions:!1,onSubmit:ne},{default:_(()=>[e("div",jt,[l(s,{id:"repeater",name:"installments",type:"repeater","add-label":"اضافة قسط",label:"جدول التقسيط"},{default:_(({index:i})=>[e("div",Ot,[l(s,{"prefix-icon":"number",type:"number","outer-class":"col-12 md:col-6",name:"installment_number",label:`${i+1}. رقم القسط`,placeholder:"أدخل رقم القسط",validation:"required|min:0",value:i+1,number:"integer"},null,8,["label","value"]),e("div",{class:E(["col-12 md:col-6 flex flex-column",{"mt-1 md:mt-5":p.value}])},[l(s,{"prefix-icon":"dollar",name:"amount",type:"number",label:"مبلغ القسط",number:"float",placeholder:"أدخل مبلغ القسط المستحق",validation:"required|min:0"}),p.value?(c(),u("h5",$t,"المتبقي من المبلغ : "+y(p.value.toFixed(2))+" ج.م",1)):d("",!0)],2),l(s,{type:"datepicker",name:"due_date","outer-class":"col-12 md:col-8",label:`${i+1}. تاريخ الاستحقاق`,id:i+1,value:new Date,"max-date":n.value.expiration_date,placeholder:"أدخل تاريخ استحقاق القسط","validation-label":"تاريخ الاستحقاق",validation:"required",format:{date:"short"}},null,8,["label","id","value","max-date"]),i==0?(c(),z(s,{key:0,type:"checkbox",label:"تم الدفع كمقدم",name:"paid",value:!1,validation:"","outer-class":"col-12 md:col-4 mt-5"})):d("",!0)])]),_:1})]),l(r(b),{type:"submit",class:"mt-3",label:"تسجيل الأقساط",loading:C.value,style:{background:"var(--fk-bg-button)"}},null,8,["loading"]),P.value?(c(),u("h5",Pt,"الأقساط ليست كافية لتغطية سعر الاشتراك !")):d("",!0)]),_:1},8,["modelValue"])])]),_:1},8,["visible"])])):d("",!0)])],64)}}});export{qt as default};
