import{d as re,u as ue,j as ce,r as u,o as de,k as me,l as pe,a as m,c as b,b as l,w as o,e as t,g as i,m as M,f as h,F as ve,h as C,s as c,n as A,p as _,t as g,v as Z,x as be,y as he,z as f,A as G}from"./index-5ed95cfa.js";import{s as J,a as X,b as D}from"./inlinemessage.esm-b859ab3c.js";import{s as d}from"./column.esm-6404a039.js";import{s as fe}from"./successMsg-575c06f8.js";import{s as R}from"./tag.esm-7b7ff2f9.js";import{s as ye}from"./calendar.esm-0476f178.js";import{i as $}from"./isEmployeeAuthorizedFor-df272e7f.js";import"./index.esm-93947ef4.js";/* empty css                                                   */const _e={class:"text-center"},ge=i("span",{style:{color:"rgba(220, 18, 18, 0.759)"},class:"material-symbols-outlined text-6xl"}," warning ",-1),xe=i("h3",{style:{color:"rgba(220, 18, 18, 0.759)"}},"لا يمكن حذف المشتركين التاليين بسبب وجود مديونيات لم تسدد",-1),ke={key:0,class:"failedDeletions"},Ce={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},we=i("h3",{class:"hidden md:my-2 lg:my-0 md:flex",style:{color:"black"}},"المديونيات",-1),Ve={class:"p-input-icon-left"},$e=i("i",{class:"pi pi-search"},null,-1),Se={class:"flex align-items-center"},Ie=["onClick"],Ue=["onClick"],Ae={class:"flex justify-content-between"},De=i("div",{class:"text-center"},[i("span",{style:{color:"rgba(220, 18, 18, 0.759)"},class:"material-symbols-outlined text-6xl"}," warning "),i("h3",{style:{color:"rgba(220, 18, 18, 0.759)"}},"هل متأكد أنك تريد حذف هؤلاء المشتركين ؟"),i("p",{class:"my-2"},"أنت علي وشك حذف مشتركين نشطين")],-1),Te={class:"flex justify-content-between"},Fe={class:"w-12 md:w-10 my-5 m-auto p-2 md:p-5 branchesList",style:{direction:"rtl"}},Ne={class:"w-full m-auto flex justify-content-center p-4 MargAutoMob padding-1-breadcrumbs",style:{direction:"ltr"}},Le={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},Be={class:"flex align-items-center"},Ee=i("h3",{class:"hidden md:my-2 lg:my-0 md:flex"},"الاشتراكات الفردية",-1),Me={class:"p-input-icon-left"},Re=i("i",{class:"pi pi-search"},null,-1),je={key:0},Oe={key:1},qe={key:0},ze={key:1},Qe={key:0},He={key:1},Ke={class:"flex align-items-center"},We=["onClick"],Ze=["onClick"],Ge=["onClick"],st=re({__name:"privateList",setup(Je){const{push:w,currentRoute:j}=ue(),Y=ce(),O=u(!1),P=u(!1),S=u(!1),I=u(!1);u(!1);const U=u(!1);u();const y=u([]),T=u(!1),q=u([]);q.value=[{label:"التمرينات الفردية",route:"/privateSubscriptions",to:"/privateSubscriptions"},{label:"عرض التمرينات الفردية",route:"/privateSubscriptions",to:"/privateSubscriptions"}];const ee=u({icon:"pi pi-home",to:"/"}),te=(n,a)=>{Y.require({target:n.currentTarget,message:a=="cash"?"هل متأكد أنك تريد حذف هذا المشترك ؟":"هذا المشترك نشط! هل متأكد أنك تريد حذف هذا المشترك ؟",icon:"pi pi-exclamation-triangle",acceptLabel:"نعم",rejectLabel:"لا",accept:()=>{N()},reject:()=>{}})},z=u(["active","inactive","frozen"]),le=u(["cash","installments"]),V=u(),ae=u([]),Q=u([]);u();const p=u([]),v=u({global:{value:null,matchMode:f.CONTAINS},"customer.customer_name":{value:"",matchMode:f.CONTAINS},category_name:{value:"",matchMode:f.EQUALS},"coach.name":{value:"",matchMode:f.CONTAINS},expiration_date:{value:null,matchMode:f.DATE_IS},subscription_type:{value:null,matchMode:f.EQUALS},"customer.customer_phone":{operator:G.AND,constraints:[{value:null,matchMode:f.STARTS_WITH}]},customer_id:{operator:G.AND,constraints:[{value:null,matchMode:f.EQUALS}]},state:{value:null,matchMode:f.CONTAINS}}),oe={weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"Africa/Cairo",locale:"ar"},ne=new Intl.DateTimeFormat("ar",oe),F=()=>{C.get("https://akademia.website/api/privateSubscriptions").then(n=>{console.log(n.data),V.value=n.data.privateSubscriptions,O.value=!0,V.value.forEach(a=>{a.expiration_date=new Date(a.expiration_date);const e=a.expiration_date.getTime()-new Date().getTime();console.log(e/(1e3*3600*24)),a.daysLeft=Math.ceil(e/(1e3*3600*24))})}).catch(n=>{console.log(n)})},H=()=>{C.get("https://akademia.website/api/branches").then(n=>{console.log(n.data),n.data.branches.forEach(a=>{ae.value.push(a.branch_name)}),P.value=!0}).catch(n=>{console.log(n)})},se=n=>{C.put(`https://akademia.website/api/payInstallment/${n}`).then(a=>{console.log(a.data.installment),p.value=p.value.filter(e=>e.id!==n)}).catch(a=>{console.log(a)})},ie=n=>{C.delete(`https://akademia.website/api/deleteInstallment/${n}`).then(a=>{console.log(a.data),p.value=p.value.filter(e=>e.id!==n)}).catch(a=>{console.log(a)})},N=()=>{U.value=!0,console.log(y.value),p.value=[];let n=[];y.value.forEach(e=>{n.push(e.customer_id)});let a={customer_ids:n};C.post("https://akademia.website/api/customerBulkDelete",a).then(e=>{console.log(e),U.value=!1,T.value=!0,y.value=[],I.value=!1,S.value=!1,F(),setTimeout(()=>{T.value=!1},4500)}).catch(e=>{e.response.data.failed_deletions&&(I.value=!0,U.value=!1,S.value=!1,e.response.data.failed_deletions.forEach(s=>{Object.values(s.installments).forEach(r=>{r.customer_name=s.customer_name,console.log(r),p.value.push(r)})}),console.log("customers have unpaid installments !"),console.log(p.value))})},K=()=>{C.get("https://akademia.website/api/categories").then(n=>{console.log(n.data),n.data.categories.forEach(a=>{Q.value.push(a.category_name)})}).catch(n=>{console.log(n)})},L=n=>{if(n=="active")return"success";if(n=="inactive")return"danger";if(n=="frozen")return"info"},B=n=>{if(n=="active")return"نشط";if(n=="inactive")return"غير نشط";if(n=="frozen")return"مجمد"},x=u(),k=u("admin");de(()=>{me().then(n=>{n==!1?pe().then(a=>{a==!1&&(localStorage.removeItem("SwimmingToken"),location.reload(),w({path:"/login",query:j.value.query})),x.value=a.permissions,k.value="employee",$(x.value,"عرض التمرينات الفردية",k.value)||(localStorage.removeItem("SwimmingToken"),location.reload(),w({path:"/login",query:j.value.query})),F(),H(),K()}):(F(),H(),K())})});const E=u(),W=()=>{E.value.exportCSV()};return(n,a)=>(m(),b(ve,null,[l(t(Z),{visible:I.value,"onUpdate:visible":a[3]||(a[3]=e=>I.value=e),onAfterHide:a[4]||(a[4]=e=>p.value=[]),modal:"",header:"تنبيه",style:{width:"60vw"},breakpoints:{"960px":"75vw","641px":"100vw"}},{footer:o(()=>[i("div",Ae,[l(t(c),{type:"button",severity:"danger",class:"mb-3 lg:mb-0 mx-2",loading:U.value,onClick:N,label:"حاول مجدداً"},null,8,["loading"])])]),default:o(()=>[i("div",_e,[ge,xe,p.value.length>0?(m(),b("div",ke,[l(t(J),{filters:v.value,"onUpdate:filters":a[2]||(a[2]=e=>v.value=e),ref_key:"dt",ref:E,stripedRows:"",value:p.value,paginator:"",rows:10,rowsPerPageOptions:[10,20,50],filterDisplay:"menu",dataKey:"id",removableSort:"",globalFilterFields:["id","category_name"],tableStyle:"min-width: 50rem"},{header:o(()=>[i("div",Ce,[we,i("span",Ve,[$e,l(t(A),{modelValue:v.value.global.value,"onUpdate:modelValue":a[0]||(a[0]=e=>v.value.global.value=e),placeholder:"بحث شامل"},null,8,["modelValue"])])])]),empty:o(()=>[l(t(X),{severity:"info"},{default:o(()=>[_("لا يوجد مديونيات")]),_:1})]),paginatorend:o(()=>[l(t(c),{type:"button",icon:"pi pi-download",onClick:a[1]||(a[1]=e=>W(e)),text:""})]),default:o(()=>[l(t(d),{field:"customer_name",sortable:"",header:"اسم اللاعب"}),l(t(d),{field:"installment_number",header:"رقم القسط"}),l(t(d),{field:"amount",sortable:"",header:"المبلغ المستحق"},{body:o(e=>[i("p",null,g(e.data.amount)+" ج.م",1)]),_:1}),l(t(d),{field:"due_date",sortable:"",header:"موعد الاستحقاق"},{body:o(e=>[i("p",null,g(e.data.due_date),1)]),_:1}),l(t(d),{header:"تعديل",style:{"min-width":"11rem"}},{body:o(e=>[i("div",Se,[i("span",{class:"cursor-pointer hoverIcon textColor text-sm p-2 borderRound",onClick:s=>se(e.data.id)}," تم الدفع ",8,Ie),i("span",{onClick:s=>ie(e.data.id),class:"material-symbols-outlined cursor-pointer hoverIcon textColor mx-2 text-3xl p-2 borderRound"}," delete_forever ",8,Ue)])]),_:1})]),_:1},8,["filters","value"])])):h("",!0)])]),_:1},8,["visible"]),l(t(Z),{visible:S.value,"onUpdate:visible":a[5]||(a[5]=e=>S.value=e),modal:"",header:"رسالة تأكيد",style:{width:"60vw"},breakpoints:{"960px":"75vw","641px":"100vw"}},{footer:o(()=>[i("div",Te,[l(t(c),{type:"button",severity:"danger",class:"mb-3 lg:mb-0 mx-2",onClick:N,label:"تأكيد"})])]),default:o(()=>[De]),_:1},8,["visible"]),i("div",Fe,[i("div",Ne,[l(t(be),{home:ee.value,model:q.value},null,8,["home","model"])]),l(t(he)),T.value?(m(),M(fe,{key:0,class:"fadeinright animation-duration-500 animation-iteration-1 my-4"},{default:o(()=>[_("تم الحذف بنجاح")]),_:1})):h("",!0),i("div",null,[l(t(J),{filters:v.value,"onUpdate:filters":a[10]||(a[10]=e=>v.value=e),"filter-locale":"ar","export-filename":"الاشتاركات الفردية",ref_key:"dt",ref:E,stripedRows:"",value:V.value,selection:y.value,"onUpdate:selection":a[11]||(a[11]=e=>y.value=e),loading:!O.value,paginator:"",rows:10,rowsPerPageOptions:[10,15,20,50],filterDisplay:"menu",dataKey:"customer_id",removableSort:"",globalFilterFields:["customer_id","customer.customer_name","customer.customer_phone"],tableStyle:"min-width: 50rem"},{header:o(()=>[i("div",Le,[i("div",Be,[t($)(x.value,"تسجيل و تعديل التمرينات الفردية",k.value)?(m(),M(t(c),{key:0,type:"button",class:"mb-3 lg:mb-0 mx-2",onClick:a[6]||(a[6]=e=>t(w)("/privateSubscriptions/create")),label:"تسجيل مشترك"})):h("",!0),t($)(x.value,"تسجيل و تعديل التمرينات الفردية",k.value)?(m(),M(t(c),{key:1,type:"button",disabled:y.value.length==0,severity:"danger",class:"mb-3 lg:mb-0 mx-2",label:"حذف المحدد"},null,8,["disabled"])):h("",!0)]),Ee,i("div",null,[i("span",Me,[Re,l(t(A),{modelValue:v.value.global.value,"onUpdate:modelValue":a[7]||(a[7]=e=>v.value.global.value=e),class:"mx-2",placeholder:"بحث شامل"},null,8,["modelValue"])]),l(t(D),{modelValue:v.value.state.value,"onUpdate:modelValue":a[8]||(a[8]=e=>v.value.state.value=e),options:z.value,placeholder:"اختر حالة",class:"p-column-filter",style:{"min-width":"12rem"},showClear:!0},{option:o(e=>[l(t(R),{value:B(e.option),severity:L(e.option)},null,8,["value","severity"])]),_:1},8,["modelValue","options"])])])]),loading:o(()=>[_(" برجاء الانتظار .. جاري تحميل بيانات الاشتراكات الفردية ... ")]),empty:o(()=>[l(t(X),{severity:"info"},{default:o(()=>[_("لا يوجد مشتركين")]),_:1})]),paginatorend:o(()=>[l(t(c),{type:"button",icon:"pi pi-download",onClick:a[9]||(a[9]=e=>W(e)),text:""})]),footer:o(()=>[_(" في المجموع هناك "+g(V.value?V.value.length:0)+" مشتركين ",1)]),default:o(()=>[l(t(d),{selectionMode:"multiple",headerStyle:"width: 3rem"}),l(t(d),{field:"customer_id",sortable:"",header:"الكود",style:{width:"8%"}}),l(t(d),{field:"customer.customer_name",sortable:"",header:"الاسم"},{body:o(e=>[_(g(e.data.customer.customer_name),1)]),filter:o(({filterModel:e,filterCallback:s})=>[l(t(A),{modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,onInput:r=>s(),type:"text",class:"p-column-filter",placeholder:"أدخل اسم المشترك"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),filterapply:o(({filterCallback:e})=>[l(t(c),{type:"button",onClick:s=>e(),class:"mb-3 lg:mb-0 mx-2",label:"تفعيل"},null,8,["onClick"])]),filterclear:o(({filterCallback:e})=>[l(t(c),{type:"button",onClick:s=>e(),class:"mb-3 lg:mb-0 mx-2",label:"الغاء",outlined:""},null,8,["onClick"])]),_:1}),l(t(d),{field:"customer.customer_phone",header:"الهاتف"}),l(t(d),{field:"state",header:"الحالة"},{body:o(e=>[l(t(R),{value:B(e.data.state),severity:L(e.data.state)},null,8,["value","severity"])]),filter:o(({filterModel:e,filterCallback:s})=>[l(t(D),{modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,onChange:r=>s(),options:z.value,placeholder:"اختر حالة",class:"p-column-filter",style:{"min-width":"12rem"},showClear:!0},{option:o(r=>[l(t(R),{value:B(r.option),severity:L(r.option)},null,8,["value","severity"])]),_:2},1032,["modelValue","onUpdate:modelValue","onChange","options"])]),filterapply:o(({filterCallback:e})=>[l(t(c),{type:"button",onClick:s=>e(),class:"mb-3 lg:mb-0 mx-2",label:"تفعيل"},null,8,["onClick"])]),filterclear:o(({filterCallback:e})=>[l(t(c),{type:"button",onClick:s=>e(),class:"mb-3 lg:mb-0 mx-2",label:"الغاء",outlined:""},null,8,["onClick"])]),_:1}),l(t(d),{field:"subscription_type",header:"الدفع",style:{"min-width":"9rem"}},{body:o(e=>[e.data.subscription_type=="cash"?(m(),b("p",je,"كاش")):h("",!0),e.data.subscription_type=="installments"?(m(),b("p",Oe,"تقسيط")):h("",!0)]),filter:o(({filterModel:e,filterCallback:s})=>[l(t(D),{modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,onChange:r=>s(),options:le.value,placeholder:"اختر طريقة دفع",class:"p-column-filter",style:{"min-width":"12rem"},showClear:!0},{option:o(r=>[r.option=="cash"?(m(),b("p",qe,"كاش")):h("",!0),r.option=="installments"?(m(),b("p",ze,"تقسيط")):h("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","onChange","options"])]),filterapply:o(({filterCallback:e})=>[l(t(c),{type:"button",onClick:s=>e(),class:"mb-3 lg:mb-0 mx-2",label:"تفعيل"},null,8,["onClick"])]),filterclear:o(({filterCallback:e})=>[l(t(c),{type:"button",onClick:s=>e(),class:"mb-3 lg:mb-0 mx-2",label:"الغاء",outlined:""},null,8,["onClick"])]),_:1}),l(t(d),{field:"category_name",header:"نوع التمرين",style:{"min-width":"11rem"}},{filter:o(({filterModel:e,filterCallback:s})=>[l(t(D),{modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,onChange:r=>s(),options:Q.value,placeholder:"اختر نوع التمرين",class:"p-column-filter",style:{"min-width":"12rem"},showClear:!0},null,8,["modelValue","onUpdate:modelValue","onChange","options"])]),filterapply:o(({filterCallback:e})=>[l(t(c),{type:"button",onClick:s=>e(),class:"mb-3 lg:mb-0 mx-2",label:"تفعيل"},null,8,["onClick"])]),filterclear:o(({filterCallback:e})=>[l(t(c),{type:"button",onClick:s=>e(),class:"mb-3 lg:mb-0 mx-2",label:"الغاء",outlined:""},null,8,["onClick"])]),_:1}),l(t(d),{field:"coach.name",header:"المدرب",style:{"min-width":"9rem"}},{body:o(e=>[_(g(e.data.coach.name),1)]),filter:o(({filterModel:e,filterCallback:s})=>[l(t(A),{modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,onInput:r=>s(),type:"text",class:"p-column-filter",placeholder:"أدخل اسم المدرب"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),filterapply:o(({filterCallback:e})=>[l(t(c),{type:"button",onClick:s=>e(),class:"mb-3 lg:mb-0 mx-2",label:"تفعيل"},null,8,["onClick"])]),filterclear:o(({filterCallback:e})=>[l(t(c),{type:"button",onClick:s=>e(),class:"mb-3 lg:mb-0 mx-2",label:"الغاء",outlined:""},null,8,["onClick"])]),_:1}),l(t(d),{field:"expiration_date",sortable:"",header:"تاريخ انتهاء الاشتراك",style:{"min-width":"17rem"}},{body:o(e=>[i("p",null,g(t(ne).format(e.data.expiration_date)),1)]),filter:o(({filterModel:e,filterCallback:s})=>[l(t(ye),{modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,onInput:r=>s(),placeholder:"اختر تاريخ انتهاء الاشتراك",showIcon:"",showButtonBar:"",inputId:"expiration_date"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),filterapply:o(({filterCallback:e})=>[l(t(c),{type:"button",onClick:s=>e(),class:"mb-3 lg:mb-0 mx-2",label:"تفعيل"},null,8,["onClick"])]),filterclear:o(({filterCallback:e})=>[l(t(c),{type:"button",onClick:s=>e(),class:"mb-3 lg:mb-0 mx-2",label:"الغاء",outlined:""},null,8,["onClick"])]),_:1}),l(t(d),{field:"daysLeft",sortable:"",header:"الأيام المتبقية",style:{"min-width":"12rem"}},{body:o(e=>[e.data.daysLeft>=0?(m(),b("p",Qe,g(e.data.daysLeft)+" يوم",1)):(m(),b("p",He,"اشتراك منتهي"))]),_:1}),l(t(d),{header:"تعديل"},{body:o(e=>[i("div",Ke,[t($)(x.value,"تسجيل و تعديل التمرينات الفردية",k.value)?(m(),b("span",{key:0,class:"material-symbols-outlined cursor-pointer hoverIcon textColor text-3xl p-2 borderRound",onClick:s=>{y.value=[{customer_id:e.data.customer_id}],te(s,e.data.subscription_type)}}," delete_forever ",8,We)):h("",!0),t($)(x.value,"تسجيل و تعديل التمرينات الفردية",k.value)?(m(),b("span",{key:1,onClick:s=>t(w)({path:`/customer/update/${e.data.customer_id}`,query:{isPrivate:"true"}}),class:"material-symbols-outlined cursor-pointer hoverIcon mx-2 textColor text-3xl p-2 borderRound"}," edit ",8,Ze)):h("",!0),i("span",{class:"material-symbols-outlined cursor-pointer hoverIcon textColor text-3xl p-2 borderRound",onClick:s=>t(w)(`/customer/${e.data.id}`)}," visibility ",8,Ge)])]),_:1})]),_:1},8,["filters","value","selection","loading","globalFilterFields"])])])],64))}});export{st as default};
