import{d as ye,u as xe,j as we,r as n,o as Se,k as ke,l as Ce,a as c,c as p,b as l,w as i,e as o,g as s,f as b,m as $,F as Ae,h as f,s as D,t as d,p as y,v as De,x as Te,i as x,y as Ve,n as le,z as w,A as L,B as Me}from"./index-5ed95cfa.js";import{s as B,a as ne}from"./inlinemessage.esm-b859ab3c.js";import{s as u}from"./column.esm-6404a039.js";import{s as Fe}from"./successMsg-575c06f8.js";import"./tag.esm-7b7ff2f9.js";import"./selectbutton.esm-23e4c1f5.js";import{i as $e}from"./isEmployeeAuthorizedFor-df272e7f.js";import"./index.esm-93947ef4.js";/* empty css                                                   */const Le={key:1,class:"dialogTable"},je={class:"flex flex-column my-3"},qe=s("span",{style:{color:"rgba(220, 18, 18, 0.759)"},class:"material-symbols-outlined text-center text-6xl"}," warning ",-1),Ue={class:"text-center",style:{color:"rgba(220, 18, 18, 0.759)"}},Ee=s("h5",{class:"text-center"},"مع العلم أنه قد قام بحضور هذا التمارين اليوم!",-1),Ne={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},Oe={style:{color:"black"}},Re=s("h3",{style:{color:"black"}},"جدول حضور اليوم",-1),Be={class:"w-12 md:w-10 my-5 m-auto p-2 md:p-5 productsList",style:{direction:"rtl"}},Ie={class:"w-full m-auto flex justify-content-center p-4 MargAutoMob padding-1-breadcrumbs",style:{direction:"ltr"}},ze={key:0},He={class:"mt-3"},Ke=s("div",{class:"flex align-items-center"},[s("label",{for:"branch",class:"px-3 py-1 text-white text-sm"},"الفرع")],-1),Qe={class:"mt-3"},We=s("div",{class:"flex align-items-center"},[s("label",{for:"start_time",class:"px-3 py-1 text-white text-sm"},"موعد بدء التمرين")],-1),Ye={class:"mt-3"},Ge=s("div",{class:"flex align-items-center"},[s("label",{for:"duration",class:"px-3 py-1 text-white text-sm"},"مدة التمرين ( بالساعة )")],-1),Ze={key:1},Je={class:"flex justify-content-center my-5 pt-5 m-auto"},Xe={key:1},Pe={key:0,class:"px-3 my-2 fadeinup animation-duration-500 animation-iteration-1 py-2 textColor text-center borderRound error"},et={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},tt=s("h3",null,"تسجيل حضور اللاعبين",-1),at={class:"p-input-icon-left"},st=s("i",{class:"pi pi-search"},null,-1),ot={key:0},lt=["onClick"],nt=s("h3",{class:"text-center"},"تسجيل",-1),it=s("span",{class:"material-symbols-outlined mx-2 cursor-pointer text-3xl"}," assignment_turned_in ",-1),rt=[nt,it],ct={key:1},ut={class:""},dt={key:2},mt={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},pt=s("h3",null,"تسجيل حضور المدربين",-1),vt={class:"p-input-icon-left"},ht=s("i",{class:"pi pi-search"},null,-1),_t=["onClick"],gt=s("h3",{class:"text-center"},"تسجيل",-1),bt=s("span",{class:"material-symbols-outlined mx-2 cursor-pointer text-3xl"}," assignment_turned_in ",-1),ft=[gt,bt],Mt=ye({__name:"AttendanceList",setup(yt){const{push:I,currentRoute:z}=xe(),T=we(),j=n(!1),q=n(!1),m=n([]),S=n([]),k=n(!1),v=n(!1),U=n(!1),H=n(),V=n(),h=n(),K=n(!1),Q=n([]),W=n(),C=n(),E=n(),N=n(),Y=n([]),ie=n(!1),A=n("customers"),M=n(!1),F=n(!1),_=n(),G=n([]);G.value=[{label:"تسجيل الحضور",route:"/attendance",to:"/attendance"}];const re=n({icon:"pi pi-home",to:"/"});function Z(){const a=new Date,t=a.getHours().toString().padStart(2,"0"),e=a.getMinutes().toString().padStart(2,"0");W.value=`${t}:${e}`}const ce=(a,t,e)=>{if(!e){T.require({target:a.currentTarget,message:"من فضلك اختر الاشتراك أولاً",icon:"pi pi-exclamation-triangle",acceptLabel:"موافق",rejectLabel:" ",accept:()=>{},reject:()=>{}});return}T.require({target:a.currentTarget,message:`هل متأكد أنك تريد تحضير ${t} ؟`,icon:"pi pi-exclamation-triangle",acceptLabel:"نعم",rejectLabel:"لا",accept:()=>{X()},reject:()=>{}})},ue=(a,t,e,r,R)=>{if(!e){T.require({target:a.currentTarget,message:"من فضلك اختر نوع التمرين أولاً",icon:"pi pi-exclamation-triangle",acceptLabel:"موافق",rejectLabel:" ",accept:()=>{},reject:()=>{}});return}T.require({target:a.currentTarget,message:`هل متأكد أنك تريد تحضير كابتن / ${t} ؟`,icon:"pi pi-exclamation-triangle",acceptLabel:"نعم",rejectLabel:"لا",accept:()=>{r.length>0?(F.value=!0,M.value=!0,_.value=R,setTimeout(()=>{F.value=!1,console.log(F.value)},700)):P()},reject:()=>{}})},g=n({global:{value:null,matchMode:w.CONTAINS},customer_name:{operator:L.AND,constraints:[{value:null,matchMode:w.STARTS_WITH}]},id:{operator:L.AND,constraints:[{value:null,matchMode:w.EQUALS}]}}),J=n({global:{value:null,matchMode:w.CONTAINS},name:{operator:L.AND,constraints:[{value:null,matchMode:w.STARTS_WITH}]},id:{operator:L.AND,constraints:[{value:null,matchMode:w.EQUALS}]}}),de={weekday:"long",month:"long",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0,timeZone:"Africa/Cairo",locale:"ar"},me=new Intl.DateTimeFormat("ar",de),X=()=>{v.value=!0;let a=!1,t=[];if(m.value.forEach(e=>{e.chosenSubscription?t.push({customer_id:e.id,subscription_id:e.chosenSubscription}):(a=!0,U.value=!0)}),!a){U.value=!1;let e={branch_id:C.value,training_start_time:E.value,session_duration:N.value,customers:t};f.post("https://akademia.website/api/bulkAttendance",e).then(r=>{console.log(r),k.value=!0,m.value=[],O(),v.value=!1,setTimeout(()=>{k.value=!1},4500)}).catch(r=>{m.value=[],console.log(r),v.value=!1})}},P=()=>{v.value=!0;let a=[];S.value.forEach(e=>{a.push(e.id)});let t={branch_id:C.value,category_id:S.value[0].sessionCategory,training_start_time:E.value,session_duration:N.value,coach_ids:a};f.post("https://akademia.website/api/bulkAttendance",t).then(e=>{console.log(e),k.value=!0,m.value=[],O(),v.value=!1,M.value=!1,setTimeout(()=>{k.value=!1},4500)}).catch(e=>{m.value=[],console.log(e),v.value=!1})};function pe(a){const t=new Date,e=new Date(a),r=e.getFullYear(),R=e.getMonth(),_e=e.getDate(),ge=t.getFullYear(),be=t.getMonth(),fe=t.getDate();return r===ge&&R===be&&_e===fe}const ve=a=>{j.value=!0,E.value=a.training_start_time,C.value=a.branch_id,N.value=a.session_duration,O()},O=()=>{f.get(`https://akademia.website/api/coaches/active/${C.value}`).then(a=>{console.log(a.data.coaches),V.value=a.data.coaches,f.get(`https://akademia.website/api/customers/active/${C.value}`).then(t=>{console.log(t.data.customers),h.value=t.data.customers,he(),j.value=!1,q.value=!0}).catch(t=>{console.log(t)})}).catch(a=>{console.log(a)})},ee=()=>{f.get("https://akademia.website/api/branches").then(a=>{console.log(a.data),a.data.branches.forEach(t=>{Q.value.push({label:t.branch_name,value:t.id})}),K.value=!0}).catch(a=>{console.log(a)})},te=()=>{f.get("https://akademia.website/api/categories").then(a=>{console.log(a.data),a.data.categories.forEach(t=>{Y.value.push({label:t.category_name,value:t.id})}),ie.value=!0}).catch(a=>{console.log(a)})},he=()=>{h.value.forEach(a=>{a.subscriptionsOptions=[],a.subscriptions.forEach(t=>{t.is_private?a.subscriptionsOptions.push({label:`${t.category_name} - برايفت`,value:t.id}):a.subscriptionsOptions.push({label:`${t.category_name} - ${t.academy_name}`,value:t.id})})}),console.log(h.value)},ae=n(),se=n(),oe=n("admin");return Se(()=>{ke().then(a=>{a==!1?Ce().then(t=>{t==!1&&(localStorage.removeItem("SwimmingToken"),location.reload(),I({path:"/login",query:z.value.query})),se.value=t.permissions,oe.value="employee",$e(se.value,"تسجيل الحضور",oe.value)||(localStorage.removeItem("SwimmingToken"),location.reload(),I({path:"/login",query:z.value.query})),ee(),Z(),te()}):(ee(),Z(),te())})}),(a,t)=>(c(),p(Ae,null,[l(o(De),{visible:M.value,"onUpdate:visible":t[0]||(t[0]=e=>M.value=e),maximizable:"",modal:"",header:"تحذير",style:{width:"60vw"},breakpoints:{"960px":"75vw","641px":"100vw"}},{footer:i(()=>[l(o(D),{type:"button",loading:v.value,class:"mb-3 lg:mb-0 mx-2",onClick:P,label:"تسجيل حضور"},null,8,["loading"])]),default:i(()=>[F.value?(c(),$(Me,{key:0})):(c(),p("div",Le,[s("div",je,[qe,s("h3",Ue,"هل أنت متأكد أنك تريد تحضير كابتن / "+d(_.value.name)+" ؟",1),Ee]),l(o(B),{stripedRows:"",value:_.value.attendances,showGridlines:"",paginator:"",rows:10,rowsPerPageOptions:[10,20,50],filterDisplay:"menu",dataKey:"id",removableSort:"",globalFilterFields:["duration","category_name"],tableStyle:"min-width: 50rem"},{header:i(()=>[s("div",Ne,[s("h3",Oe,"كابتن / "+d(_.value.name),1),Re])]),footer:i(()=>[y(" في المجموع هناك "+d(_.value.attendances?_.value.attendances.length:0)+" مرات حضور اليوم ",1)]),default:i(()=>[l(o(u),{field:"branch.branch_name",sortable:"",header:"الفرع"}),l(o(u),{field:"category.category_name",sortable:"",header:"نوع التمرين"}),l(o(u),{field:"created_at",sortable:"",header:"موعد الحضور"},{body:i(e=>[s("p",null,d(new Date(e.data.created_at).getMinutes().toString().padStart(2,"0"))+" : "+d(new Date(e.data.created_at).getHours().toString().padStart(2,"0")),1)]),_:1})]),_:1},8,["value"])]))]),_:1},8,["visible"]),s("div",Be,[s("div",Ie,[l(o(Te),{home:re.value,model:G.value},null,8,["home","model"])]),K.value&&!q.value?(c(),p("div",ze,[l(o(x),{modelValue:H.value,"onUpdate:modelValue":t[1]||(t[1]=e=>H.value=e),type:"form",actions:!1,onSubmit:ve},{default:i(()=>[s("div",He,[Ke,l(o(x),{type:"dropdown",id:"branch",validation:"required",name:"branch_id",label:"الفرع",placeholder:"اختر الفرع الذي تريد تسجيل الحضور فيه",options:Q.value},null,8,["options"])]),s("div",Qe,[We,l(o(x),{type:"time",id:"start_time",label:"موعد بدء التمرين","outer-class":"col-12",name:"training_start_time",value:W.value,validation:"required"},null,8,["value"])]),s("div",Ye,[Ge,l(o(x),{type:"text",number:"float",id:"duration",label:"مدة التمرين","outer-class":"col-12",placeholder:"يرجي ادخال عدد ساعات التمرين",name:"session_duration",validation:"required"})]),l(o(D),{type:"submit",class:"submitBtn",label:"التالي",loading:j.value},null,8,["loading"])]),_:1},8,["modelValue"])])):b("",!0),l(o(Ve)),q.value?(c(),p("div",Ze,[s("div",Je,[A.value=="customers"?(c(),$(o(D),{key:0,type:"button",label:"تسجيل حضور المدربين",onClick:t[2]||(t[2]=e=>A.value="coaches")})):b("",!0),A.value=="coaches"?(c(),$(o(D),{key:1,type:"button",label:"تسجيل حضور المشتركين",onClick:t[3]||(t[3]=e=>A.value="customers")})):b("",!0)]),k.value?(c(),$(Fe,{key:0,class:"fadeinright animation-duration-500 animation-iteration-1 my-4"},{default:i(()=>[y("تم التسجيل بنجاح")]),_:1})):b("",!0),A.value=="customers"?(c(),p("div",Xe,[U.value?(c(),p("h5",Pe,"يرجي تحديد الاشتراكات أولاً")):b("",!0),l(o(B),{filters:g.value,"onUpdate:filters":t[5]||(t[5]=e=>g.value=e),ref_key:"dt",ref:ae,stripedRows:"",value:h.value,selection:m.value,"onUpdate:selection":t[6]||(t[6]=e=>m.value=e),paginator:"",rows:10,rowsPerPageOptions:[10,20,50],filterDisplay:"menu",dataKey:"id",removableSort:"",globalFilterFields:["id","customer_name"],tableStyle:"min-width: 50rem"},{header:i(()=>[s("div",et,[l(o(D),{type:"button",class:"mb-3 lg:mb-0 mx-2",onClick:X,loading:v.value,disabled:m.value.length==0,label:"تسجيل المحدد"},null,8,["loading","disabled"]),tt,s("span",at,[st,l(o(le),{modelValue:g.value.global.value,"onUpdate:modelValue":t[4]||(t[4]=e=>g.value.global.value=e),placeholder:"بحث شامل"},null,8,["modelValue"])])])]),empty:i(()=>[l(o(ne),{severity:"info"},{default:i(()=>[y("لا يوجد مشتركين")]),_:1})]),footer:i(()=>[y(" في المجموع هناك "+d(h.value?h.value.length:0)+" أعضاء ",1)]),default:i(()=>[l(o(u),{selectionMode:"multiple",headerStyle:"width: 3rem"}),l(o(u),{field:"id",sortable:"",header:"الكود"}),l(o(u),{field:"customer_name",sortable:"",header:"اسم المشترك"}),l(o(u),{field:"subscriptions[0].expiration_date",sortable:"",header:"تاريخ انتهاء الاشتراك"},{body:i(e=>[s("p",null,d(e.data.subscriptions[0].expiration_date),1)]),_:1}),l(o(u),{field:"subscriptions[0].number_of_sessions",sortable:"",header:"الحصص المتبقية"},{body:i(e=>[s("p",null,d(e.data.subscriptions[0].number_of_sessions)+" حصص",1)]),_:1}),l(o(u),{header:"تسجيل الحضور",style:{"max-width":"20rem"}},{body:i(e=>[pe(e.data.last_attendance_date)?(c(),p("div",ct,[s("p",ut," تم تسجيل الحضور اليوم في "+d(o(me).format(new Date(e.data.last_attendance_date))),1)])):(c(),p("div",ot,[l(o(x),{type:"dropdown",id:"branch",modelValue:e.data.chosenSubscription,"onUpdate:modelValue":r=>e.data.chosenSubscription=r,validation:"required",name:"subscription_id",label:"الاشتراك",placeholder:"اختر اشتراك اللاعب",options:e.data.subscriptionsOptions},null,8,["modelValue","onUpdate:modelValue","options"]),s("div",{class:"flex text-center justify-content-center align-items-center cursor-pointer hoverIcon textColor p-2 borderRound",onClick:r=>{m.value.push(e.data),ce(r,e.data.customer_name,e.data.chosenSubscription)}},rt,8,lt)]))]),_:1})]),_:1},8,["filters","value","selection"])])):(c(),p("div",dt,[l(o(B),{filters:J.value,"onUpdate:filters":t[8]||(t[8]=e=>J.value=e),ref_key:"dt",ref:ae,stripedRows:"",value:V.value,selection:S.value,"onUpdate:selection":t[9]||(t[9]=e=>S.value=e),paginator:"",rows:10,rowsPerPageOptions:[10,20,50],filterDisplay:"menu",dataKey:"id",removableSort:"",globalFilterFields:["id","name"],tableStyle:"min-width: 50rem"},{header:i(()=>[s("div",mt,[pt,s("span",vt,[ht,l(o(le),{modelValue:g.value.global.value,"onUpdate:modelValue":t[7]||(t[7]=e=>g.value.global.value=e),placeholder:"بحث شامل"},null,8,["modelValue"])])])]),empty:i(()=>[l(o(ne),{severity:"info"},{default:i(()=>[y("لا يوجد مدربين")]),_:1})]),footer:i(()=>[y(" في المجموع هناك "+d(V.value?V.value.length:0)+" مدربين ",1)]),default:i(()=>[l(o(u),{selectionMode:"multiple",headerStyle:"width: 3rem"}),l(o(u),{field:"id",sortable:"",header:"الكود"}),l(o(u),{field:"customer_name",sortable:"",header:"اسم المدرب"},{body:i(e=>[s("p",null,"كابتن / "+d(e.data.name),1)]),_:1}),l(o(u),{header:"تسجيل الحضور",style:{"max-width":"20rem"}},{body:i(e=>[l(o(x),{type:"autocomplete",id:"sessionCategory",modelValue:e.data.sessionCategory,"onUpdate:modelValue":r=>e.data.sessionCategory=r,validation:"required",name:"sessionCategory",label:"نوع التمرين",placeholder:"اختر نوع التمرين",options:Y.value},null,8,["modelValue","onUpdate:modelValue","options"]),s("div",{class:"flex text-center justify-content-center align-items-center cursor-pointer hoverIcon textColor p-2 borderRound",onClick:r=>{S.value.push(e.data),ue(r,e.data.name,e.data.sessionCategory,e.data.attendances,e.data)}},ft,8,_t)]),_:1})]),_:1},8,["filters","value","selection"])]))])):b("",!0)])],64))}});export{Mt as default};
