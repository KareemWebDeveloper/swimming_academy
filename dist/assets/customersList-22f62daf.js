import{d as re,u as ue,j as de,r as u,o as ce,k as me,l as pe,a as m,c as p,b as a,w as o,e as t,g as n,m as M,f as v,F as ve,h as x,s as d,n as N,p as k,t as C,v as W,x as be,y as he,z as f,A as Z}from"./index-5ed95cfa.js";import{s as G,a as J,b as D}from"./inlinemessage.esm-b859ab3c.js";import{s as c}from"./column.esm-6404a039.js";import{i as V}from"./isEmployeeAuthorizedFor-df272e7f.js";import{s as fe}from"./successMsg-575c06f8.js";import{s as R}from"./tag.esm-7b7ff2f9.js";import{s as ye}from"./calendar.esm-0476f178.js";import"./index.esm-93947ef4.js";/* empty css                                                   */const _e={class:"text-center"},ge=n("span",{style:{color:"rgba(220, 18, 18, 0.759)"},class:"material-symbols-outlined text-6xl"}," warning ",-1),xe=n("h3",{style:{color:"rgba(220, 18, 18, 0.759)"}},"لا يمكن حذف المشتركين التاليين بسبب وجود مديونيات لم تسدد",-1),ke={key:0,class:"failedDeletions"},Ce={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},we=n("h3",{class:"hidden md:my-2 lg:my-0 md:flex",style:{color:"black"}},"المديونيات",-1),Ve={class:"p-input-icon-left"},$e=n("i",{class:"pi pi-search"},null,-1),Se={class:"flex align-items-center"},Ue=["onClick"],Ie=["onClick"],De={class:"flex justify-content-between"},Ae=n("div",{class:"text-center"},[n("span",{style:{color:"rgba(220, 18, 18, 0.759)"},class:"material-symbols-outlined text-6xl"}," warning "),n("h3",{style:{color:"rgba(220, 18, 18, 0.759)"}},"هل متأكد أنك تريد حذف هؤلاء المشتركين ؟"),n("p",{class:"my-2"},"أنت علي وشك حذف مشتركين نشطين")],-1),Te={class:"flex justify-content-between"},Fe={class:"w-12 md:w-10 my-5 m-auto p-2 md:p-5 branchesList",style:{direction:"rtl"}},Le={class:"w-full m-auto flex justify-content-center p-4 MargAutoMob padding-1-breadcrumbs",style:{direction:"ltr"}},Be={class:"flex flex-column lg:flex-row justify-content-between align-items-center"},Ee={class:"flex align-items-center"},Me=n("h3",{class:"hidden md:my-2 lg:my-0 md:flex"},"المشتركين",-1),Ne={class:"p-input-icon-left"},Re=n("i",{class:"pi pi-search"},null,-1),je={key:0},Oe={key:1},ze={key:0},qe={key:1},Qe={key:0},He={key:1},Ke={class:"flex align-items-center"},We=["onClick"],Ze=["onClick"],Ge=["onClick"],nt=re({__name:"customersList",setup(Je){const{push:$,currentRoute:X}=ue(),Y=de(),j=u(!1),P=u(!1),S=u(!1),U=u(!1);u(!1);const I=u(!1);u();const y=u([]),A=u(!1),O=u([]);O.value=[{label:"المشتركين",route:"/customers",to:"/customers"},{label:"عرض المشتركين",route:"/customers",to:"/customers"}];const ee=u({icon:"pi pi-home",to:"/"}),te=(s,l)=>{Y.require({target:s.currentTarget,message:l=="cash"?"هل متأكد أنك تريد حذف هذا المشترك ؟":"هذا المشترك نشط! هل متأكد أنك تريد حذف هذا المشترك ؟",icon:"pi pi-exclamation-triangle",acceptLabel:"نعم",rejectLabel:"لا",accept:()=>{F()},reject:()=>{}})},z=u(["active","inactive","frozen"]),le=u(["cash","installments"]),w=u(),ae=u([]),q=u([]);u();const b=u([]),h=u({global:{value:null,matchMode:f.CONTAINS},customer_name:{value:"",matchMode:f.CONTAINS},category_name:{value:"",matchMode:f.EQUALS},expiration_date:{value:null,matchMode:f.DATE_IS},subscription_type:{value:null,matchMode:f.EQUALS},customer_phone:{operator:Z.AND,constraints:[{value:null,matchMode:f.STARTS_WITH}]},id:{operator:Z.AND,constraints:[{value:null,matchMode:f.EQUALS}]},state:{value:null,matchMode:f.CONTAINS}}),oe={weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"Africa/Cairo",locale:"ar"},se=new Intl.DateTimeFormat("ar",oe),T=()=>{x.get("https://akademia.website/api/customers").then(s=>{console.log(s.data),w.value=s.data.customers,j.value=!0,w.value.forEach(l=>{l.created_at=new Date(l.created_at),l.state=l.subscriptions[0].state,l.expiration_date=new Date(l.subscriptions[0].expiration_date),l.category_name=l.subscriptions[0].category_name,l.subscription_id=l.subscriptions[0].id,l.subscription_type=l.subscriptions[0].subscription_type;const e=new Date(l.subscriptions[0].expiration_date).getTime()-new Date().getTime();console.log(e/(1e3*3600*24)),l.daysLeft=Math.ceil(e/(1e3*3600*24))})}).catch(s=>{console.log(s)})},Q=()=>{x.get("https://akademia.website/api/branches").then(s=>{console.log(s.data),s.data.branches.forEach(l=>{ae.value.push(l.branch_name)}),P.value=!0}).catch(s=>{console.log(s)})},ne=s=>{x.put(`https://akademia.website/api/payInstallment/${s}`).then(l=>{console.log(l.data.installment),b.value=b.value.filter(e=>e.id!==s)}).catch(l=>{console.log(l)})},ie=s=>{x.delete(`https://akademia.website/api/deleteInstallment/${s}`).then(l=>{console.log(l.data),b.value=b.value.filter(e=>e.id!==s)}).catch(l=>{console.log(l)})},F=()=>{I.value=!0,console.log(y.value),b.value=[];let s=[];y.value.forEach(e=>{s.push(e.id)});let l={customer_ids:s};x.post("https://akademia.website/api/customerBulkDelete",l).then(e=>{console.log(e),I.value=!1,A.value=!0,y.value=[],U.value=!1,S.value=!1,T(),setTimeout(()=>{A.value=!1},4500)}).catch(e=>{e.response.data.failed_deletions&&(U.value=!0,I.value=!1,S.value=!1,e.response.data.failed_deletions.forEach(i=>{Object.values(i.installments).forEach(r=>{r.customer_name=i.customer_name,console.log(r),b.value.push(r)})}),console.log("customers have unpaid installments !"),console.log(b.value))})},H=()=>{x.get("https://akademia.website/api/categories").then(s=>{console.log(s.data),s.data.categories.forEach(l=>{q.value.push(l.category_name)})}).catch(s=>{console.log(s)})},L=s=>{if(s=="active")return"success";if(s=="inactive")return"danger";if(s=="frozen")return"info"},B=s=>{if(s=="active")return"نشط";if(s=="inactive")return"غير نشط";if(s=="frozen")return"مجمد"},_=u(),g=u("admin");ce(()=>{me().then(s=>{s==!1?pe().then(l=>{l==!1&&(localStorage.removeItem("SwimmingToken"),location.reload(),$({path:"/login",query:X.value.query})),_.value=l.permissions,g.value="employee",T(),Q(),H()}):(T(),Q(),H())})});const E=u(),K=()=>{E.value.exportCSV()};return(s,l)=>(m(),p(ve,null,[a(t(W),{visible:U.value,"onUpdate:visible":l[3]||(l[3]=e=>U.value=e),onAfterHide:l[4]||(l[4]=e=>b.value=[]),modal:"",header:"تنبيه",style:{width:"60vw"},breakpoints:{"960px":"75vw","641px":"100vw"}},{footer:o(()=>[n("div",De,[a(t(d),{type:"button",severity:"danger",class:"mb-3 lg:mb-0 mx-2",loading:I.value,onClick:F,label:"حاول مجدداً"},null,8,["loading"])])]),default:o(()=>[n("div",_e,[ge,xe,b.value.length>0?(m(),p("div",ke,[a(t(G),{filters:h.value,"onUpdate:filters":l[2]||(l[2]=e=>h.value=e),ref_key:"dt",ref:E,stripedRows:"",value:b.value,paginator:"",rows:10,rowsPerPageOptions:[10,20,50],filterDisplay:"menu",dataKey:"id",removableSort:"",globalFilterFields:["id","category_name"],tableStyle:"min-width: 50rem"},{header:o(()=>[n("div",Ce,[we,n("span",Ve,[$e,a(t(N),{modelValue:h.value.global.value,"onUpdate:modelValue":l[0]||(l[0]=e=>h.value.global.value=e),placeholder:"بحث شامل"},null,8,["modelValue"])])])]),empty:o(()=>[a(t(J),{severity:"info"},{default:o(()=>[k("لا يوجد مديونيات")]),_:1})]),paginatorend:o(()=>[a(t(d),{type:"button",icon:"pi pi-download",onClick:l[1]||(l[1]=e=>K(e)),text:""})]),default:o(()=>[a(t(c),{field:"customer_name",sortable:"",header:"اسم اللاعب"}),a(t(c),{field:"installment_number",header:"رقم القسط"}),a(t(c),{field:"amount",sortable:"",header:"المبلغ المستحق"},{body:o(e=>[n("p",null,C(e.data.amount)+" ج.م",1)]),_:1}),a(t(c),{field:"due_date",sortable:"",header:"موعد الاستحقاق"},{body:o(e=>[n("p",null,C(e.data.due_date),1)]),_:1}),a(t(c),{header:"تعديل",style:{"min-width":"11rem"}},{body:o(e=>[n("div",Se,[n("span",{class:"cursor-pointer hoverIcon textColor text-sm p-2 borderRound",onClick:i=>ne(e.data.id)}," تم الدفع ",8,Ue),n("span",{onClick:i=>ie(e.data.id),class:"material-symbols-outlined cursor-pointer hoverIcon textColor mx-2 text-3xl p-2 borderRound"}," delete_forever ",8,Ie)])]),_:1})]),_:1},8,["filters","value"])])):v("",!0)])]),_:1},8,["visible"]),a(t(W),{visible:S.value,"onUpdate:visible":l[5]||(l[5]=e=>S.value=e),modal:"",header:"رسالة تأكيد",style:{width:"60vw"},breakpoints:{"960px":"75vw","641px":"100vw"}},{footer:o(()=>[n("div",Te,[a(t(d),{type:"button",severity:"danger",class:"mb-3 lg:mb-0 mx-2",onClick:F,label:"تأكيد"})])]),default:o(()=>[Ae]),_:1},8,["visible"]),n("div",Fe,[n("div",Le,[a(t(be),{home:ee.value,model:O.value},null,8,["home","model"])]),a(t(he)),A.value?(m(),M(fe,{key:0,class:"fadeinright animation-duration-500 animation-iteration-1 my-4"},{default:o(()=>[k("تم الحذف بنجاح")]),_:1})):v("",!0),n("div",null,[a(t(G),{filters:h.value,"onUpdate:filters":l[10]||(l[10]=e=>h.value=e),"filter-locale":"ar","export-filename":"المشتركين",ref_key:"dt",ref:E,stripedRows:"",value:w.value,selection:y.value,"onUpdate:selection":l[11]||(l[11]=e=>y.value=e),loading:!j.value,paginator:"",rows:10,rowsPerPageOptions:[10,15,20,50],filterDisplay:"menu",dataKey:"id",removableSort:"",globalFilterFields:["id","customer_name","customer_phone"],tableStyle:"min-width: 50rem"},{header:o(()=>[n("div",Be,[n("div",Ee,[t(V)(_.value,"تجديد و تسجيل اشتراكات",g.value)?(m(),M(t(d),{key:0,type:"button",class:"mb-3 lg:mb-0 mx-2",onClick:l[6]||(l[6]=e=>t($)("/customer/create")),label:"تسجيل مشترك"})):v("",!0),t(V)(_.value,"تجديد و تسجيل اشتراكات",g.value)?(m(),M(t(d),{key:1,type:"button",disabled:y.value.length==0,severity:"danger",class:"mb-3 lg:mb-0 mx-2",label:"حذف المحدد"},null,8,["disabled"])):v("",!0)]),Me,n("div",null,[n("span",Ne,[Re,a(t(N),{modelValue:h.value.global.value,"onUpdate:modelValue":l[7]||(l[7]=e=>h.value.global.value=e),class:"mx-2",placeholder:"بحث شامل"},null,8,["modelValue"])]),a(t(D),{modelValue:h.value.state.value,"onUpdate:modelValue":l[8]||(l[8]=e=>h.value.state.value=e),options:z.value,placeholder:"اختر حالة",class:"p-column-filter",style:{"min-width":"12rem"},showClear:!0},{option:o(e=>[a(t(R),{value:B(e.option),severity:L(e.option)},null,8,["value","severity"])]),_:1},8,["modelValue","options"])])])]),loading:o(()=>[k(" برجاء الانتظار .. جاري تحميل بيانات المشتركين ... ")]),empty:o(()=>[a(t(J),{severity:"info"},{default:o(()=>[k("لا يوجد مشتركين")]),_:1})]),paginatorend:o(()=>[a(t(d),{type:"button",icon:"pi pi-download",onClick:l[9]||(l[9]=e=>K(e)),text:""})]),footer:o(()=>[k(" في المجموع هناك "+C(w.value?w.value.length:0)+" مشتركين ",1)]),default:o(()=>[a(t(c),{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(t(c),{field:"id",sortable:"",header:"الكود",style:{width:"8%"}}),a(t(c),{field:"customer_name",sortable:"",header:"الاسم"},{body:o(e=>[k(C(e.data.customer_name),1)]),filter:o(({filterModel:e,filterCallback:i})=>[a(t(N),{modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,onInput:r=>i(),type:"text",class:"p-column-filter",placeholder:"أدخل اسم المشترك"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),filterapply:o(({filterCallback:e})=>[a(t(d),{type:"button",onClick:i=>e(),class:"mb-3 lg:mb-0 mx-2",label:"تفعيل"},null,8,["onClick"])]),filterclear:o(({filterCallback:e})=>[a(t(d),{type:"button",onClick:i=>e(),class:"mb-3 lg:mb-0 mx-2",label:"الغاء",outlined:""},null,8,["onClick"])]),_:1}),a(t(c),{field:"customer_phone",header:"الهاتف"}),a(t(c),{field:"state",header:"الحالة"},{body:o(e=>[a(t(R),{value:B(e.data.state),severity:L(e.data.state)},null,8,["value","severity"])]),filter:o(({filterModel:e,filterCallback:i})=>[a(t(D),{modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,onChange:r=>i(),options:z.value,placeholder:"اختر حالة",class:"p-column-filter",style:{"min-width":"12rem"},showClear:!0},{option:o(r=>[a(t(R),{value:B(r.option),severity:L(r.option)},null,8,["value","severity"])]),_:2},1032,["modelValue","onUpdate:modelValue","onChange","options"])]),filterapply:o(({filterCallback:e})=>[a(t(d),{type:"button",onClick:i=>e(),class:"mb-3 lg:mb-0 mx-2",label:"تفعيل"},null,8,["onClick"])]),filterclear:o(({filterCallback:e})=>[a(t(d),{type:"button",onClick:i=>e(),class:"mb-3 lg:mb-0 mx-2",label:"الغاء",outlined:""},null,8,["onClick"])]),_:1}),a(t(c),{field:"subscription_type",header:"الدفع",style:{"min-width":"9rem"}},{body:o(e=>[e.data.subscription_type=="cash"?(m(),p("p",je,"كاش")):v("",!0),e.data.subscription_type=="installments"?(m(),p("p",Oe,"تقسيط")):v("",!0)]),filter:o(({filterModel:e,filterCallback:i})=>[a(t(D),{modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,onChange:r=>i(),options:le.value,placeholder:"اختر طريقة دفع",class:"p-column-filter",style:{"min-width":"12rem"},showClear:!0},{option:o(r=>[r.option=="cash"?(m(),p("p",ze,"كاش")):v("",!0),r.option=="installments"?(m(),p("p",qe,"تقسيط")):v("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","onChange","options"])]),filterapply:o(({filterCallback:e})=>[a(t(d),{type:"button",onClick:i=>e(),class:"mb-3 lg:mb-0 mx-2",label:"تفعيل"},null,8,["onClick"])]),filterclear:o(({filterCallback:e})=>[a(t(d),{type:"button",onClick:i=>e(),class:"mb-3 lg:mb-0 mx-2",label:"الغاء",outlined:""},null,8,["onClick"])]),_:1}),a(t(c),{field:"category_name",header:"نوع التمرين",style:{"min-width":"11rem"}},{filter:o(({filterModel:e,filterCallback:i})=>[a(t(D),{modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,onChange:r=>i(),options:q.value,placeholder:"اختر نوع التمرين",class:"p-column-filter",style:{"min-width":"12rem"},showClear:!0},null,8,["modelValue","onUpdate:modelValue","onChange","options"])]),filterapply:o(({filterCallback:e})=>[a(t(d),{type:"button",onClick:i=>e(),class:"mb-3 lg:mb-0 mx-2",label:"تفعيل"},null,8,["onClick"])]),filterclear:o(({filterCallback:e})=>[a(t(d),{type:"button",onClick:i=>e(),class:"mb-3 lg:mb-0 mx-2",label:"الغاء",outlined:""},null,8,["onClick"])]),_:1}),a(t(c),{field:"expiration_date",sortable:"",header:"تاريخ انتهاء الاشتراك",style:{"min-width":"17rem"}},{body:o(e=>[n("p",null,C(t(se).format(e.data.expiration_date)),1)]),filter:o(({filterModel:e,filterCallback:i})=>[a(t(ye),{modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,onInput:r=>i(),placeholder:"اختر تاريخ انتهاء الاشتراك",showIcon:"",showButtonBar:"",inputId:"expiration_date"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),filterapply:o(({filterCallback:e})=>[a(t(d),{type:"button",onClick:i=>e(),class:"mb-3 lg:mb-0 mx-2",label:"تفعيل"},null,8,["onClick"])]),filterclear:o(({filterCallback:e})=>[a(t(d),{type:"button",onClick:i=>e(),class:"mb-3 lg:mb-0 mx-2",label:"الغاء",outlined:""},null,8,["onClick"])]),_:1}),a(t(c),{field:"daysLeft",sortable:"",header:"الأيام المتبقية",style:{"min-width":"12rem"}},{body:o(e=>[e.data.daysLeft>=0?(m(),p("p",Qe,C(e.data.daysLeft)+" يوم",1)):(m(),p("p",He,"اشتراك منتهي"))]),_:1}),a(t(c),{header:"تعديل"},{body:o(e=>[n("div",Ke,[t(V)(_.value,"تجديد و تسجيل اشتراكات",g.value)?(m(),p("span",{key:0,class:"material-symbols-outlined cursor-pointer hoverIcon textColor text-3xl p-2 borderRound",onClick:i=>{y.value=[{id:e.data.id}],te(i,e.data.subscription_type)}}," delete_forever ",8,We)):v("",!0),t(V)(_.value,"تجديد و تسجيل اشتراكات",g.value)?(m(),p("span",{key:1,onClick:i=>t($)(`/customer/update/${e.data.id}`),class:"material-symbols-outlined cursor-pointer hoverIcon mx-2 textColor text-3xl p-2 borderRound"}," edit ",8,Ze)):v("",!0),t(V)(_.value,"تجديد و تسجيل اشتراكات",g.value)?(m(),p("span",{key:2,class:"material-symbols-outlined cursor-pointer hoverIcon textColor text-3xl p-2 borderRound",onClick:i=>t($)(`/customer/${e.data.subscription_id}`)}," visibility ",8,Ge)):v("",!0)])]),_:1})]),_:1},8,["filters","value","selection","loading"])])])],64))}});export{nt as default};
